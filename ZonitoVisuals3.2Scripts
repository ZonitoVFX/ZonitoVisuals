{
  "Rose": {
    "Type": "Module",
    "Code": "LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICBgN01NIiIiTXEuICAgICAgICAgICAgLk0iIiJiZ2QgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAgIE1NICAgYE1NLiAgICAgICAgICAsTUkgICAgIlkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAgIE1NICAgLE05ICAscFciV3EuICBgTU1iLiAgICAgIC5nUCJZYSAgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAgIE1NbW1kTTkgIDZXJyAgIGBXYiAgIGBZTU1OcS4gLE0nICAgWWIgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAgIE1NICBZTS4gIDhNICAgICBNOCAuICAgICBgTU0gOE0iIiIiIiIgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAgIE1NICAgYE1iLllBLiAgICxBOSBNYiAgICAgZE0gWU0uICAgICwgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAuSk1NTC4gLkpNTS5gWWJtZDknICBQIllibW1kIiAgIGBNYm1tZCcgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAgICAgICAgUm9ibG94IEluc3RhbmNlIFNlcmlhbGl6ZXIgICAgICAgICAgICAgICAgICAgICAgICAgLS0KLS0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gVXRpbGl0aWVzCgpsb2NhbCBmdW5jdGlvbiBpbnZlcnRfdGFibGUodCkKCWxvY2FsIHMgPSB7fQoJZm9yIGsgaW4gdCBkbwoJCXNbdFtrXV0gPSBrCgllbmQKCXJldHVybiBzCmVuZAoKbG9jYWwgdGFibGVfcGFjayA9IHRhYmxlLnBhY2sKbG9jYWwgdGFibGVfdW5wYWNrID0gdGFibGUudW5wYWNrCgpsb2NhbCBJbnN0YW5jZV9uZXcgPSBJbnN0YW5jZS5uZXcKbG9jYWwgVmVjdG9yMl9uZXcgPSBWZWN0b3IyLm5ldwpsb2NhbCBWZWN0b3IzX25ldyA9IFZlY3RvcjMubmV3CmxvY2FsIENvbG9yM19uZXcgPSBDb2xvcjMubmV3CmxvY2FsIENvbG9yU2VxdWVuY2VfbmV3ID0gQ29sb3JTZXF1ZW5jZS5uZXcKbG9jYWwgQ29sb3JTZXF1ZW5jZUtleXBvaW50X25ldyA9IENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcKbG9jYWwgQ0ZyYW1lX25ldyA9IENGcmFtZS5uZXcKbG9jYWwgTnVtYmVyUmFuZ2VfbmV3ID0gTnVtYmVyUmFuZ2UubmV3CmxvY2FsIE51bWJlclNlcXVlbmNlS2V5cG9pbnRfbmV3ID0gTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcKbG9jYWwgTnVtYmVyU2VxdWVuY2VfbmV3ID0gTnVtYmVyU2VxdWVuY2UubmV3Cgpsb2NhbCBJbnNlcnRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJJbnNlcnRTZXJ2aWNlIikKbG9jYWwgTGlnaHRpbmdTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBEYXRhc2V0cwoKbG9jYWwgUk9TRV9WRVJTSU9OID0gMgoKbG9jYWwgREVTRVJJQUxJWkVfREVGQVVMVF9QQVJFTlQgPSB3b3Jrc3BhY2UuVGVycmFpbgoKbG9jYWwgTVVUQUJMRV9QUk9QRVJUSUVTID0gewoJRm9sZGVyID0gewoJCSJOYW1lIgoJfSwKCU1vZGVsID0gewoJCSJOYW1lIiwKCQkiUHJpbWFyeVBhcnQiLAoJCSJXb3JsZFBpdm90IgoJfSwKCUxpZ2h0aW5nID0gewoJCSJBbWJpZW50IiwgIkJyaWdodG5lc3MiLCAiQ29sb3JTaGlmdF9Cb3R0b20iLCAiQ29sb3JTaGlmdF9Ub3AiLAoJCSJFbnZpcm9ubWVudERpZmZ1c2VTY2FsZSIsICJFbnZpcm9ubWVudFNwZWN1bGFyU2NhbGUiLCAiR2xvYmFsU2hhZG93cyIsCgkJIk91dGRvb3JBbWJpZW50IiwgIlNoYWRvd1NvZnRuZXNzIiwgIkNsb2NrVGltZSIsICJHZW9ncmFwaGljTGF0aXR1ZGUiLAoJCSJUaW1lT2ZEYXkiLCAiRXhwb3N1cmVDb21wZW5zYXRpb24iLCAiRm9nQ29sb3IiLCAiRm9nRW5kIiwgIkZvZ1N0YXJ0IiwKCX0sCglTa3kgPSB7CgkJIkNlbGVzdGlhbEJvZGllc1Nob3duIiwgIk1vb25Bbmd1bGFyU2l6ZSIsICJNb29uVGV4dHVyZUlkIiwgIlNreWJveEJrIiwKCQkiU2t5Ym94RG4iLCAiU2t5Ym94RnQiLCAiU2t5Ym94TGYiLCAiU2t5Ym94UnQiLCAiU2t5Ym94VXAiLCAiU3RhckNvdW50IiwKCQkiU3VuQW5ndWxhclNpemUiLCAiU3VuVGV4dHVyZUlkIiwgIk5hbWUiCgl9LAoJQXRtb3NwaGVyZSA9IHsKCQkiRGVuc2l0eSIsICJPZmZzZXQiLCAiQ29sb3IiLCAiRGVjYXkiLCAiR2xhcmUiLCAiSGF6ZSIsICJOYW1lIgoJfSwKCUNsb3VkcyA9IHsKCQkiQ292ZXIiLCAiRGVuc2l0eSIsICJDb2xvciIsICJFbmFibGVkIiwgIk5hbWUiCgl9LAoJQmxvb21FZmZlY3QgPSB7CgkJIkVuYWJsZWQiLCAiSW50ZW5zaXR5IiwgIlNpemUiLCAiVGhyZXNob2xkIiwgIk5hbWUiCgl9LAoJQmx1ckVmZmVjdCA9IHsKCQkiRW5hYmxlZCIsICJTaXplIiwgIk5hbWUiCgl9LAoJQ29sb3JDb3JyZWN0aW9uRWZmZWN0ID0gewoJCSJFbmFibGVkIiwgIkJyaWdodG5lc3MiLCAiQ29udHJhc3QiLCAiU2F0dXJhdGlvbiIsICJUaW50Q29sb3IiLCAiTmFtZSIKCX0sCglDb2xvckdyYWRpbmdFZmZlY3QgPSB7CgkJIkVuYWJsZWQiLCAiTmFtZSIKCX0sCglEZXB0aE9mRmllbGRFZmZlY3QgPSB7CgkJIkVuYWJsZWQiLCAiRmFySW50ZW5zaXR5IiwgIkZvY3VzRGlzdGFuY2UiLCAiSW5Gb2N1c1JhZGl1cyIsICJOZWFySW50ZW5zaXR5IiwgIk5hbWUiCgl9LAoJU3VuUmF5c0VmZmVjdCA9IHsKCQkiRW5hYmxlZCIsICJJbnRlbnNpdHkiLCAiU3ByZWFkIiwgIk5hbWUiCgl9LAoJU3BlY2lhbE1lc2ggPSB7CgkJIk1lc2hJZCIsCgkJIk1lc2hUeXBlIiwKCQkiTmFtZSIsCgkJIk9mZnNldCIsCgkJIlNjYWxlIiwKCQkiVGV4dHVyZUlkIgoJfSwKCU1lc2hQYXJ0ID0gewoJCSJNZXNoSWQiLAoJCSJDb2xvciIsCgkJIkRvdWJsZVNpZGVkIiwKCQkiTWF0ZXJpYWwiLAoJCSJSZWZsZWN0YW5jZSIsCgkJIlRyYW5zcGFyZW5jeSIsCgkJIlNpemUiLAoJCSJDYW5Db2xsaWRlIiwKCQkiQW5jaG9yZWQiLAoJCSJDYXN0U2hhZG93IiwKCQkiTmFtZSIsCgkJIlRleHR1cmVJRCIsCgoJCSJDRnJhbWUiLAoJCSJQaXZvdE9mZnNldCIKCX0sCglCbG9ja01lc2ggPSB7CgkJIk5hbWUiLAoJCSJPZmZzZXQiLAoJCSJTY2FsZSIsCgkJIlZlcnRleENvbG9yIgoJfSwKCUN5bGluZGVyTWVzaCA9IHsKCQkiTmFtZSIsCgkJIk9mZnNldCIsCgkJIlNjYWxlIiwKCQkiVmVydGV4Q29sb3IiCgl9LAoJV2VsZCA9IHsKCQkiQzAiLAoJCSJDMSIsCgkJIk5hbWUiLAoJCSJQYXJ0MCIsCgkJIlBhcnQxIiwKCgkJIkVuYWJsZWQiCgl9LAoJU25hcCA9IHsKCQkiQzAiLAoJCSJDMSIsCgkJIk5hbWUiLAoJCSJQYXJ0MCIsCgkJIlBhcnQxIiwKCgkJIkVuYWJsZWQiCgl9LAoJV2VsZENvbnN0cmFpbnQgPSB7CgkJIk5hbWUiLAoJCSJFbmFibGVkIiwKCQkiUGFydDAiLAoJCSJQYXJ0MSIKCX0sCglQYXJ0ID0gewoJCSJDYXN0U2hhZG93IiwKCQkiQ29sb3IiLAoJCSJNYXRlcmlhbCIsCgkJIlJlZmxlY3RhbmNlIiwKCQkiVHJhbnNwYXJlbmN5IiwKCgkJIkxvY2tlZCIsCgkJIk5hbWUiLAoKCQkiU2l6ZSIsCgkJIkNGcmFtZSIsCgkJIlBpdm90T2Zmc2V0IiwKCgkJIkNhbkNvbGxpZGUiLAoJCSJBbmNob3JlZCIsCgkJIlNoYXBlIiwKCgkJIkJhY2tTdXJmYWNlIiwKCQkiQm90dG9tU3VyZmFjZSIsCgkJIkZyb250U3VyZmFjZSIsCgkJIkxlZnRTdXJmYWNlIiwKCQkiUmlnaHRTdXJmYWNlIiwKCQkiVG9wU3VyZmFjZSIKCX0sCglXZWRnZVBhcnQgPSB7CgkJIkNhc3RTaGFkb3ciLAoJCSJDb2xvciIsCgkJIk1hdGVyaWFsIiwKCQkiUmVmbGVjdGFuY2UiLAoJCSJUcmFuc3BhcmVuY3kiLAoKCQkiTG9ja2VkIiwKCQkiTmFtZSIsCgoJCSJTaXplIiwKCQkiQ0ZyYW1lIiwKCQkiUGl2b3RPZmZzZXQiLAoKCQkiQ2FuQ29sbGlkZSIsCgkJIkFuY2hvcmVkIiwKCgkJIkJhY2tTdXJmYWNlIiwKCQkiQm90dG9tU3VyZmFjZSIsCgkJIkZyb250U3VyZmFjZSIsCgkJIkxlZnRTdXJmYWNlIiwKCQkiUmlnaHRTdXJmYWNlIiwKCQkiVG9wU3VyZmFjZSIKCX0sCglDb3JuZXJXZWRnZVBhcnQgPSB7CgkJIkNhc3RTaGFkb3ciLAoJCSJDb2xvciIsCgkJIk1hdGVyaWFsIiwKCQkiUmVmbGVjdGFuY2UiLAoJCSJUcmFuc3BhcmVuY3kiLAoKCQkiTG9ja2VkIiwKCQkiTmFtZSIsCgoJCSJTaXplIiwKCQkiQ0ZyYW1lIiwKCQkiUGl2b3RPZmZzZXQiLAoKCQkiQ2FuQ29sbGlkZSIsCgkJIkFuY2hvcmVkIiwKCgkJIkJhY2tTdXJmYWNlIiwKCQkiQm90dG9tU3VyZmFjZSIsCgkJIkZyb250U3VyZmFjZSIsCgkJIkxlZnRTdXJmYWNlIiwKCQkiUmlnaHRTdXJmYWNlIiwKCQkiVG9wU3VyZmFjZSIKCX0sCglUcnVzc1BhcnQgPSB7CgkJIkNhc3RTaGFkb3ciLAoJCSJDb2xvciIsCgkJIk1hdGVyaWFsIiwKCQkiUmVmbGVjdGFuY2UiLAoJCSJUcmFuc3BhcmVuY3kiLAoKCQkiTG9ja2VkIiwKCQkiTmFtZSIsCgoJCSJTaXplIiwKCQkiQ0ZyYW1lIiwKCQkiUGl2b3RPZmZzZXQiLAoKCQkiQ2FuQ29sbGlkZSIsCgkJIkFuY2hvcmVkIiwKCQkiU2hhcGUiLAoKCQkiQmFja1N1cmZhY2UiLAoJCSJCb3R0b21TdXJmYWNlIiwKCQkiRnJvbnRTdXJmYWNlIiwKCQkiTGVmdFN1cmZhY2UiLAoJCSJSaWdodFN1cmZhY2UiLAoJCSJUb3BTdXJmYWNlIgoJfSwKCVNwYXduTG9jYXRpb24gPSB7CgkJIkNhc3RTaGFkb3ciLAoJCSJDb2xvciIsCgkJIk1hdGVyaWFsIiwKCQkiUmVmbGVjdGFuY2UiLAoJCSJUcmFuc3BhcmVuY3kiLAoKCQkiTG9ja2VkIiwKCQkiTmFtZSIsCgoJCSJTaXplIiwKCQkiQ0ZyYW1lIiwKCQkiUGl2b3RPZmZzZXQiLAoKCQkiQ2FuQ29sbGlkZSIsCgkJIkFuY2hvcmVkIiwKCQkiU2hhcGUiLAoKCQkiQmFja1N1cmZhY2UiLAoJCSJCb3R0b21TdXJmYWNlIiwKCQkiRnJvbnRTdXJmYWNlIiwKCQkiTGVmdFN1cmZhY2UiLAoJCSJSaWdodFN1cmZhY2UiLAoJCSJUb3BTdXJmYWNlIiwKCgkJIkR1cmF0aW9uIiwKCgkJIkFsbG93VGVhbUNoYW5nZU9uVG91Y2giLAoJCSJOZXV0cmFsIiwKCQkiVGVhbUNvbG9yIgoJfSwKCVNlYXQgPSB7CgkJIkNhc3RTaGFkb3ciLAoJCSJDb2xvciIsCgkJIk1hdGVyaWFsIiwKCQkiUmVmbGVjdGFuY2UiLAoJCSJUcmFuc3BhcmVuY3kiLAoKCQkiTG9ja2VkIiwKCQkiTmFtZSIsCgoJCSJTaXplIiwKCQkiQ0ZyYW1lIiwKCQkiUGl2b3RPZmZzZXQiLAoKCQkiQ2FuQ29sbGlkZSIsCgkJIkFuY2hvcmVkIiwKCQkiU2hhcGUiLAoKCQkiQmFja1N1cmZhY2UiLAoJCSJCb3R0b21TdXJmYWNlIiwKCQkiRnJvbnRTdXJmYWNlIiwKCQkiTGVmdFN1cmZhY2UiLAoJCSJSaWdodFN1cmZhY2UiLAoJCSJUb3BTdXJmYWNlIiwKCgkJIkRpc2FibGVkIgoJfSwKCVZlaGljbGVTZWF0ID0gewoJCSJDYXN0U2hhZG93IiwKCQkiQ29sb3IiLAoJCSJNYXRlcmlhbCIsCgkJIlJlZmxlY3RhbmNlIiwKCQkiVHJhbnNwYXJlbmN5IiwKCgkJIkxvY2tlZCIsCgkJIk5hbWUiLAoKCQkiU2l6ZSIsCgkJIkNGcmFtZSIsCgkJIlBpdm90T2Zmc2V0IiwKCgkJIkNhbkNvbGxpZGUiLAoJCSJBbmNob3JlZCIsCgkJIlNoYXBlIiwKCgkJIkJhY2tTdXJmYWNlIiwKCQkiQm90dG9tU3VyZmFjZSIsCgkJIkZyb250U3VyZmFjZSIsCgkJIkxlZnRTdXJmYWNlIiwKCQkiUmlnaHRTdXJmYWNlIiwKCQkiVG9wU3VyZmFjZSIsCgoJCSJEaXNhYmxlZCIsCgkJIkhlYWRzVXBEaXNwbGF5IiwKCQkiTWF4U3BlZWQiLAoJCSJTdGVlciIsCgkJIlN0ZWVyRmxvYXQiLAoJCSJUaHJvdHRsZSIsCgkJIlRocm90dGxlRmxvYXQiLAoJCSJUb3JxdWUiLAoJCSJUdXJuU3BlZWQiCgl9LAoJRGVjYWwgPSB7CgkJIkNvbG9yMyIsCgkJIlRleHR1cmUiLAoJCSJUcmFuc3BhcmVuY3kiLAoJCSJaSW5kZXgiLAoKCQkiRmFjZSIsCgkJIk5hbWUiCgl9LAoJVGV4dHVyZSA9IHsKCQkiQ29sb3IzIiwKCQkiT2Zmc2V0U3R1ZHNVIiwKCQkiT2Zmc2V0U3R1ZHNWIiwKCQkiU3R1ZHNQZXJUaWxlVSIsCgkJIlN0dWRzUGVyVGlsZVYiLAoJCSJUZXh0dXJlIiwKCQkiVHJhbnNwYXJlbmN5IiwKCQkiWkluZGV4IiwKCgkJIkZhY2UiLAoJCSJOYW1lIgoJfSwKCUNsaWNrRGV0ZWN0b3IgPSB7CgkJIk1heEFjdGl2YXRpb25EaXN0YW5jZSIsCgkJIk5hbWUiLAoKCQkiQ3Vyc29ySWNvbiIKCX0sCglQb2ludExpZ2h0ID0gewoJCSJCcmlnaHRuZXNzIiwKCQkiQ29sb3IiLAoJCSJFbmFibGVkIiwKCQkiUmFuZ2UiLAoJCSJTaGFkb3dzIiwKCgkJIk5hbWUiCgl9LAoJU3BvdExpZ2h0ID0gewoJCSJBbmdsZSIsCgkJIkJyaWdodG5lc3MiLAoJCSJDb2xvciIsCgkJIkVuYWJsZWQiLAoJCSJGYWNlIiwKCQkiUmFuZ2UiLAoJCSJTaGFkb3dzIiwKCgkJIk5hbWUiCgl9LAoJU3VyZmFjZUxpZ2h0ID0gewoJCSJBbmdsZSIsCgkJIkJyaWdodG5lc3MiLAoJCSJDb2xvciIsCgkJIkVuYWJsZWQiLAoJCSJGYWNlIiwKCQkiUmFuZ2UiLAoJCSJTaGFkb3dzIiwKCgkJIk5hbWUiCgl9LAoJRmlyZSA9IHsKCQkiQ29sb3IiLAoJCSJFbmFibGVkIiwKCQkiSGVhdCIsCgkJIk5hbWUiLAoJCSJTZWNvbmRhcnlDb2xvciIsCgkJIlNpemUiLAoJCSJUaW1lU2NhbGUiCgl9LAoJU21va2UgPSB7CgkJIkNvbG9yIiwKCQkiRW5hYmxlZCIsCgkJIk5hbWUiLAoJCSJPcGFjaXR5IiwKCQkiUmlzZVZlbG9jaXR5IiwKCQkiU2l6ZSIsCgkJIlRpbWVTY2FsZSIKCX0sCglTcGFya2xlcyA9IHsKCQkiRW5hYmxlZCIsCgkJIk5hbWUiLAoJCSJTcGFya2xlQ29sb3IiLAoJCSJUaW1lU2NhbGUiCgl9LAoJUGFydGljbGVFbWl0dGVyID0gewoJCSJCcmlnaHRuZXNzIiwKCQkiQ29sb3IiLAoJCSJMaWdodEVtaXNzaW9uIiwKCQkiTGlnaHRJbmZsdWVuY2UiLAoJCSJPcmllbnRhdGlvbiIsCgkJIlNpemUiLAoJCSJTcXVhc2giLAoJCSJUZXh0dXJlIiwKCQkiVHJhbnNwYXJlbmN5IiwKCQkiWk9mZnNldCIsCgoJCSJOYW1lIiwKCQkiRW1pc3Npb25EaXJlY3Rpb24iLAoJCSJFbmFibGVkIiwKCQkiTGlmZXRpbWUiLAoJCSJSYXRlIiwKCQkiUm90YXRpb24iLAoJCSJSb3RTcGVlZCIsCgkJIlNwZWVkIiwKCQkiU3ByZWFkQW5nbGUiLAoKCQkiU2hhcGUiLAoJCSJTaGFwZUluT3V0IiwKCQkiU2hhcGVTdHlsZSIsCgoJCSJGbGlwYm9va0xheW91dCIsCgkJIkZsaXBib29rTW9kZSIsCgoJCSJBY2NlbGVyYXRpb24iLAoKCQkiRHJhZyIsCgkJIkxvY2tlZFRvUGFydCIsCgkJIlRpbWVTY2FsZSIsCgkJIlZlbG9jaXR5SW5oZXJpdGFuY2UiLAoJCSJXaW5kQWZmZWN0c0RyYWciCgl9LAoJQmVhbSA9IHsKCQkiQ29sb3IiLAoJCSJFbmFibGVkIiwKCQkiTGlnaHRFbWlzc2lvbiIsCgkJIkxpZ2h0SW5mbHVlbmNlIiwKCQkiVGV4dHVyZSIsCgkJIlRleHR1cmVMZW5ndGgiLAoJCSJUZXh0dXJlTW9kZSIsCgkJIlRleHR1cmVTcGVlZCIsCgkJIlRyYW5zcGFyZW5jeSIsCgkJIlpPZmZzZXQiLAoKCQkiTmFtZSIsCgoJCSJBdHRhY2htZW50MCIsCgkJIkF0dGFjaG1lbnQxIiwKCQkiQ3VydmVTaXplMCIsCgkJIkN1cnZlU2l6ZTEiLAoJCSJGYWNlQ2FtZXJhIiwKCQkiU2VnbWVudHMiLAoJCSJXaWR0aDAiLAoJCSJXaWR0aDEiCgl9LAoJVHJhaWwgPSB7CgkJIkF0dGFjaG1lbnQwIiwKCQkiQXR0YWNobWVudDEiLAoJCSJDb2xvciIsCgkJIkVuYWJsZWQiLAoJCSJGYWNlQ2FtZXJhIiwKCQkiTGlnaHRFbWlzc2lvbiIsCgkJIkxpZ2h0SW5mbHVlbmNlIiwKCQkiTGlmZXRpbWUiLAoJCSJNYXhMZW5ndGgiLAoJCSJNaW5MZW5ndGgiLAoJCSJUZXh0dXJlIiwKCQkiVGV4dHVyZUxlbmd0aCIsCgkJIlRleHR1cmVNb2RlIiwKCQkiVHJhbnNwYXJlbmN5IiwKCQkiV2lkdGhTY2FsZSIsCgkJIkJyaWdodG5lc3MiLAoJCSJOYW1lIgoJfSwKCUhpZ2hsaWdodCA9IHsKCQkiQWRvcm5lZSIsCgkJIkRlcHRoTW9kZSIsCgkJIkVuYWJsZWQiLAoJCSJGaWxsQ29sb3IiLAoJCSJGaWxsVHJhbnNwYXJlbmN5IiwKCQkiT3V0bGluZUNvbG9yIiwKCQkiT3V0bGluZVRyYW5zcGFyZW5jeSIsCgkJIk5hbWUiCgl9LAoJQXR0YWNobWVudCA9IHsKCQkiVmlzaWJsZSIsCgoJCSJOYW1lIiwKCgkJIkNGcmFtZSIKCX0sCn0KCmxvY2FsIElWX0NMQVNTTkFNRVMgPSB7fQoKZm9yIGkgaW4gTVVUQUJMRV9QUk9QRVJUSUVTIGRvCglJVl9DTEFTU05BTUVTWyNJVl9DTEFTU05BTUVTICsgMV0gPSBpCmVuZAoKbG9jYWwgVklfQ0xBU1NOQU1FUyA9IGludmVydF90YWJsZShJVl9DTEFTU05BTUVTKQoKbG9jYWwgSVZfUFJPUEVSVFlfVFlQRVMgPSB7Cgkic3RyaW5nIiwKCSJudW1iZXIiLAoJImJvb2xlYW4iLAoKCSJOdW1iZXJSYW5nZSIsCgkiTnVtYmVyU2VxdWVuY2UiLAoKCSJWZWN0b3IyIiwKCSJWZWN0b3IzIiwKCgkiQ29sb3IzIiwKCSJDb2xvclNlcXVlbmNlIiwKCgkiRW51bUl0ZW0iLAoKCSJDRnJhbWUiLAoKCSJJbnN0YW5jZSIKfQoKbG9jYWwgVklfUFJPUEVSVFlfVFlQRVMgPSBpbnZlcnRfdGFibGUoSVZfUFJPUEVSVFlfVFlQRVMpCgpsb2NhbCBERUZBVUxUX0lOU1RBTkNFUyA9IHt9Cgpmb3IgY2xhc3NOYW1lIGluIE1VVEFCTEVfUFJPUEVSVElFUyBkbwoJbG9jYWwgc3VjY2VzcywgXyA9IHBjYWxsKGZ1bmN0aW9uKCkKCQlERUZBVUxUX0lOU1RBTkNFU1tjbGFzc05hbWVdID0gSW5zdGFuY2VfbmV3KGNsYXNzTmFtZSkKCWVuZCkKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBJbnRlcm5hbCBBUEkKCmxvY2FsIGdpdmVfd2FybmluZ3MgPSBmYWxzZQoKbG9jYWwgc2NvcGUgPSBuaWwKCmxvY2FsIHVpZF9jb3VudGVyID0gMApsb2NhbCB1aWRfcmVmZXJlbmNlID0ge30KCmxvY2FsIHNraXBwZWRfaW5zdGFuY2VzID0gMApsb2NhbCBza2lwcGVkX2luc3RhbmNlX3R5cGVzID0ge30KCmxvY2FsIHBvc3RfZGVzZXJpYWxpemVfbGlua3NfY291bnRlciA9IDAKbG9jYWwgcG9zdF9kZXNlcmlhbGl6ZV9saW5rcyA9IHt9Cgpsb2NhbCBmdW5jdGlvbiByZXNldF9pbnRlcm5hbF92YXJpYWJsZXMoKQoJc2NvcGUgPSBuaWwKCgl1aWRfY291bnRlciA9IDAKCXVpZF9yZWZlcmVuY2UgPSB7fQoKCXNraXBwZWRfaW5zdGFuY2VzID0gMAoJc2tpcHBlZF9pbnN0YW5jZV90eXBlcyA9IHt9CgoJcG9zdF9kZXNlcmlhbGl6ZV9saW5rc19jb3VudGVyID0gMAoJcG9zdF9kZXNlcmlhbGl6ZV9saW5rcyA9IHt9CmVuZAoKbG9jYWwgZnVuY3Rpb24gYnVpbGRfdWlkX3JlZmVyZW5jZShpbnN0YW5jZSkKCXVpZF9jb3VudGVyICs9IDEKCXVpZF9yZWZlcmVuY2VbaW5zdGFuY2VdID0gdWlkX2NvdW50ZXIKCglsb2NhbCBjaGlsZHJlbiA9IGluc3RhbmNlOkdldENoaWxkcmVuKCkKCWZvciBpIGluIGNoaWxkcmVuIGRvCgkJYnVpbGRfdWlkX3JlZmVyZW5jZShjaGlsZHJlbltpXSkKCWVuZAplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gU2VyaWFsaXplcgoKbG9jYWwgZnVuY3Rpb24gc2VyaWFsaXplX3Byb3BlcnR5KHApCglsb2NhbCBfdHlwZSA9IHR5cGVvZihwKQoKCWxvY2FsIHByb3BfdHlwZSA9IFZJX1BST1BFUlRZX1RZUEVTW190eXBlXQoJaWYgbm90IHByb3BfdHlwZSB0aGVuCgkJcmV0dXJuIG5pbAoJZW5kCgoJbG9jYWwgdmFsdWUgPSBuaWwKCglpZiBfdHlwZSA9PSAic3RyaW5nIiB0aGVuCgkJdmFsdWUgPSBwCgoJZWxzZWlmIF90eXBlID09ICJudW1iZXIiIHRoZW4KCQl2YWx1ZSA9IHAKCgllbHNlaWYgX3R5cGUgPT0gImJvb2xlYW4iIHRoZW4KCQl2YWx1ZSA9IHAKCgllbHNlaWYgX3R5cGUgPT0gIlZlY3RvcjMiIHRoZW4KCQl2YWx1ZSA9IHtwLlgsIHAuWSwgcC5afQoKCWVsc2VpZiBfdHlwZSA9PSAiQ29sb3IzIiB0aGVuCgkJdmFsdWUgPSB7cC5SLCBwLkcsIHAuQn0KCgllbHNlaWYgX3R5cGUgPT0gIkVudW1JdGVtIiB0aGVuCgkJdmFsdWUgPSBwLlZhbHVlCgoJZWxzZWlmIF90eXBlID09ICJJbnN0YW5jZSIgdGhlbgoJCWlmIG5vdCBwOklzRGVzY2VuZGFudE9mKHNjb3BlKSB0aGVuCgkJCS0td2FybigiT2JqZWN0LXR5cGUgcHJvcGVydHkgcmVmZXJlbmNlcyAnIiAuLiBwLk5hbWUgLi4gCgkJCS0tCSInIHdoaWNoIGlzIG5vdCBpbiB0aGUgc2VyaWFsaXphdGlvbiBzY29wZS4iCgkJCS0tKQoKCQkJcmV0dXJuIG5pbAoJCWVsc2UKCQkJdmFsdWUgPSB1aWRfcmVmZXJlbmNlW3BdCgkJZW5kCgoJZWxzZWlmIF90eXBlID09ICJDRnJhbWUiIHRoZW4KCQl2YWx1ZSA9IHRhYmxlX3BhY2socDpHZXRDb21wb25lbnRzKCkpCgoJZWxzZWlmIF90eXBlID09ICJWZWN0b3IyIiB0aGVuCgkJdmFsdWUgPSB7cC5YLCBwLll9CgoJZWxzZWlmIF90eXBlID09ICJDb2xvclNlcXVlbmNlIiB0aGVuCgkJdmFsdWUgPSB7fQoKCQlsb2NhbCBrcHMgPSBwLktleXBvaW50cwoJCWZvciBpIGluIGtwcyBkbwoJCQlsb2NhbCBrcCA9IGtwc1tpXQoJCQlsb2NhbCBrcGMgPSBrcC5WYWx1ZQoKCQkJdmFsdWVbaV0gPSB7a3AuVGltZSwga3BjLlIsIGtwYy5HLCBrcGMuQn0KCQllbmQKCgllbHNlaWYgX3R5cGUgPT0gIk51bWJlclJhbmdlIiB0aGVuCgkJdmFsdWUgPSB7cC5NaW4sIHAuTWF4fQoKCWVsc2VpZiBfdHlwZSA9PSAiTnVtYmVyU2VxdWVuY2UiIHRoZW4KCQl2YWx1ZSA9IHt9CgoJCWxvY2FsIGtwcyA9IHAuS2V5cG9pbnRzCgkJZm9yIGkgaW4ga3BzIGRvCgkJCWxvY2FsIGtwID0ga3BzW2ldCgoJCQl2YWx1ZVtpXSA9IHtrcC5UaW1lLCBrcC5WYWx1ZSwga3AuRW52ZWxvcGV9CgkJZW5kCgoJZW5kCgoJcmV0dXJuIHsKCQlwcm9wX3R5cGUsCgkJdmFsdWUKCX0KZW5kCgpsb2NhbCBmdW5jdGlvbiBzZXJpYWxpemVfaW5zdGFuY2Uob2JqKQoJbG9jYWwgY2xhc3NfbmFtZSA9IG9iai5DbGFzc05hbWUKCglsb2NhbCBwcm9wX3Bvb2wgPSBNVVRBQkxFX1BST1BFUlRJRVNbY2xhc3NfbmFtZV0KCglsb2NhbCBwcm9wcyA9IHt9CgoJbG9jYWwgZGVmYXVsdEluc3QgPSBERUZBVUxUX0lOU1RBTkNFU1tjbGFzc19uYW1lXQoKCWZvciBpIGluIHByb3BfcG9vbCBkbwoJCWxvY2FsIHAgPSBwcm9wX3Bvb2xbaV0KCQlpZiBkZWZhdWx0SW5zdCBhbmQgZGVmYXVsdEluc3RbcF0gPT0gb2JqW3BdIHRoZW4KCQkJY29udGludWUKCQllbmQKCQlwcm9wc1twXSA9IHNlcmlhbGl6ZV9wcm9wZXJ0eShvYmpbcF0pCgllbmQKCglsb2NhbCBjaGlsZHJlbl9jb3VudGVyID0gMAoJbG9jYWwgY2hpbGRyZW4gPSB7fQoKCWxvY2FsIGNoaWxkX3Bvb2wgPSBvYmo6R2V0Q2hpbGRyZW4oKQoJZm9yIGkgaW4gY2hpbGRfcG9vbCBkbwoJCWxvY2FsIGMgPSBjaGlsZF9wb29sW2ldCgkJaWYgbm90IE1VVEFCTEVfUFJPUEVSVElFU1tjLkNsYXNzTmFtZV0gdGhlbgoJCQlza2lwcGVkX2luc3RhbmNlX3R5cGVzW2MuQ2xhc3NOYW1lXSA9IDEKCQkJc2tpcHBlZF9pbnN0YW5jZXMgKz0gMQoKCQkJY29udGludWUKCQllbmQKCQljaGlsZHJlbl9jb3VudGVyICs9IDEKCQljaGlsZHJlbltjaGlsZHJlbl9jb3VudGVyXSA9IHNlcmlhbGl6ZV9pbnN0YW5jZShjKQoJZW5kIAoKCWxvY2FsIGF0dHJpYnV0ZXMgPSB7fQoJbG9jYWwgYXR0cyA9IG9iajpHZXRBdHRyaWJ1dGVzKCkKCWZvciBrLCB2IGluIHBhaXJzKGF0dHMpIGRvCgkJaWYgc3RyaW5nLnN1YihrLCAxLCAzKSB+PSAiUkJYIiB0aGVuCgkJCWF0dHJpYnV0ZXNba10gPSBzZXJpYWxpemVfcHJvcGVydHkodikKCQllbmQKCWVuZAoKCXJldHVybiB7CgkJdWlkX3JlZmVyZW5jZVtvYmpdLAoJCVZJX0NMQVNTTkFNRVNbY2xhc3NfbmFtZV0sCgkJcHJvcHMsCgkJY2hpbGRyZW4sCgkJYXR0cmlidXRlcwoJfQplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gRGVzZXJpYWxpemVyCgpsb2NhbCBmdW5jdGlvbiBwb3N0X2Rlc2VyaWFsaXplX2xpbmtfcGFzcygpCglmb3IgaSBpbiBwb3N0X2Rlc2VyaWFsaXplX2xpbmtzIGRvCgkJbG9jYWwgdiA9IHBvc3RfZGVzZXJpYWxpemVfbGlua3NbaV0KCQl2WzFdW3ZbMl1dID0gdWlkX3JlZmVyZW5jZVt2WzNdXQoJZW5kCmVuZAoKCmxvY2FsIGZ1bmN0aW9uIGRlc2VyaWFsaXplX3Byb3BlcnR5KHByb3BlcnR5LCBwcm9wX25hbWUsIGluc3RhbmNlKQoJbG9jYWwgcHJvcF90eXBlID0gSVZfUFJPUEVSVFlfVFlQRVNbcHJvcGVydHlbMV1dCglsb2NhbCB2YWx1ZSA9IHByb3BlcnR5WzJdCgoJbG9jYWwgcmVzdWx0ID0gbmlsCgoJaWYgcHJvcF90eXBlID09ICJzdHJpbmciIHRoZW4KCQlyZXN1bHQgPSB2YWx1ZQoKCWVsc2VpZiBwcm9wX3R5cGUgPT0gIm51bWJlciIgdGhlbgoJCXJlc3VsdCA9IHZhbHVlCgoJZWxzZWlmIHByb3BfdHlwZSA9PSAiYm9vbGVhbiIgdGhlbgoJCXJlc3VsdCA9IHZhbHVlCgoJZWxzZWlmIHByb3BfdHlwZSA9PSAiVmVjdG9yMyIgdGhlbgoJCXJlc3VsdCA9IFZlY3RvcjNfbmV3KHZhbHVlWzFdLCB2YWx1ZVsyXSwgdmFsdWVbM10pCgoJZWxzZWlmIHByb3BfdHlwZSA9PSAiQ29sb3IzIiB0aGVuCgkJcmVzdWx0ID0gQ29sb3IzX25ldyh2YWx1ZVsxXSwgdmFsdWVbMl0sIHZhbHVlWzNdKQoKCWVsc2VpZiBwcm9wX3R5cGUgPT0gIkVudW1JdGVtIiB0aGVuCgkJcmVzdWx0ID0gdmFsdWUKCgllbHNlaWYgcHJvcF90eXBlID09ICJJbnN0YW5jZSIgdGhlbgoJCXBvc3RfZGVzZXJpYWxpemVfbGlua3NfY291bnRlciArPSAxCgkJcG9zdF9kZXNlcmlhbGl6ZV9saW5rc1twb3N0X2Rlc2VyaWFsaXplX2xpbmtzX2NvdW50ZXJdID0KCQkJe2luc3RhbmNlLCBwcm9wX25hbWUsIHZhbHVlfQoKCWVsc2VpZiBwcm9wX3R5cGUgPT0gIkNGcmFtZSIgdGhlbgoJCXJlc3VsdCA9IENGcmFtZV9uZXcodGFibGVfdW5wYWNrKHZhbHVlKSkKCgllbHNlaWYgcHJvcF90eXBlID09ICJWZWN0b3IyIiB0aGVuCgkJcmVzdWx0ID0gVmVjdG9yMl9uZXcodmFsdWVbMV0sIHZhbHVlWzJdKQoKCWVsc2VpZiBwcm9wX3R5cGUgPT0gIkNvbG9yU2VxdWVuY2UiIHRoZW4KCQlsb2NhbCBrcHMgPSB7fQoKCQlmb3IgaSBpbiB2YWx1ZSBkbwoJCQlsb2NhbCB2ID0gdmFsdWVbaV0KCQkJa3BzW2ldID0gQ29sb3JTZXF1ZW5jZUtleXBvaW50X25ldygKCQkJCXZbMV0sIENvbG9yM19uZXcodlsyXSwgdlszXSwgdls0XSkKCQkJKQoJCWVuZAoKCQlyZXN1bHQgPSBDb2xvclNlcXVlbmNlX25ldyhrcHMpCgoJZWxzZWlmIHByb3BfdHlwZSA9PSAiTnVtYmVyUmFuZ2UiIHRoZW4KCQlyZXN1bHQgPSBOdW1iZXJSYW5nZV9uZXcodmFsdWVbMV0sIHZhbHVlWzJdKQoKCWVsc2VpZiBwcm9wX3R5cGUgPT0gIk51bWJlclNlcXVlbmNlIiB0aGVuCgkJbG9jYWwga3BzID0ge30KCgkJZm9yIGkgaW4gdmFsdWUgZG8KCQkJbG9jYWwgdiA9IHZhbHVlW2ldCgkJCWtwc1tpXSA9IE51bWJlclNlcXVlbmNlS2V5cG9pbnRfbmV3KAoJCQkJdlsxXSwgdlsyXSwgdlszXQoJCQkpCgkJZW5kCgoJCXJlc3VsdCA9IE51bWJlclNlcXVlbmNlX25ldyhrcHMpCgoJZW5kCgoJcmV0dXJuIHJlc3VsdAplbmQKCmxvY2FsIGZ1bmN0aW9uIGhhc1Byb3BlcnR5KG9iamVjdDogSW5zdGFuY2UsIHByb3BlcnR5TmFtZTogc3RyaW5nKTogYm9vbGVhbgoJbG9jYWwgc3VjY2VzcywgXyA9IHBjYWxsKGZ1bmN0aW9uKCkgCgkJb2JqZWN0W3Byb3BlcnR5TmFtZV0gPSBvYmplY3RbcHJvcGVydHlOYW1lXQoJZW5kKQoJcmV0dXJuIHN1Y2Nlc3MKZW5kCgpsb2NhbCBmdW5jdGlvbiBkZXNlcmlhbGl6ZV9pbnN0YW5jZShvYmosIHBhcmVudCkKCWxvY2FsIGluc3RhbmNlOwoJbG9jYWwgaW5zdGFuY2VUeXBlID0gSVZfQ0xBU1NOQU1FU1tvYmpbMl1dCgoJaWYgaW5zdGFuY2VUeXBlID09ICJNZXNoUGFydCIgYW5kIG9ialszXS5NZXNoSWQgdGhlbgoJCWxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJcmV0dXJuIEluc2VydFNlcnZpY2U6Q3JlYXRlTWVzaFBhcnRBc3luYyhvYmpbM10uTWVzaElkWzJdLCBFbnVtLkNvbGxpc2lvbkZpZGVsaXR5LlByZWNpc2VDb252ZXhEZWNvbXBvc2l0aW9uLCBFbnVtLlJlbmRlckZpZGVsaXR5LlByZWNpc2UpCgkJZW5kKQoJCWlmIHN1Y2Nlc3MgdGhlbgoJCQlpbnN0YW5jZSA9IHJlc3VsdAoJCWVsc2UKCQkJaW5zdGFuY2UgPSBJbnN0YW5jZV9uZXcoIk1lc2hQYXJ0IikKCQllbmQKCWVsc2VpZiBpbnN0YW5jZVR5cGUgPT0gIkxpZ2h0aW5nIiB0aGVuCgkJcmV0dXJuIG5pbAoJZWxzZQoJCWxvY2FsIHN1Y2Nlc3MsIHJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkgcmV0dXJuIEluc3RhbmNlX25ldyhpbnN0YW5jZVR5cGUpIGVuZCkKCQlpZiBzdWNjZXNzIHRoZW4KCQkJaW5zdGFuY2UgPSByZXN1bHQKCQllbHNlCgkJCXJldHVybiBuaWwKCQllbmQKCWVuZAoKCWlmIG5vdCBpbnN0YW5jZSB0aGVuIHJldHVybiBuaWwgZW5kCgoJZm9yIGkgaW4gb2JqWzRdIGRvCgkJZGVzZXJpYWxpemVfaW5zdGFuY2Uob2JqWzRdW2ldLCBpbnN0YW5jZSkKCWVuZAoKCWZvciBuYW1lIGluIG9ialszXSBkbwoJCWlmIG5hbWUgPT0gIk1lc2hJZCIgdGhlbiBjb250aW51ZSBlbmQKCgkJbG9jYWwgdmFsID0gZGVzZXJpYWxpemVfcHJvcGVydHkob2JqWzNdW25hbWVdLCBuYW1lLCBpbnN0YW5jZSkKCgkJaWYgaGFzUHJvcGVydHkoaW5zdGFuY2UsIG5hbWUpIHRoZW4KCQkJaW5zdGFuY2VbbmFtZV0gPSB2YWwKCQllbmQKCWVuZAoKCWlmIG9ials1XSB0aGVuCgkJZm9yIG5hbWUsIHZhbCBpbiBwYWlycyhvYmpbNV0pIGRvCgkJCWlmIHN0cmluZy5zdWIobmFtZSwgMSwgMykgfj0gIlJCWCIgdGhlbgoJCQkJbG9jYWwgcHJvcGVydHlWYWx1ZSA9IGRlc2VyaWFsaXplX3Byb3BlcnR5KHZhbCwgbmFtZSwgaW5zdGFuY2UpCgkJCQlpZiBwcm9wZXJ0eVZhbHVlIH49IG5pbCB0aGVuCgkJCQkJaW5zdGFuY2U6U2V0QXR0cmlidXRlKG5hbWUsIHByb3BlcnR5VmFsdWUpCgkJCQllbmQKCQkJZW5kCgkJZW5kCgllbmQKCgl1aWRfcmVmZXJlbmNlW29ialsxXV0gPSBpbnN0YW5jZQoKCWluc3RhbmNlLlBhcmVudCA9IHBhcmVudCBvciBERVNFUklBTElaRV9ERUZBVUxUX1BBUkVOVAoKCXJldHVybiBpbnN0YW5jZQplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIEV4cG9zZWQgQVBJCgpsb2NhbCByb3NlID0ge30KCmZ1bmN0aW9uIHJvc2Uuc2VyaWFsaXplKGluc3RhbmNlKQoJaWYgbm90IE1VVEFCTEVfUFJPUEVSVElFU1tpbnN0YW5jZS5DbGFzc05hbWVdIHRoZW4KCQl3YXJuKCJHaXZlbiBpbnN0YW5jZSB3YXMgbm90IHNlcmlhbGl6YWJsZSIpCgkJcmV0dXJuIG5pbAoJZW5kCgoJcmVzZXRfaW50ZXJuYWxfdmFyaWFibGVzKCkKCglidWlsZF91aWRfcmVmZXJlbmNlKGluc3RhbmNlKQoKCXNjb3BlID0gaW5zdGFuY2UKCglsb2NhbCByZXN1bHQgPSBzZXJpYWxpemVfaW5zdGFuY2UoaW5zdGFuY2UpCgoJaWYgc2tpcHBlZF9pbnN0YW5jZXMgfj0gMCBhbmQgZ2l2ZV93YXJuaW5ncyB0aGVuCgkJd2FybigiUk9TRSAtIFNvbWUgaW5zdGFuY2Uocykgd2VyZSBub3Qgc2VyaWFsaXplZDoiKQoJCWZvciBpIGluIHNraXBwZWRfaW5zdGFuY2VfdHlwZXMgZG8KCQkJd2FybigiICAgIFR5cGUgJyIgLi4gaSAuLiAiJyIpCgkJZW5kCgllbmQKCglyZXR1cm4gewoJCVsidmVyc2lvbiJdID0gUk9TRV9WRVJTSU9OLAoJCVsidHJlZSJdID0gcmVzdWx0Cgl9CmVuZAoKZnVuY3Rpb24gcm9zZS5kZXNlcmlhbGl6ZShwYWNrZXQpCglpZiBwYWNrZXQudmVyc2lvbiB+PSBST1NFX1ZFUlNJT04gdGhlbgoJCXdhcm4oIlJPU0UgcGFja2V0IHByb3ZpZGVkIHdhcyBnZW5lcmF0ZWQgYnkgYW4gb2xkZXIgdmVyc2lvbiBvZiBST1NFLiIpCgkJcmV0dXJuIG5pbAoJZW5kCgoJcmVzZXRfaW50ZXJuYWxfdmFyaWFibGVzKCkKCglsb2NhbCByZXN1bHQgPSBkZXNlcmlhbGl6ZV9pbnN0YW5jZShwYWNrZXQudHJlZSkKCglwb3N0X2Rlc2VyaWFsaXplX2xpbmtfcGFzcygpCgoJcmV0dXJuIHJlc3VsdAplbmQKCmZ1bmN0aW9uIHJvc2UuYXBwbHlfdG9fbGlnaHRpbmcocGFja2V0KQoJaWYgcGFja2V0LnZlcnNpb24gfj0gUk9TRV9WRVJTSU9OIHRoZW4KCQl3YXJuKCJST1NFIHBhY2tldCBwcm92aWRlZCB3YXMgZ2VuZXJhdGVkIGJ5IGFuIG9sZGVyIHZlcnNpb24gb2YgUk9TRS4iKQoJCXJldHVybgoJZW5kCgoJcmVzZXRfaW50ZXJuYWxfdmFyaWFibGVzKCkKCglsb2NhbCBvYmogPSBwYWNrZXQudHJlZQoJbG9jYWwgaW5zdGFuY2VUeXBlID0gSVZfQ0xBU1NOQU1FU1tvYmpbMl1dCgoJaWYgaW5zdGFuY2VUeXBlIH49ICJMaWdodGluZyIgdGhlbgoJCXdhcm4oIlBhY2tldCBpcyBub3QgYSBMaWdodGluZyBvYmplY3QiKQoJCXJldHVybgoJZW5kCgoJZm9yIG5hbWUgaW4gb2JqWzNdIGRvCgkJbG9jYWwgdmFsID0gZGVzZXJpYWxpemVfcHJvcGVydHkob2JqWzNdW25hbWVdLCBuYW1lLCBMaWdodGluZ1NlcnZpY2UpCgkJcGNhbGwoZnVuY3Rpb24oKQoJCQkoTGlnaHRpbmdTZXJ2aWNlIDo6IGFueSlbbmFtZV0gPSB2YWwKCQllbmQpCgllbmQKCglpZiBvYmpbNV0gdGhlbgoJCWZvciBuYW1lLCB2YWwgaW4gcGFpcnMob2JqWzVdKSBkbwoJCQlpZiBzdHJpbmcuc3ViKG5hbWUsIDEsIDMpIH49ICJSQlgiIHRoZW4KCQkJCWxvY2FsIHByb3BlcnR5VmFsdWUgPSBkZXNlcmlhbGl6ZV9wcm9wZXJ0eSh2YWwsIG5hbWUsIExpZ2h0aW5nU2VydmljZSkKCQkJCWlmIHByb3BlcnR5VmFsdWUgfj0gbmlsIHRoZW4KCQkJCQlMaWdodGluZ1NlcnZpY2U6U2V0QXR0cmlidXRlKG5hbWUsIHByb3BlcnR5VmFsdWUpCgkJCQllbmQKCQkJZW5kCgkJZW5kCgllbmQKCglsb2NhbCByZW1vdmFibGVDbGFzc2VzID0gewoJCSJCbG9vbUVmZmVjdCIsICJCbHVyRWZmZWN0IiwgIkNvbG9yQ29ycmVjdGlvbkVmZmVjdCIsICJDb2xvckdyYWRpbmdFZmZlY3QiLAoJCSJEZXB0aE9mRmllbGRFZmZlY3QiLCAiU3VuUmF5c0VmZmVjdCIsICJBdG1vc3BoZXJlIiwgCgkJIkNsb3VkcyIsICJTa3kiLCAiRm9sZGVyIgoJfQoJZm9yIF8sIGNoaWxkIGluIExpZ2h0aW5nU2VydmljZTpHZXRDaGlsZHJlbigpIGRvCgkJaWYgdGFibGUuZmluZChyZW1vdmFibGVDbGFzc2VzLCBjaGlsZC5DbGFzc05hbWUpIHRoZW4KCQkJY2hpbGQ6RGVzdHJveSgpCgkJZW5kCgllbmQKCglmb3IgaSBpbiBvYmpbNF0gZG8KCQlkZXNlcmlhbGl6ZV9pbnN0YW5jZShvYmpbNF1baV0sIExpZ2h0aW5nU2VydmljZSkKCWVuZAoKCXBvc3RfZGVzZXJpYWxpemVfbGlua19wYXNzKCkKZW5kCgpmdW5jdGlvbiByb3NlLmdpdmVfd2FybmluZ3ModmFsdWU6IGJvb2xlYW4pCglnaXZlX3dhcm5pbmdzID0gdmFsdWUKZW5kCgpmdW5jdGlvbiByb3NlLmdldF9wcm9wZXJ0aWVzKGluc3RhbmNlKQoJbG9jYWwgY2xhc3NOYW1lID0gaW5zdGFuY2UuQ2xhc3NOYW1lCglsb2NhbCBwcm9wcyA9IE1VVEFCTEVfUFJPUEVSVElFU1tjbGFzc05hbWVdIG9yIHt9Cglsb2NhbCBkYXRhID0ge30KCglmb3IgXywgcHJvcE5hbWUgaW4gaXBhaXJzKHByb3BzKSBkbwoJCWxvY2FsIHMsIHYgPSBwY2FsbChmdW5jdGlvbigpIHJldHVybiBpbnN0YW5jZVtwcm9wTmFtZV0gZW5kKQoJCWlmIHMgdGhlbgoJCQlkYXRhW3Byb3BOYW1lXSA9IHYKCQllbmQKCWVuZAoJcmV0dXJuIGRhdGEKZW5kCgpyZXR1cm4gcm9zZQ=="
  },
  "Leaning": {
    "Type": "Local",
    "Code": "Ci0tLy8gVGhpcyBzY3JpcHQgbWFrZXMgeW91ciBjaGFyYWN0ZXIgbGVhbiBpbiB0aGUgZGlyZWN0aW9uIHlvdSdyZSB3YWxraW5nCi0tLy8gV291bGQgcmVjb21tZW5kIHVzaW5nIHRoaXMgd2l0aCBTbW9vdGhDYW1lcmEgZm9yIG1vcmUgaW50ZXJhY3RpdmUgbW92ZW1lbnQKCmxvY2FsIHJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQoKbG9jYWwgTU9NRU5UVU1fRkFDVE9SID0gMC4wMDAxCmxvY2FsIE1JTl9NT01FTlRVTSA9IDAuMQpsb2NhbCBNQVhfTU9NRU5UVU0gPSAwLjE1CmxvY2FsIFNQRUVEID0gMTUKCmxvY2FsIGNoYXJhY3RlciA9IHNjcmlwdC5QYXJlbnQKbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXIuSHVtYW5vaWQKbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CmxvY2FsIG02ZCA9IG5pbApsb2NhbCBvcmlnaW5hbE02ZEMwID0gbmlsCgppZiBodW1hbm9pZC5SaWdUeXBlID09IEVudW0uSHVtYW5vaWRSaWdUeXBlLlIxNSB0aGVuCglsb2NhbCBsb3dlclRvcnNvID0gY2hhcmFjdGVyLkxvd2VyVG9yc28KCW02ZCA9IGxvd2VyVG9yc28uUm9vdAplbHNlCgltNmQgPSBodW1hbm9pZFJvb3RQYXJ0LlJvb3RKb2ludAplbmQKb3JpZ2luYWxNNmRDMCA9IG02ZC5DMAoKcnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbihkdCkKCWxvY2FsIGRpcmVjdGlvbiA9IGh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lOlZlY3RvclRvT2JqZWN0U3BhY2UoaHVtYW5vaWQuTW92ZURpcmVjdGlvbikKCWxvY2FsIG1vbWVudHVtID0gaHVtYW5vaWRSb290UGFydC5DRnJhbWU6VmVjdG9yVG9PYmplY3RTcGFjZShodW1hbm9pZFJvb3RQYXJ0LlZlbG9jaXR5KSpNT01FTlRVTV9GQUNUT1IKCW1vbWVudHVtID0gVmVjdG9yMy5uZXcoCgkJbWF0aC5jbGFtcChtYXRoLmFicyhtb21lbnR1bS5YKSwgTUlOX01PTUVOVFVNLCBNQVhfTU9NRU5UVU0pLAoJCTAsCgkJbWF0aC5jbGFtcChtYXRoLmFicyhtb21lbnR1bS5aKSwgTUlOX01PTUVOVFVNLCBNQVhfTU9NRU5UVU0pCgkpCgoJbG9jYWwgeCA9IGRpcmVjdGlvbi5YKm1vbWVudHVtLlgKCWxvY2FsIHogPSAoZGlyZWN0aW9uLloqbW9tZW50dW0uWikgLyAyCgoJbG9jYWwgYW5nbGVzID0gbmlsCglpZiBodW1hbm9pZC5SaWdUeXBlID09IEVudW0uSHVtYW5vaWRSaWdUeXBlLlIxNSB0aGVuCgkJYW5nbGVzID0ge3osIDAsIC14fQoJZWxzZQoJCWFuZ2xlcyA9IHsteiwgLXgsIDB9CgllbmQKCgltNmQuQzAgPSBtNmQuQzA6TGVycChvcmlnaW5hbE02ZEMwKkNGcmFtZS5BbmdsZXModW5wYWNrKGFuZ2xlcykpLCBkdCpTUEVFRCkKZW5kKQ=="
  },
  "SmoothCamera": {
    "Type": "Local",
    "Code": "LS0vLyBNYWtlcyB5b3VyIGNhbWVyYSBmb2xsb3cgeW91ciBjaGFyYWN0ZXJzIG1vdmVtZW50cyBtb3JlIGFjY3VyYXRlbHkKLS0vLyBMb29rcyB2IG5pY2Ugd2l0aCBhbmltYXRpb25zCgpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCgpsb2NhbCBQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIENoYXJhY3RlcjogTW9kZWwKbG9jYWwgSHVtYW5vaWQ6IEh1bWFub2lkCmxvY2FsIFJvb3RQYXJ0OiBQYXJ0CgpQbGF5ZXIuQ2hhcmFjdGVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbigpCgkKCVJ1blNlcnZpY2U6VW5iaW5kRnJvbVJlbmRlclN0ZXAoIkZvbGxvd0hlYWQiKQoJCmVuZCkKClBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKENoYXIpCgkKCUNoYXJhY3RlciA9IENoYXIKCUh1bWFub2lkID0gQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWQiKQoJUm9vdFBhcnQgPSBDaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKCQoJUnVuU2VydmljZTpCaW5kVG9SZW5kZXJTdGVwKCJGb2xsb3dIZWFkIiwgRW51bS5SZW5kZXJQcmlvcml0eS5DYW1lcmEuVmFsdWUgKyAxLCBmdW5jdGlvbihEZWx0YVRpbWU6IG51bWJlcikKCQlpZiBub3QgQ2hhcmFjdGVyIG9yIChIdW1hbm9pZDpHZXRTdGF0ZSgpID09IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRGVhZCkgdGhlbgoJCQlyZXR1cm4KCQllbmQKCgoJCWxvY2FsIEhlYWQ6IFBhcnQgPSBDaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIZWFkIikKCgoJCWxvY2FsIE9iamVjdFNwYWNlID0gUm9vdFBhcnQuQ0ZyYW1lOlRvT2JqZWN0U3BhY2UoSGVhZC5DRnJhbWUpCgkJSHVtYW5vaWQuQ2FtZXJhT2Zmc2V0ID0gSHVtYW5vaWQuQ2FtZXJhT2Zmc2V0OkxlcnAoT2JqZWN0U3BhY2UuUG9zaXRpb24gLSBWZWN0b3IzLm5ldygwLCAxLjUsIDApLCBEZWx0YVRpbWUgKiAxMCkKCWVuZCkKCgkKZW5kKQ=="
  },
  "Bezier": {
    "Type": "Module",
    "Code": "LS0gY3JlYXRlZCBieSBiaHJpc3R0IChvY3RvYmVyIDE1IDIwMjEpCi0tIGJlemllciBtb2R1bGUgZm9yIGVhc3kgY3JlYXRpb24gb2YgYmV6aWVyIGN1cnZlcwotLSB1cGRhdGVkIChvY3RvYmVyIDI1IDIwMjEpCi0tIW5vY2hlY2sKCgotLSB0eXBlcwpleHBvcnQgdHlwZSBCZXppZXJQb2ludCA9IHsKCVR5cGU6IHN0cmluZzsKCVBvaW50OiBWZWN0b3IzIHwgQmFzZVBhcnQ7Cn0KCgotLSBiZXppZXIgY2xhc3MKbG9jYWwgQmV6aWVyID0ge30KQmV6aWVyLl9faW5kZXggPSBCZXppZXIKCgotLSBiZXJlbnN0ZWluIHBvbHlub21pYWwgKHVzZWQgaW4gcG9zaXRpb24gYW5kIGRlcml2YXRpdmUgZnVuY3Rpb25zKQpmdW5jdGlvbiBCKG46IG51bWJlciwgaTogbnVtYmVyLCB0OiBudW1iZXIpCgoJLS0gZmFjdG9yaWFsIGZ1bmN0aW9uCglsb2NhbCBmdW5jdGlvbiBmYWN0KG46IG51bWJlcik6IG51bWJlcgoJCWlmIG4gPT0gMCB0aGVuCgkJCXJldHVybiAxCgkJZWxzZQoJCQlyZXR1cm4gbiAqIGZhY3QobiAtIDEpCgkJZW5kCgllbmQKCgktLSByZXR1cm4KCXJldHVybiAoZmFjdChuKSAvIChmYWN0KGkpICogZmFjdChuIC0gaSkpKSAqIHReKGkpICogKDEgLSB0KV4obiAtIGkpCmVuZAoKCi0tIHRoZSBjb25zdHJ1Y3RvcgotLSBjcmVhdGVzIGEgbmV3IEJlemllciBvYmplY3Qgd2l0aCB0aGUgZ2l2ZW4gcG9pbnRzIGFkZGVkIGluIG9yZGVyCmZ1bmN0aW9uIEJlemllci5uZXcoLi4uOiBWZWN0b3IzIHwgQmFzZVBhcnQpCglsb2NhbCBzZWxmID0gc2V0bWV0YXRhYmxlKHt9LCBCZXppZXIpCglsb2NhbCBhcmdzID0gey4uLn0KCQoJLS0gaG9sZHMgdGhlIHBvaW50cwoJc2VsZi5Qb2ludHMgPSB7fQoJCgktLSBsZW5ndGggaW5mb3JtYXRpb24KCXNlbGYuTGVuZ3RoSXRlcmF0aW9ucyA9IDEwMDAKCXNlbGYuTGVuZ3RoSW5kZWNlcyA9IHt9CglzZWxmLkxlbmd0aCA9IDAKCQoJLS0gaG9sZHMgdGhlIGNvbm5lY3Rpb25zIGZyb20gYmFzZXBhcnRzCglzZWxmLl9jb25uZWN0aW9ucyA9IHt9CgkKCS0tIGl0ZXJhdGUgdGhyb3VnaCBnaXZlbiBhcmd1bWVudHMKCWZvciBfLCBwIGluIHBhaXJzKGFyZ3MpIGRvCgkJaWYgdHlwZW9mKHApID09ICJWZWN0b3IzIiBvciAodHlwZW9mKHApID09ICJJbnN0YW5jZSIgYW5kIHA6SXNBKCJCYXNlUGFydCIpKSB0aGVuCgkJCXNlbGY6QWRkQmV6aWVyUG9pbnQocCkKCQllbHNlCgkJCWVycm9yKCJUaGUgQmV6aWVyLm5ldygpIGNvbnN0cnVjdG9yIG9ubHkgdGFrZXMgaW4gVmVjdG9yM3MgYW5kIEJhc2VQYXJ0cyBhcyBpbnB1dHMhIikKCQllbmQKCWVuZAoJCgktLSByZXR1cm5zIHRoZSBiZXppZXIgb2JqZWN0CglyZXR1cm4gc2VsZgplbmQKCgotLSBhZGRzIGEgQmV6aWVyUG9pbnQgdG8gdGhlIEJlemllcgotLSBhIEJlemllclBvaW50IGNhbiBlaXRoZXIgYmUgYSBWZWN0b3IzIG9yIGEgQmFzZVBhcnQKLS0gYSBWZWN0b3IzIEJlemllclBvaW50IGlzIHN0YXRpYywgd2hpbGUgYSBCYXNlUGFydCBCZXppZXJQb2ludCBjaGFuZ2VzIGlmIHRoZSBCYXNlUGFydCdzIHBvc2l0aW9uIGNoYW5nZXMKZnVuY3Rpb24gQmV6aWVyOkFkZEJlemllclBvaW50KHA6IFZlY3RvcjMgfCBCYXNlUGFydCwgaW5kZXg6IG51bWJlcj8pCgkKCS0tIGNoZWNrIGlmIGdpdmVuIHZhbHVlIGlzIGEgVmVjdG9yMyBvciBCYXNlUGFydAoJaWYgcCBhbmQgKHR5cGVvZihwKSA9PSAiSW5zdGFuY2UiIGFuZCBwOklzQSgiQmFzZVBhcnQiKSkgb3IgdHlwZW9mKHApID09ICJWZWN0b3IzIiB0aGVuCgkJbG9jYWwgbmV3UG9pbnQ6IEJlemllclBvaW50ID0gewoJCQlUeXBlID0gdHlwZW9mKHApID09ICJWZWN0b3IzIiBhbmQgIlN0YWljUG9pbnQiIG9yICJCYXNlUGFydFBvaW50IjsKCQkJUG9pbnQgPSBwOwoJCX0KCQkKCQktLSBpZiBwb2ludCBpcyBhIEJhc2VQYXJ0UG9pbnQsIHRoZW4gd2F0Y2ggZm9yIHJlbW92YWwgYW5kIGNoYW5nZXMKCQlpZiBuZXdQb2ludC5UeXBlID09ICJCYXNlUGFydFBvaW50IiB0aGVuCgkJCWxvY2FsIGNvbm5lY3Rpb24sIGNvbm5lY3Rpb24yCgkJCQoJCQktLSBjaGFuZ2VkIGNvbm5lY3Rpb24KCQkJY29ubmVjdGlvbiA9IChwOjogQmFzZVBhcnQpLkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihwcm9wKQoJCQkJaWYgcHJvcCA9PSAiUG9zaXRpb24iIHRoZW4KCQkJCQlzZWxmOlVwZGF0ZUxlbmd0aCgpCgkJCQllbmQKCQkJZW5kKQoJCQkKCQkJLS0gZGVsZXRlZCBjb25uZWN0aW9uCgkJCWNvbm5lY3Rpb24yID0gKHA6OiBCYXNlUGFydCkuQW5jZXN0cnlDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oXywgcGFyZW50KQoJCQkJaWYgcGFyZW50ID09IG5pbCB0aGVuCgkJCQkJbG9jYWwgaW5kZXggPSB0YWJsZS5maW5kKHNlbGYuUG9pbnRzLCBuZXdQb2ludCkKCQkJCQlpZiBpbmRleCB0aGVuCgkJCQkJCXRhYmxlLnJlbW92ZShzZWxmLlBvaW50cywgaW5kZXgpCgkJCQkJZW5kCgkJCQkJY29ubmVjdGlvbjpEaXNjb25uZWN0KCkKCQkJCQljb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQoJCQkJZW5kCgkJCWVuZCkKCQkJCgkJCS0tIGNoZWNrIGlmIHRoZXJlIGlzIGEgY29ubmVjdGlvbiB0YWJsZSBmb3IgdGhlIGJhc2VwYXJ0CgkJCWlmIG5vdCBzZWxmLl9jb25uZWN0aW9uc1twXSB0aGVuCgkJCQlzZWxmLl9jb25uZWN0aW9uc1twXSA9IHt9CgkJCWVuZAoJCQkKCQkJLS0gYWRkIGNvbm5lY3Rpb25zIHRvIGNvbm5lY3Rpb24gdGFibGUKCQkJdGFibGUuaW5zZXJ0KHNlbGYuX2Nvbm5lY3Rpb25zW3BdLCBjb25uZWN0aW9uKQoJCQl0YWJsZS5pbnNlcnQoc2VsZi5fY29ubmVjdGlvbnNbcF0sIGNvbm5lY3Rpb24yKQoJCWVuZAoJCQoJCS0tIGFkZCB0byBsaXN0IG9mIHBvaW50cwoJCWlmIGluZGV4IGFuZCB0eXBlKGluZGV4KSA9PSAibnVtYmVyIiB0aGVuCgkJCQoJCQktLSBmb3VuZCBpbmRleCwgYWRkIGF0IGluZGV4CgkJCXRhYmxlLmluc2VydChzZWxmLlBvaW50cywgaW5kZXgsIG5ld1BvaW50KQoJCWVsc2VpZiBub3QgaW5kZXggdGhlbgoJCQkKCQkJLS0gZGlkIG5vdCBmaW5kIGluZGV4LCBhZGQgdG8gZW5kIG9mIHRhYmxlCgkJCXRhYmxlLmluc2VydChzZWxmLlBvaW50cywgbmV3UG9pbnQpCgkJZWxzZWlmIHR5cGUoaW5kZXgpIH49ICJudW1iZXIiIHRoZW4KCQkJCgkJCS0tIGluY29ycmVjdCB0eXBlCgkJCWVycm9yKCJCZXppZXI6QWRkQmV6aWVyUG9pbnQoKSBvbmx5IGFjY2VwdHMgYW4gaW50ZWdlciBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50ISIpCgkJZW5kCgkJCgkJLS0gdXBkYXRlIGJlemllcgoJCXNlbGY6VXBkYXRlTGVuZ3RoKCkKCWVsc2UKCQllcnJvcigiQmV6aWVyOkFkZEJlemllclBvaW50KCkgb25seSBhY2NlcHRzIGEgVmVjdG9yMyBvciBCYXNlUGFydCBhcyB0aGUgZmlyc3QgYXJndW1lbnQhIikKCWVuZAplbmQKCgotLSBjaGFuZ2VzIGEgQmV6aWVyUG9pbnQgaW4gdGhlIEJlemllcgotLSBvbmx5IHdvcmtzIGlmIHRoZSBCZXppZXJQb2ludCBleGlzdHMgaW4gdGhlIEJlemllcgpmdW5jdGlvbiBCZXppZXI6Q2hhbmdlQmV6aWVyUG9pbnQoaW5kZXg6IG51bWJlciwgcDogVmVjdG9yMyB8IEJhc2VQYXJ0KQoJCgktLSBjaGVjayB0aGF0IGluZGV4IGlzIGEgbnVtYmVyCglpZiB0eXBlKGluZGV4KSB+PSAibnVtYmVyIiB0aGVuCgkJZXJyb3IoIkJlemllcjpDaGFuZ2VCZXppZXJQb2ludCgpIG9ubHkgYWNjZXB0cyBhIG51bWJlciBpbmRleCBhcyB0aGUgZmlyc3QgYXJndW1lbnQhIikKCWVuZAoJCgktLSBjaGVjayBpZiBnaXZlbiB2YWx1ZSBpcyBhIFZlY3RvcjMgb3IgQmFzZVBhcnQKCWlmIHAgYW5kICh0eXBlb2YocCkgPT0gIkluc3RhbmNlIiBhbmQgcDpJc0EoIkJhc2VQYXJ0IikpIG9yIHR5cGVvZihwKSA9PSAiVmVjdG9yMyIgdGhlbgoJCQoJCS0tIGNoZWNrIGlmIHRoZSBiZXppZXIgcG9pbnQgZXhpc3RzCgkJbG9jYWwgQmV6aWVyUG9pbnQgPSBzZWxmLlBvaW50c1tpbmRleF0KCQlpZiBCZXppZXJQb2ludCB0aGVuCgkJCQoJCQktLSBjaGVjayB0eXBlIG9mIHBvaW50IGFuZCBhZGQgdG8gYmV6aWVyCgkJCUJlemllclBvaW50LlR5cGUgPSB0eXBlb2YocCkgPT0gIlZlY3RvcjMiIGFuZCAiU3RhaWNQb2ludCIgb3IgIkJhc2VQYXJ0UG9pbnQiOwoJCQlCZXppZXJQb2ludC5Qb2ludCA9IHAKCQkJCgkJCS0tIHVwZGF0ZSBiZXppZXIKCQkJc2VsZjpVcGRhdGVMZW5ndGgoKQoJCWVsc2UKCQkJCgkJCS0tIGJlemllciBwb2ludCBkb2VzIG5vdCBleGlzdAoJCQllcnJvcigiRGlkIG5vdCBmaW5kIEJlemllclBvaW50IGF0IGluZGV4ICIgLi4gdG9zdHJpbmcoaW5kZXgpKQoJCWVuZAoJZWxzZQoJCQoJCS0tIGluY29ycmVjdCB0eXBlCgkJZXJyb3IoIkJlemllcjpDaGFuZ2VCZXppZXJQb2ludCgpIG9ubHkgYWNjZXB0cyBhIFZlY3RvcjMgb3IgQmFzZVBhcnQgYXMgdGhlIHNlY29uZCBhcmd1bWVudCEiKQoJZW5kCmVuZAoKCi0tIHJldHVybnMgYSB0YWJsZSB3aXRoIHZlY3RvcjMgY29udHJvbCBwb2ludHMgb2YgdGhlIEJlemllcgpmdW5jdGlvbiBCZXppZXI6R2V0QWxsUG9pbnRzKCk6IHtWZWN0b3IzfQoJCgktLSBkZWNsYXJhdGlvbnMKCWxvY2FsIHBvaW50cyA9IHNlbGYuUG9pbnRzCglsb2NhbCBudW1Qb2ludHMgPSAjcG9pbnRzCglsb2NhbCB2M1BvaW50cyA9IHt9CgkKCS0tIGl0ZXJhdGUgdGhyb3VnaCBwb2ludHMKCWZvciBpID0gMSwgbnVtUG9pbnRzIGRvCgkJdGFibGUuaW5zZXJ0KHYzUG9pbnRzLCBzZWxmOkdldFBvaW50KGkpKQoJZW5kCgkKCS0tIHJldHVybiBsaXN0IG9mIHBvaW50cwoJcmV0dXJuIHYzUG9pbnRzCmVuZAoKCi0tIGdldHMgdGhlIEJlemllclBvaW50IG9mIHRoZSBCZXppZXIgYXQgdGhlIGluZGV4CmZ1bmN0aW9uIEJlemllcjpHZXRQb2ludChpOiBudW1iZXIpOiBWZWN0b3IzPwoKCS0tIGNoZWNrcyBmb3IgdHlwZQoJbG9jYWwgcG9pbnRzID0gc2VsZi5Qb2ludHMKCWlmIHBvaW50c1tpXSB0aGVuCgkJcmV0dXJuIHR5cGVvZihwb2ludHNbaV0uUG9pbnQpID09ICJWZWN0b3IzIiBhbmQgcG9pbnRzW2ldLlBvaW50IG9yIHBvaW50c1tpXS5Qb2ludC5Qb3NpdGlvbgoJZWxzZQoJCWVycm9yKCJEaWQgbm90IGZpbmQgYSBCZXppZXJQb2ludCBhdCBpbmRleCAiIC4uIHRvc3RyaW5nKGkpIC4uICIhIikKCWVuZAplbmQKCgotLSByZW1vdmVzIGEgQmV6aWVyUG9pbnQgZnJvbSB0aGUgQmV6aWVyCmZ1bmN0aW9uIEJlemllcjpSZW1vdmVCZXppZXJQb2ludChpbmRleDogbnVtYmVyKQoJCgktLSBjaGVjayBpZiB0aGUgcG9pbnQgZXhpc3RzCglpZiBzZWxmLlBvaW50c1tpbmRleF0gdGhlbgoJCQoJCS0tIHJlbW92ZSBwb2ludCBhbmQgcmVtb3ZlIGNvbm5lY3Rpb25zCgkJbG9jYWwgcG9pbnQgPSB0YWJsZS5yZW1vdmUoc2VsZi5Qb2ludHMsIGluZGV4KQoJCWlmIHR5cGVvZihwb2ludC5Qb2ludCkgPT0gIkluc3RhbmNlIiBhbmQgcG9pbnQuUG9pbnQ6SXNBKCJCYXNlUGFydCIpIHRoZW4KCQkJZm9yIGksIGNvbm5lY3Rpb24gaW4gcGFpcnMoc2VsZi5fY29ubmVjdGlvbnNbcG9pbnQuUG9pbnRdKSBkbwoJCQkJaWYgY29ubmVjdGlvbi5Db25uZWN0ZWQgdGhlbgoJCQkJCWNvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQllbmQKCQkJZW5kCgkJCXNlbGYuX2Nvbm5lY3Rpb25zW3BvaW50LlBvaW50XSA9IG5pbAoJCWVuZAoJCQoJCS0tIHVwZGF0ZSBiZXppZXIKCQlzZWxmOlVwZGF0ZUxlbmd0aCgpCgllbmQKZW5kCgoKLS0gdXBkYXRlcyBsZW5ndGggb2YgdGhlIEJlemllcgpmdW5jdGlvbiBCZXppZXI6VXBkYXRlTGVuZ3RoKCkKCS0tIGltcG9ydGFudCB2YWx1ZXMKCWxvY2FsIHBvaW50cyA9IHNlbGY6R2V0QWxsUG9pbnRzKCkKCWxvY2FsIGl0ZXJhdGlvbnMgPSBzZWxmLkxlbmd0aEl0ZXJhdGlvbnMKCgktLSBjaGVjayBpZiBwb2ludHMgaXMgbGVzcyB0aGFuIDIgKG5lZWQgYXQgbGVhc3QgMiBwb2ludHMgdG8gY2FsY3VsYXRlIGxlbmd0aCkKCWlmICNwb2ludHMgPCAyIHRoZW4KCQlyZXR1cm4gMCwge3swLCAwLCAwfSwgezAsIDAsIDB9fQoJZW5kCgoJLS0gc3RhcnQgaXRlcmF0aW9uCglsb2NhbCBsID0gMAoJbG9jYWwgc3VtcyA9IHt9Cglmb3IgaSA9IDEsIGl0ZXJhdGlvbnMgZG8KCQlsb2NhbCBkbGR0ID0gc2VsZjpDYWxjdWxhdGVEZXJpdmF0aXZlQXQoKGkgLSAxKSAvIChpdGVyYXRpb25zIC0gMSkpCgkJbCArPSBkbGR0Lk1hZ25pdHVkZSAqICgxIC8gaXRlcmF0aW9ucykKCQl0YWJsZS5pbnNlcnQoc3VtcywgeygoaSAtIDEpIC8gKGl0ZXJhdGlvbnMgLSAxKSksIGwsIGRsZHR9KQoJZW5kCgoJLS0gcmV0dXJuIGxlbmd0aCBhbmQgc3VtIHRhYmxlCglzZWxmLkxlbmd0aCwgc2VsZi5MZW5ndGhJbmRlY2VzID0gbCwgc3VtcwplbmQKCgotLSByZXR1cm5zIHRoZSBWZWN0b3IzIHBvaW50IGF0IHRoZSBnaXZlbiB0IHZhbHVlICh0IG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxIHRvIHJldHVybiBhbiBleGNwZWN0ZWQgdmFsdWUpCi0tIGRvZXMgbm90IHdvcmsgaWYgdGhlIGJlemllciBkb2VzIG5vdCBoYXZlIGFueSBwb2ludHMgYXR0YWNoZWQgdG8gaXQKZnVuY3Rpb24gQmV6aWVyOkNhbGN1bGF0ZVBvc2l0aW9uQXQodDogbnVtYmVyKTogVmVjdG9yMwoJCgktLSBjaGVjayBpZiB0IGlzIGJldHdlZW4gMCBhbmQgMQoJaWYgdHlwZSh0KSB+PSAibnVtYmVyIiB0aGVuCgkJZXJyb3IoIkJlemllcjpDYWxjdWxhdGVQb3NpdGlvbkF0KCkgb25seSBhY2NlcHRzIGEgbnVtYmVyLCBnb3QgIiAuLiB0b3N0cmluZyh0KSAuLiAiISIpCgllbmQKCgktLSBzdGFydCBhbGdvcml0aG0gdG8gY2FsY3VsYXRlIHBvc2l0aW9uIGluIGJlemllcgoJbG9jYWwgcG9pbnRzID0gc2VsZi5Qb2ludHMKCWxvY2FsIG51bVBvaW50cyA9ICNwb2ludHMKCQoJLS0gY2hlY2sgaWYgdGhlcmUgaXMgYXQgbGVhc3QgMSBwb2ludAoJaWYgbnVtUG9pbnRzID4gMCB0aGVuCgkJCgkJLS0gaW1wb3J0YW50IHZhbHVlcwoJCWxvY2FsIHBvaW50cyA9IHNlbGY6R2V0QWxsUG9pbnRzKCkKCQlsb2NhbCBuID0gI3BvaW50cwoJCQoJCS0tIGdldCBwb3NpdGlvbiBhdCB0CgkJbG9jYWwgY190IGRvCgkJCWNfdCA9IFZlY3RvcjMubmV3KCkKCQkJZm9yIGkgPSAxLCBuIGRvCgkJCQlsb2NhbCBwX2kgPSBwb2ludHNbaV0KCQkJCWxvY2FsIEJfbml0ID0gQihuIC0gMSwgaSAtIDEsIHQpCgkJCQljX3QgKz0gQl9uaXQgKiBwX2kKCQkJZW5kCgkJZW5kCgkJCgkJLS0gcmV0dXJuIHBvc2l0aW9uCgkJcmV0dXJuIGNfdAoJZWxzZQoJCQoJCS0tIG5vdCBlbm91Z2ggcG9pbnRzIHRvIGdldCBwb3NpdGlvbgoJCWVycm9yKCJCZXppZXI6Q2FsY3VsYXRlUG9zaXRpb25BdCgpIG9ubHkgd29ya3MgaWYgdGhlcmUgaXMgYXQgbGVhc3QgMSBCZXppZXJQb2ludCEiKQoJZW5kCmVuZAoKCi0tIHJldHVybnMgdGhlIFZlY3RvcjMgcG9pbnQgYXQgdGhlIGdpdmVuIHQgdmFsdWUsIHdoZXJlIHQgaXMgcmVsYXRpdmUgdG8gdGhlIGxlbmd0aCBvZiB0aGUgQmV6aWVyIGN1cnZlCi0tIGRvZXMgbm90IHdvcmsgaWYgdGhlIGJlemllciBkb2VzIG5vdCBoYXZlIGFueSBwb2ludHMgYXR0YWNoZWQgdG8gaXQKZnVuY3Rpb24gQmV6aWVyOkNhbGN1bGF0ZVBvc2l0aW9uUmVsYXRpdmVUb0xlbmd0aCh0OiBudW1iZXIpOiBWZWN0b3IzCgkKCS0tIGNoZWNrIGlmIHQgaXMgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxCglpZiB0eXBlKHQpIH49ICJudW1iZXIiIHRoZW4KCQllcnJvcigiQmV6aWVyOkNhbGN1bGF0ZVBvc2l0aW9uUmVsYXRpdmVUb0xlbmd0aCgpIG9ubHkgYWNjZXB0cyBhIG51bWJlciwgZ290ICIgLi4gdG9zdHJpbmcodCkgLi4gIiEiKQoJZW5kCgkKCS0tIHN0YXJ0IGFsZ29yaXRobSB0byBjYWxjdWxhdGUgcG9zaXRpb24gaW4gYmV6aWVyCglsb2NhbCBwb2ludHMgPSBzZWxmLlBvaW50cwoJbG9jYWwgbnVtUG9pbnRzID0gI3BvaW50cwoJCgktLSBjaGVjayBpZiB0aGVyZSBpcyBhdCBsZWFzdCAxIHBvaW50CglpZiBudW1Qb2ludHMgPiAwIHRoZW4KCQkKCQktLSBpbXBvcnRhbnQgdmFsdWVzCgkJbG9jYWwgbGVuZ3RoID0gc2VsZi5MZW5ndGgKCQlsb2NhbCBsZW5ndGhJbmRlY2VzID0gc2VsZi5MZW5ndGhJbmRlY2VzCgkJbG9jYWwgaXRlcmF0aW9ucyA9IHNlbGYuTGVuZ3RoSXRlcmF0aW9ucwoJCWxvY2FsIHBvaW50cyA9IHNlbGY6R2V0QWxsUG9pbnRzKCkKCQkKCQktLSBjaGVjayBpZiB0aGVyZSBpcyBtb3JlIHRoYW4gMSBwb2ludAoJCWlmICNwb2ludHMgPiAxIHRoZW4KCQkJCgkJCS0tIGdldCBsZW5ndGggb2YgYmV6aWVyCgkJCWxvY2FsIHRhcmdldExlbmd0aCA9IGxlbmd0aCAqIHQKCQkJCgkJCS0tIGl0ZXJhdGUgdGhyb3VnaCBzdW0gdGFibGUKCQkJbG9jYWwgbmVhcmVzdFBhcmFtZXRlckluZGV4LCBuZWFyZXN0UGFyYW1ldGVyCgkJCWZvciBpLCBvcmRlcmVkUGFpciBpbiBpcGFpcnMobGVuZ3RoSW5kZWNlcykgZG8KCQkJCWlmIHRhcmdldExlbmd0aCAtIG9yZGVyZWRQYWlyWzJdIDw9IDAgdGhlbgoJCQkJCW5lYXJlc3RQYXJhbWV0ZXJJbmRleCA9IGkKCQkJCQluZWFyZXN0UGFyYW1ldGVyID0gb3JkZXJlZFBhaXIKCQkJCQlicmVhawoJCQkJZWxzZWlmIGkgPT0gI2xlbmd0aEluZGVjZXMgdGhlbgoJCQkJCW5lYXJlc3RQYXJhbWV0ZXJJbmRleCA9IGkKCQkJCQluZWFyZXN0UGFyYW1ldGVyID0gb3JkZXJlZFBhaXIKCQkJCQlicmVhawoJCQkJZW5kCgkJCWVuZAoJCQkKCQkJLS0gY2FsY3VsYXRlIHBlcmNlbnQgZXJyb3IKCQkJbG9jYWwgcDAsIHAxCgkJCWlmIGxlbmd0aEluZGVjZXNbbmVhcmVzdFBhcmFtZXRlckluZGV4IC0gMV0gdGhlbgoJCQkJcDAsIHAxID0gc2VsZjpDYWxjdWxhdGVQb3NpdGlvbkF0KGxlbmd0aEluZGVjZXNbbmVhcmVzdFBhcmFtZXRlckluZGV4IC0gMV1bMV0pLCBzZWxmOkNhbGN1bGF0ZVBvc2l0aW9uQXQobmVhcmVzdFBhcmFtZXRlclsxXSkKCQkJZWxzZQoJCQkJcDAsIHAxID0gc2VsZjpDYWxjdWxhdGVQb3NpdGlvbkF0KG5lYXJlc3RQYXJhbWV0ZXJbMV0pLCBzZWxmOkNhbGN1bGF0ZVBvc2l0aW9uQXQobGVuZ3RoSW5kZWNlc1tuZWFyZXN0UGFyYW1ldGVySW5kZXggKyAxXVsxXSkKCQkJZW5kCgkJCWxvY2FsIHBlcmNlbnRFcnJvciA9IChuZWFyZXN0UGFyYW1ldGVyWzJdIC0gdGFyZ2V0TGVuZ3RoKSAvIChwMSAtIHAwKS5NYWduaXR1ZGUKCQkJCgkJCS0tIHJldHVybiB0aGUgcG9zaXRpb24gYXQgdGhlIG5lYXJlc3RQYXJhbWV0ZXIKCQkJcmV0dXJuIHAwICsgKHAxIC0gcDApICogKDEgLSBwZXJjZW50RXJyb3IpCgkJZWxzZQoJCQkKCQkJLS0gcmV0dXJuIG9ubHkgcG9zaXRpb24KCQkJcmV0dXJuIHNlbGY6Q2FsY3VsYXRlUG9zaXRpb25BdCgwKQoJCWVuZAoJZWxzZQoJCQoJCS0tIG5vdCBlbm91Z2ggcG9pbnRzIHRvIGdldCBhIHBvc2l0aW9uCgkJZXJyb3IoIkJlemllcjpDYWxjdWxhdGVQb3NpdGlvblJlbGF0aXZlVG9MZW5ndGgoKSBvbmx5IHdvcmtzIGlmIHRoZXJlIGlzIGF0IGxlYXN0IDEgQmV6aWVyUG9pbnQhIikKCWVuZAplbmQKCgotLSByZXR1cm5zIHRoZSB0YW5nZW50IHZlY3RvciBpbiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBwYXRoIG1hZGUgYnkgdGhlIGJlemllciBhdCB0Ci0tIGluIG9yZGVyIHRvIGdldCBhIGRlcml2YXRpdmUgb2YgYSBCZXppZXIsIHlvdSBuZWVkIGF0IGxlYXN0IDIgcG9pbnRzIGluIHRoZSBCZXppZXIKZnVuY3Rpb24gQmV6aWVyOkNhbGN1bGF0ZURlcml2YXRpdmVBdCh0OiBudW1iZXIpOiBWZWN0b3IzPwoJCgktLSBjaGVjayBpZiB0IGlzIGJldHdlZW4gMCBhbmQgMQoJaWYgdHlwZSh0KSB+PSAibnVtYmVyIiB0aGVuCgkJZXJyb3IoIkJlemllcjpDYWxjdWxhdGVEZXJpdmF0aXZlQXQoKSBvbmx5IGFjY2VwdHMgYSBudW1iZXIsIGdvdCAiIC4uIHRvc3RyaW5nKHQpIC4uICIhIikKCWVuZAoJCgktLSBzdGFydCBhbGdvcml0aG0gdG8gY2FsY3VsYXRlIGJlemllciBkZXJpdmF0aXZlCglsb2NhbCBwb2ludHMgPSBzZWxmLlBvaW50cwoJbG9jYWwgbnVtUG9pbnRzID0gI3BvaW50cwoJCgktLSBjaGVjayBpZiB0aGVyZSBhcmUgYXQgbGVhc3QgMiBwb2ludHMKCWlmIG51bVBvaW50cyA+IDEgdGhlbgoJCQoJCS0tIGltcG9ydGFudCB2YWx1ZXMKCQlsb2NhbCBwb2ludHMgPSBzZWxmOkdldEFsbFBvaW50cygpCgkJbG9jYWwgbiA9ICNwb2ludHMKCQlsb2NhbCBtID0gbiAtIDEKCQkKCQktLSBjYWxjdWxhdGUgZGVyaXZhdGl2ZSBhdCB0CgkJbG9jYWwgY1ByaW1lX3QgZG8KCQkJY1ByaW1lX3QgPSBWZWN0b3IzLm5ldygpCgkJCWZvciBpID0gMSwgbiAtIDEgZG8KCQkJCWxvY2FsIHBfaTEsIHBfaSA9IHBvaW50c1tpICsgMV0sIHBvaW50c1tpXQoJCQkJbG9jYWwgUV9pID0gKG4gLSAxKSAqIChwX2kxIC0gcF9pKQoJCQkJbG9jYWwgQl9taXQgPSBCKG4gLSAyLCBpIC0gMSwgdCkKCQkJCWNQcmltZV90ICs9IEJfbWl0ICogUV9pCgkJCWVuZAoJCWVuZAoJCQoJCS0tIHJldHVybiBkZXJpdmF0aXZlCgkJcmV0dXJuIGNQcmltZV90CgllbHNlIAoJCQoJCS0tIG5vdCBlbm91Z2ggcG9pbnRzCgkJZXJyb3IoIkJlemllcjpDYWxjdWxhdGVEZXJpdmF0aXZlQXQoKSBvbmx5IHdvcmtzIGlmIHRoZXJlIGFyZSBhdCBsZWFzdCAyIEJlemllclBvaW50cyEiKQoJZW5kCmVuZAoKCi0tIHJldHVybnMgdGhlIHRhbmdlbnQgdmVjdG9yIGluIHRoZSBkaXJlY3Rpb24gb2YgdGhlIHBhdGggbWFkZSBieSB0aGUgYmV6aWVyIGF0IHQgKHdoZXJlIHQgaXMgcmVsYXRpdmUgdG8gdGhlIGxlbmd0aCBvZiB0aGUgQmV6aWVyIEN1cnZlKQotLSBkb2VzIG5vdCB3b3JrIGlmIHRoZSBiZXppZXIgZG9lcyBub3QgaGF2ZSBhdCBsZWFzdCAyIHBvaW50cwotLSB0aGUgZ2l2ZW4gdCB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMQpmdW5jdGlvbiBCZXppZXI6Q2FsY3VsYXRlRGVyaXZhdGl2ZVJlbGF0aXZlVG9MZW5ndGgodDogbnVtYmVyKTogVmVjdG9yMwoJCgktLSBjaGVjayBpZiB0IGlzIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMQoJaWYgdHlwZSh0KSB+PSAibnVtYmVyIiB0aGVuCgkJZXJyb3IoIkJlemllcjpDYWxjdWxhdGVEZXJpdmF0aXZlUmVsYXRpdmVUb0xlbmd0aCgpIG9ubHkgYWNjZXB0cyBhIG51bWJlciwgZ290ICIgLi4gdG9zdHJpbmcodCkgLi4gIiEiKQoJZW5kCgkKCS0tIHN0YXJ0IGFsZ29yaXRobSB0byBjYWxjdWxhdGUgZGVyaXZhdGl2ZSBpbiBiZXppZXIKCWxvY2FsIHBvaW50cyA9IHNlbGYuUG9pbnRzCglsb2NhbCBudW1Qb2ludHMgPSAjcG9pbnRzCgkKCS0tIGNoZWNrIGlmIHRoZXJlIGFyZSBhdCBsZWFzdCAyIHBvaW50cwoJaWYgbnVtUG9pbnRzID4gMSB0aGVuCgkJCgkJLS0gaW1wb3J0YW50IHZhbHVlcwoJCWxvY2FsIGxlbmd0aCA9IHNlbGYuTGVuZ3RoCgkJbG9jYWwgbGVuZ3RoSW5kZWNlcyA9IHNlbGYuTGVuZ3RoSW5kZWNlcwoJCWxvY2FsIGl0ZXJhdGlvbnMgPSBzZWxmLkxlbmd0aEl0ZXJhdGlvbnMKCQlsb2NhbCBwb2ludHMgPSBzZWxmOkdldEFsbFBvaW50cygpCgoJCS0tIGdldCBsZW5ndGggb2YgYmV6aWVyCgkJbG9jYWwgdGFyZ2V0TGVuZ3RoID0gbGVuZ3RoICogdAoKCQktLSBpdGVyYXRlIHRocm91Z2ggc3VtIHRhYmxlCgkJbG9jYWwgbmVhcmVzdFBhcmFtZXRlckluZGV4LCBuZWFyZXN0UGFyYW1ldGVyCgkJZm9yIGksIG9yZGVyZWRQYWlyIGluIGlwYWlycyhsZW5ndGhJbmRlY2VzKSBkbwoJCQlpZiB0YXJnZXRMZW5ndGggLSBvcmRlcmVkUGFpclsyXSA8PSAwIHRoZW4KCQkJCW5lYXJlc3RQYXJhbWV0ZXJJbmRleCA9IGkKCQkJCW5lYXJlc3RQYXJhbWV0ZXIgPSBvcmRlcmVkUGFpcgoJCQkJYnJlYWsKCQkJZWxzZWlmIGkgPT0gI2xlbmd0aEluZGVjZXMgdGhlbgoJCQkJbmVhcmVzdFBhcmFtZXRlckluZGV4ID0gaQoJCQkJbmVhcmVzdFBhcmFtZXRlciA9IG9yZGVyZWRQYWlyCgkJCQlicmVhawoJCQllbmQKCQllbmQKCgkJLS0gY2FsY3VsYXRlIHBlcmNlbnQgZXJyb3IKCQlsb2NhbCBkMCwgZDEKCQlpZiBsZW5ndGhJbmRlY2VzW25lYXJlc3RQYXJhbWV0ZXJJbmRleCAtIDFdIHRoZW4KCQkJZDAsIGQxID0gc2VsZjpDYWxjdWxhdGVEZXJpdmF0aXZlQXQobGVuZ3RoSW5kZWNlc1tuZWFyZXN0UGFyYW1ldGVySW5kZXggLSAxXVsxXSksIHNlbGY6Q2FsY3VsYXRlRGVyaXZhdGl2ZUF0KG5lYXJlc3RQYXJhbWV0ZXJbMV0pCgkJZWxzZQoJCQlkMCwgZDEgPSBzZWxmOkNhbGN1bGF0ZURlcml2YXRpdmVBdChuZWFyZXN0UGFyYW1ldGVyWzFdKSwgc2VsZjpDYWxjdWxhdGVEZXJpdmF0aXZlQXQobGVuZ3RoSW5kZWNlc1tuZWFyZXN0UGFyYW1ldGVySW5kZXggKyAxXVsxXSkKCQllbmQKCQlsb2NhbCBwZXJjZW50RXJyb3IgPSAobmVhcmVzdFBhcmFtZXRlclsyXSAtIHRhcmdldExlbmd0aCkgLyAoZDEgLSBkMCkuTWFnbml0dWRlCgoJCS0tIHJldHVybiB0aGUgZGVyaXZhdGl2ZSBhdCB0aGUgbmVhcmVzdFBhcmFtZXRlcgoJCXJldHVybiBkMCArIChkMSAtIGQwKSAqICgxIC0gcGVyY2VudEVycm9yKQoJZWxzZQoJCQoJCS0tIG5vdCBlbm91Z2ggcG9pbnRzIHRvIGNhbGN1bGF0ZSBkZXJpdmF0aXZlCgkJZXJyb3IoIkJlemllcjpDYWxjdWxhdGVEZXJpdmF0aXZlUmVsYXRpdmVUb0xlbmd0aCgpIG9ubHkgd29ya3MgaWYgdGhlcmUgYXJlIGF0IGxlYXN0IDIgQmV6aWVyUG9pbnRzISIpCgllbmQKZW5kCgoKLS0gdHdlZW5zIGEgZ2l2ZW4gb2JqZWN0IGluIHRoZSBwYXRoIG1hZGUgYnkgdGhlIEJlemllciAocG9zaXRpb24gb25seSkKLS0gd29ya3MgZm9yIGFueSBvYmplY3QgdGhhdCBoYXMgdGhlIHByb3BlcnRpZXMgZ2l2ZW4gYnkgdGhlIHByb3BlcnR5IHRhYmxlCmZ1bmN0aW9uIEJlemllcjpDcmVhdGVWZWN0b3IzVHdlZW4ob2JqZWN0OiBJbnN0YW5jZSB8IHtbYW55XTogYW55fSwgcHJvcGVydHlUYWJsZToge2FueX0sIGJlemllclR3ZWVuSW5mbzogVHdlZW5JbmZvLCBSZWxhdGl2ZVRvTGVuZ3RoOiBib29sZWFuPyk6IFR3ZWVuCgkKCS0tIGNoZWNrIGlmIHRoZXJlIGFyZSBlbm91Z2ggcG9pbnRzIHRvIGNhbGN1bGF0ZSBhIHBvc2l0aW9uIHdpdGhpbiB0aGUgQmV6aWVyCglpZiAjc2VsZi5Qb2ludHMgPT0gMCB0aGVuCgkJZXJyb3IoIkJlemllcjpDcmVhdGVWZWN0b3IzVHdlZW4oKSBvbmx5IHdvcmtzIGlmIHRoZXJlIGlzIGF0IGxlYXN0IDEgQmV6aWVyUG9pbnQgaW4gdGhlIEJlemllciEiKQoJZW5kCgkKCS0tIGNoZWNrIGlmIHRoZSBvYmplY3QgZ2l2ZW4gaXMgYSB2YWxpZCBvYmplY3QKCWlmIHR5cGVvZihvYmplY3QpIH49ICJJbnN0YW5jZSIgYW5kIHR5cGVvZihvYmplY3QpIH49ICJ0YWJsZSIgdGhlbgoJCWVycm9yKCJCZXppZXI6Q3JlYXRlVmVjdG9yM1R3ZWVuKCkgcmVxdWlyZXMgYW4gSW5zdGFuY2Ugb3IgYSB0YWJsZSBhcyB0aGUgZmlyc3QgYXJndW1lbnQhIikKCWVuZAoJCgktLSBjaGVjayBpZiB0aGUgYmV6aWVyVHdlZW5JbmZvIGdpdmVuIGlzIGEgVHdlZW5JbmZvIG9iamVjdAoJaWYgbm90ICh0eXBlb2YoYmV6aWVyVHdlZW5JbmZvKSA9PSAiVHdlZW5JbmZvIikgdGhlbgoJCWVycm9yKCJCZXppZXI6Q3JlYXRlVmVjdG9yM1R3ZWVuKCkgcmVxdWlyZXMgYSBUd2VlbkluZm8gb2JqZWN0IGFzIHRoZSB0aGlyZCBhcmd1bWVudCEiKQoJZW5kCgkKCS0tIGNoZWNrIGlmIHRoZSBvYmplY3QgZ2l2ZW4gaGFzIHRoZSB2ZWN0b3IzIHByb3BlcnRpZXMgZ2l2ZW4KCWxvY2FsIHN1Y2Nlc3MsIGZvdW5kUHJvcGVydGllcyA9IHBjYWxsKGZ1bmN0aW9uKCkKCQlsb2NhbCBmb3VuZFByb3BlcnRpZXMgPSB0cnVlCgkJZm9yIF8sIHByb3BlcnR5TmFtZSBpbiBwYWlycyhwcm9wZXJ0eVRhYmxlKSBkbwoJCQlpZiB0eXBlb2Yob2JqZWN0W3Byb3BlcnR5TmFtZV0pIH49ICJWZWN0b3IzIiBhbmQgdHlwZW9mKG9iamVjdFtwcm9wZXJ0eU5hbWVdKSB+PSAibmlsIiB0aGVuCgkJCQlmb3VuZFByb3BlcnRpZXMgPSBmYWxzZQoJCQkJYnJlYWsKCQkJZW5kCgkJZW5kCgkJcmV0dXJuIGZvdW5kUHJvcGVydGllcwoJZW5kKQoJCgktLSBjaGVjayBpZiB0aGUgcHJvcGVydGllcyB3ZXJlIGZvdW5kCglpZiBzdWNjZXNzIGFuZCBmb3VuZFByb3BlcnRpZXMgdGhlbgoJCWxvY2FsIHR3ZWVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIikKCQlsb2NhbCBudW1WYWx1ZSA9IEluc3RhbmNlLm5ldygiTnVtYmVyVmFsdWUiKQoJCWxvY2FsIHR3ZWVuID0gdHdlZW5TZXJ2aWNlOkNyZWF0ZShudW1WYWx1ZSwgYmV6aWVyVHdlZW5JbmZvLCB7VmFsdWUgPSAxfSkKCQlsb2NhbCBudW1WYWx1ZUNoYW5nZWRDb25uZWN0aW9uCgkJdHdlZW4uQ2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKHByb3ApCgkJCWlmIHByb3AgPT0gIlBsYXliYWNrU3RhdGUiIHRoZW4KCQkJCWxvY2FsIHBsYXliYWNrU3RhdGUgPSB0d2Vlbi5QbGF5YmFja1N0YXRlCgkJCQlpZiBwbGF5YmFja1N0YXRlID09IEVudW0uUGxheWJhY2tTdGF0ZS5QbGF5aW5nIHRoZW4KCQkJCQludW1WYWx1ZUNoYW5nZWRDb25uZWN0aW9uID0gbnVtVmFsdWUuQ2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKHQpCgkJCQkJCWZvciBfLCBwcm9wTmFtZSBpbiBwYWlycyhwcm9wZXJ0eVRhYmxlKSBkbwoJCQkJCQkJb2JqZWN0W3Byb3BOYW1lXSA9IFJlbGF0aXZlVG9MZW5ndGggYW5kIHNlbGY6Q2FsY3VsYXRlUG9zaXRpb25SZWxhdGl2ZVRvTGVuZ3RoKHQpIG9yIHNlbGY6Q2FsY3VsYXRlUG9zaXRpb25BdCh0KQoJCQkJCQllbmQKCQkJCQllbmQpCgkJCQllbHNlCgkJCQkJaWYgbnVtVmFsdWVDaGFuZ2VkQ29ubmVjdGlvbiB0aGVuCgkJCQkJCW51bVZhbHVlQ2hhbmdlZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCgkJCQkJCW51bVZhbHVlQ2hhbmdlZENvbm5lY3Rpb24gPSBuaWwKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQKCQllbmQpCgkJcmV0dXJuIHR3ZWVuCgllbHNlCgkJZXJyb3IoIkJlemllcjpDcmVhdGVWZWN0b3IzVHdlZW4oKSByZXF1aXJlcyBhIG1hdGNoaW5nIHByb3BlcnR5IHRhYmxlIHdpdGggVmVjdG9yMyBvciBuaWwgcHJvcGVydHkgbmFtZXMgZm9yIHRoZSBvYmplY3QgYXMgdGhlIHNlY29uZCBhcmd1bWVudCEiKQoJZW5kCmVuZAoKCi0tIHR3ZWVucyBhIGdpdmVuIG9iamVjdCBpbiB0aGUgcGF0aCBtYWRlIGJ5IHRoZSBCZXppZXIgKGNmcmFtZSB2ZXJzaW9uKQotLSB3b3JrcyBmb3IgYW55IG9iamVjdCB0aGF0IGhhcyB0aGUgcHJvcGVydGllcyBnaXZlbiBieSB0aGUgcHJvcGVydHkgdGFibGUKZnVuY3Rpb24gQmV6aWVyOkNyZWF0ZUNGcmFtZVR3ZWVuKG9iamVjdDogSW5zdGFuY2UgfCB7W2FueV06IGFueX0sIHByb3BlcnR5VGFibGU6IHthbnl9LCBiZXppZXJUd2VlbkluZm86IFR3ZWVuSW5mbywgUmVsYXRpdmVUb0xlbmd0aDogYm9vbGVhbj8pOiBUd2VlbgoJCgktLSBjaGVjayBpZiB0aGVyZSBhcmUgZW5vdWdoIHBvaW50cyB0byBjYWxjdWxhdGUgYSBjZnJhbWUgd2l0aGluIHRoZSBCZXppZXIKCWlmICNzZWxmLlBvaW50cyA8PSAxIHRoZW4KCQllcnJvcigiQmV6aWVyOkNyZWF0ZVZlY3RvcjNUd2VlbigpIG9ubHkgd29ya3MgaWYgdGhlcmUgYXJlIGF0IGxlYXN0IDIgQmV6aWVyUG9pbnRzIGluIHRoZSBCZXppZXIhIikKCWVuZAoKCS0tIGNoZWNrIGlmIHRoZSBvYmplY3QgZ2l2ZW4gaXMgYSB2YWxpZCBvYmplY3QKCWlmIHR5cGVvZihvYmplY3QpIH49ICJJbnN0YW5jZSIgYW5kIHR5cGVvZihvYmplY3QpIH49ICJ0YWJsZSIgdGhlbgoJCWVycm9yKCJCZXppZXI6Q3JlYXRlQ0ZyYW1lVHdlZW4oKSByZXF1aXJlcyBhbiBJbnN0YW5jZSBvciBhIHRhYmxlIGFzIHRoZSBmaXJzdCBhcmd1bWVudCEiKQoJZW5kCgoJLS0gY2hlY2sgaWYgdGhlIGJlemllclR3ZWVuSW5mbyBnaXZlbiBpcyBhIFR3ZWVuSW5mbyBvYmplY3QKCWlmIG5vdCAodHlwZW9mKGJlemllclR3ZWVuSW5mbykgPT0gIlR3ZWVuSW5mbyIpIHRoZW4KCQllcnJvcigiQmV6aWVyOkNyZWF0ZUNGcmFtZVR3ZWVuKCkgcmVxdWlyZXMgYSBUd2VlbkluZm8gb2JqZWN0IGFzIHRoZSB0aGlyZCBhcmd1bWVudCEiKQoJZW5kCgoJLS0gY2hlY2sgaWYgdGhlIG9iamVjdCBnaXZlbiBoYXMgdGhlIENGcmFtZSBwcm9wZXJ0aWVzIGdpdmVuCglsb2NhbCBzdWNjZXNzLCBmb3VuZFByb3BlcnRpZXMgPSBwY2FsbChmdW5jdGlvbigpCgkJbG9jYWwgZm91bmRQcm9wZXJ0aWVzID0gdHJ1ZQoJCWZvciBfLCBwcm9wZXJ0eU5hbWUgaW4gcGFpcnMocHJvcGVydHlUYWJsZSkgZG8KCQkJaWYgdHlwZW9mKG9iamVjdFtwcm9wZXJ0eU5hbWVdKSB+PSAiQ0ZyYW1lIiBhbmQgdHlwZW9mKG9iamVjdFtwcm9wZXJ0eU5hbWVdKSB+PSAibmlsIiB0aGVuCgkJCQlmb3VuZFByb3BlcnRpZXMgPSBmYWxzZQoJCQkJYnJlYWsKCQkJZW5kCgkJZW5kCgkJcmV0dXJuIGZvdW5kUHJvcGVydGllcwoJZW5kKQoKCS0tIGNoZWNrIGlmIHRoZSBwcm9wZXJ0aWVzIHdlcmUgZm91bmQKCWlmIHN1Y2Nlc3MgYW5kIGZvdW5kUHJvcGVydGllcyB0aGVuCgkJbG9jYWwgdHdlZW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJUd2VlblNlcnZpY2UiKQoJCWxvY2FsIG51bVZhbHVlID0gSW5zdGFuY2UubmV3KCJOdW1iZXJWYWx1ZSIpCgkJbG9jYWwgdHdlZW4gPSB0d2VlblNlcnZpY2U6Q3JlYXRlKG51bVZhbHVlLCBiZXppZXJUd2VlbkluZm8sIHtWYWx1ZSA9IDF9KQoJCWxvY2FsIG51bVZhbHVlQ2hhbmdlZENvbm5lY3Rpb24KCQl0d2Vlbi5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24ocHJvcCkKCQkJaWYgcHJvcCA9PSAiUGxheWJhY2tTdGF0ZSIgdGhlbgoJCQkJbG9jYWwgcGxheWJhY2tTdGF0ZSA9IHR3ZWVuLlBsYXliYWNrU3RhdGUKCQkJCWlmIHBsYXliYWNrU3RhdGUgPT0gRW51bS5QbGF5YmFja1N0YXRlLlBsYXlpbmcgdGhlbgoJCQkJCW51bVZhbHVlQ2hhbmdlZENvbm5lY3Rpb24gPSBudW1WYWx1ZS5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24odCkKCQkJCQkJZm9yIF8sIHByb3BOYW1lIGluIHBhaXJzKHByb3BlcnR5VGFibGUpIGRvCgkJCQkJCQlsb2NhbCBwb3NpdGlvbiA9IFJlbGF0aXZlVG9MZW5ndGggYW5kIHNlbGY6Q2FsY3VsYXRlUG9zaXRpb25SZWxhdGl2ZVRvTGVuZ3RoKHQpIG9yIHNlbGY6Q2FsY3VsYXRlUG9zaXRpb25BdCh0KQoJCQkJCQkJbG9jYWwgZGVyaXZhdGl2ZSA9IFJlbGF0aXZlVG9MZW5ndGggYW5kIHNlbGY6Q2FsY3VsYXRlRGVyaXZhdGl2ZVJlbGF0aXZlVG9MZW5ndGgodCkgb3Igc2VsZjpDYWxjdWxhdGVEZXJpdmF0aXZlQXQodCkKCQkJCQkJCW9iamVjdFtwcm9wTmFtZV0gPSBDRnJhbWUubmV3KHBvc2l0aW9uLCBwb3NpdGlvbiArIGRlcml2YXRpdmUpCgkJCQkJCWVuZAoJCQkJCWVuZCkKCQkJCWVsc2UKCQkJCQlpZiBudW1WYWx1ZUNoYW5nZWRDb25uZWN0aW9uIHRoZW4KCQkJCQkJbnVtVmFsdWVDaGFuZ2VkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKCQkJCQkJbnVtVmFsdWVDaGFuZ2VkQ29ubmVjdGlvbiA9IG5pbAoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZCkKCQlyZXR1cm4gdHdlZW4KCWVsc2UKCQllcnJvcigiQmV6aWVyOkNyZWF0ZUNGcmFtZVR3ZWVuKCkgcmVxdWlyZXMgYSBtYXRjaGluZyBwcm9wZXJ0eSB0YWJsZSB3aXRoIENGcmFtZSBvciBuaWwgcHJvcGVydHkgbmFtZXMgZm9yIHRoZSBvYmplY3QgYXMgdGhlIHNlY29uZCBhcmd1bWVudCEiKQoJZW5kCmVuZAoKCi0tIHJldHVybgpyZXR1cm4gQmV6aWVy"
  },
  "LootPlan": {
    "Type": "Module",
    "Code": "LS0gT3JpZ2luYWwgTW9kdWxlIGNhbiBiZSBmb3VuZCBhdCAtIHJvYmxveC5jb20vbGlicmFyeS80NzEwNjk3NTI0L0xvb3RQbGFuCi0tIEFQSSBEb2N1bWVudGF0aW9uIGNhbiBiZSBmb3VuZCBhdCAtIGh0dHBzOi8vZGV2Zm9ydW0ucm9ibG94LmNvbS90L2xvb3RwbGFuLXJhbmRvbS1sb290LWdlbmVyYXRpb24tbWFkZS1lYXN5LzQ2MzcwMgotLSBUd28gZXhhbXBsZSBzY3JpcHRzIGNhbiBiZSBmb3VuZCB3aXRoaW4gdGhlIGV4cGxvcmVyLCBpbnNpZGUgdGhpcyBtb2R1bGUKCmxvY2FsIExvb3RQbGFuID0ge30KCi0tPiBTaW5nbGVMb290UGxhbiBDbGFzcyA8LS0KCmxvY2FsIFNpbmdsZUxvb3RQbGFuID0ge30KU2luZ2xlTG9vdFBsYW4uX19pbmRleCA9IFNpbmdsZUxvb3RQbGFuCgpmdW5jdGlvbiBTaW5nbGVMb290UGxhbi5uZXcoc2VlZCkKCWxvY2FsIFNpbmdsZUxvb3RQbGFuID0gc2V0bWV0YXRhYmxlKHt9LFNpbmdsZUxvb3RQbGFuKQoJU2luZ2xlTG9vdFBsYW4uUmFuZG9taXplciA9IFJhbmRvbS5uZXcoc2VlZCBvciAodGljaygpJTEpKjFlMTApCglTaW5nbGVMb290UGxhbi5Mb290ID0ge30KCVNpbmdsZUxvb3RQbGFuLkxvb3RMaXN0ID0ge30KCVNpbmdsZUxvb3RQbGFuLkxvb3RDb3VudCA9IDAKCVNpbmdsZUxvb3RQbGFuLlRvdGFsQ2hhbmNlID0gMAoJcmV0dXJuIFNpbmdsZUxvb3RQbGFuCmVuZAoKZnVuY3Rpb24gU2luZ2xlTG9vdFBsYW46X3VwZGF0ZUxvb3RMaXN0KCkKCWxvY2FsIExvb3RMaXN0ID0ge30KCQoJZm9yIE5hbWUsTG9vdCBpbiBzZWxmLkxvb3QgZG8KCQl0YWJsZS5pbnNlcnQoTG9vdExpc3QsIExvb3QpCgllbmQKCQoJdGFibGUuc29ydChMb290TGlzdCwgZnVuY3Rpb24oYSxiKQoJCXJldHVybiBhLmNoYW5jZSA8IGIuY2hhbmNlCgllbmQpCgkKCXNlbGYuTG9vdExpc3QgPSBMb290TGlzdAplbmQKCmZ1bmN0aW9uIFNpbmdsZUxvb3RQbGFuOkFkZExvb3QobmFtZSwgY2hhbmNlKQoJbG9jYWwgbmV3TG9vdCA9IHsKCQluYW1lID0gbmFtZTsKCQljaGFuY2UgPSBjaGFuY2U7Cgl9CglzZWxmLkxvb3RbbmFtZV0gPSBuZXdMb290CglzZWxmLkxvb3RDb3VudCArPSAxCglzZWxmLlRvdGFsQ2hhbmNlICs9IGNoYW5jZQoJc2VsZjpfdXBkYXRlTG9vdExpc3QoKQoJcmV0dXJuIG5ld0xvb3QKZW5kCgpmdW5jdGlvbiBTaW5nbGVMb290UGxhbjpBZGRMb290RnJvbVRhYmxlKFRhYmxlKQoJZm9yIG5hbWUsIGNoYW5jZSBpbiBUYWJsZSBkbwoJCXNlbGY6QWRkTG9vdChuYW1lLCBjaGFuY2UpCgllbmQKCXJldHVybiBzZWxmCmVuZAoKZnVuY3Rpb24gU2luZ2xlTG9vdFBsYW46R2V0TG9vdENoYW5jZShuYW1lKQoJbG9jYWwgbG9vdCA9IHNlbGYuTG9vdFtuYW1lXQoJaWYgbG9vdCB0aGVuCgkJcmV0dXJuIGxvb3QuY2hhbmNlCgllbHNlCgkJZXJyb3IoIkxvb3Qgd2l0aCBuYW1lICciLi50b3N0cmluZyhuYW1lKS4uIicgZG9lcyBub3QgZXhpc3QiKQoJZW5kCmVuZAoKZnVuY3Rpb24gU2luZ2xlTG9vdFBsYW46R2V0VHJ1ZUxvb3RDaGFuY2UobmFtZSkKCWxvY2FsIGxvb3QgPSBzZWxmLkxvb3RbbmFtZV0KCWlmIGxvb3QgdGhlbgoJCXJldHVybiAobG9vdC5jaGFuY2Uvc2VsZi5Ub3RhbENoYW5jZSkqMTAwCgllbHNlCgkJZXJyb3IoIkxvb3Qgd2l0aCBuYW1lICciLi50b3N0cmluZyhuYW1lKS4uIicgZG9lcyBub3QgZXhpc3QiKQoJZW5kCmVuZAoKZnVuY3Rpb24gU2luZ2xlTG9vdFBsYW46UmVtb3ZlTG9vdChuYW1lKQoJbG9jYWwgbG9vdCA9IHNlbGYuTG9vdFtuYW1lXQoJaWYgbG9vdCB0aGVuCgkJc2VsZi5Ub3RhbENoYW5jZSAtPSBsb290LmNoYW5jZQoJCXNlbGYuTG9vdENvdW50IC09IDEKCQlzZWxmLkxvb3RbbmFtZV0gPSBuaWwKCQlzZWxmOl91cGRhdGVMb290TGlzdCgpCgllbmQKZW5kCgpmdW5jdGlvbiBTaW5nbGVMb290UGxhbjpDaGFuZ2VMb290Q2hhbmNlKG5hbWUsIGNoYW5jZSkKCWxvY2FsIGxvb3QgPSBzZWxmLkxvb3RbbmFtZV0KCWlmIGxvb3QgdGhlbgoJCXNlbGYuVG90YWxDaGFuY2UgKz0gY2hhbmNlIC0gbG9vdC5jaGFuY2UKCQlsb290LmNoYW5jZSA9IGNoYW5jZQoJCXNlbGY6X3VwZGF0ZUxvb3RMaXN0KCkKCQlyZXR1cm4gbG9vdAoJZWxzZQoJCWVycm9yKCJMb290IHdpdGggbmFtZSAnIi4udG9zdHJpbmcobmFtZSkuLiInIGRvZXMgbm90IGV4aXN0IikKCWVuZAplbmQKCmZ1bmN0aW9uIFNpbmdsZUxvb3RQbGFuOkdldFJhbmRvbUxvb3QobHVjaykKCWxvY2FsIGx1Y2sgPSBsdWNrIG9yIDEKCWlmIGx1Y2sgPj0gMSB0aGVuCgkJbG9jYWwgcmVzdWx0ID0gc2VsZi5SYW5kb21pemVyOk5leHROdW1iZXIoKQoJCWxvY2FsIGFnZ3JlZ2F0ZSA9IDAKCQlmb3IgaSwgbG9vdCBpbiBzZWxmLkxvb3RMaXN0IGRvCgkJCWxvY2FsIGNoYW5jZSA9IGxvb3QuY2hhbmNlICogbHVjawoJCQlpZiByZXN1bHQgPCAoY2hhbmNlICsgYWdncmVnYXRlKSAvIHNlbGYuVG90YWxDaGFuY2UgdGhlbgoJCQkJcmV0dXJuIGxvb3QubmFtZQoJCQllbmQKCQkJYWdncmVnYXRlICs9IGNoYW5jZQoJCWVuZAoJZWxzZQoJCWxvY2FsIGx1Y2sgPSAxL2x1Y2sKCQlsb2NhbCByZXN1bHQgPSBzZWxmLlJhbmRvbWl6ZXI6TmV4dE51bWJlcigpCgkJbG9jYWwgYWdncmVnYXRlID0gMAoJCWZvciBpID0gc2VsZi5Mb290Q291bnQsIDEsIC0xIGRvCgkJCWxvY2FsIGxvb3QgPSBzZWxmLkxvb3RMaXN0W2ldCgkJCWxvY2FsIGNoYW5jZSA9IGxvb3QuY2hhbmNlICogbHVjawoJCQlpZiByZXN1bHQgPCAoY2hhbmNlICsgYWdncmVnYXRlKSAvIHNlbGYuVG90YWxDaGFuY2UgdGhlbgoJCQkJcmV0dXJuIGxvb3QubmFtZQoJCQllbmQKCQkJYWdncmVnYXRlICs9IGNoYW5jZQoJCWVuZAoJZW5kCmVuZAoKLS0+IE11bHRpTG9vdFBsYW4gQ2xhc3MgPC0tCgpsb2NhbCBNdWx0aUxvb3RQbGFuID0ge30KTXVsdGlMb290UGxhbi5fX2luZGV4ID0gTXVsdGlMb290UGxhbgoKZnVuY3Rpb24gTXVsdGlMb290UGxhbi5uZXcoc2VlZCkKCWxvY2FsIE11bHRpTG9vdFBsYW4gPSBzZXRtZXRhdGFibGUoe30sTXVsdGlMb290UGxhbikKCU11bHRpTG9vdFBsYW4uUmFuZG9taXplciA9IFJhbmRvbS5uZXcoc2VlZCBvciAodGljaygpJTEpKjFlMTApCglNdWx0aUxvb3RQbGFuLkxvb3QgPSB7fQoJcmV0dXJuIE11bHRpTG9vdFBsYW4KZW5kCgpmdW5jdGlvbiBNdWx0aUxvb3RQbGFuOkFkZExvb3QobmFtZSwgY2hhbmNlKSAKCWxvY2FsIG5ld0xvb3QgPSB7CgkJbmFtZSA9IG5hbWU7CgkJY2hhbmNlID0gY2hhbmNlOwoJfQoJc2VsZi5Mb290W25hbWVdPW5ld0xvb3QKCXJldHVybiBuZXdMb290CmVuZAoKZnVuY3Rpb24gTXVsdGlMb290UGxhbjpBZGRMb290RnJvbVRhYmxlKFRhYmxlKQoJZm9yIG5hbWUsIGNoYW5jZSBpbiBUYWJsZSBkbwoJCXNlbGY6QWRkTG9vdChuYW1lLCBjaGFuY2UpCgllbmQKZW5kCgpmdW5jdGlvbiBNdWx0aUxvb3RQbGFuOkdldExvb3RDaGFuY2UobmFtZSkKCWxvY2FsIGxvb3QgPSBzZWxmLkxvb3RbbmFtZV0KCWlmIGxvb3QgdGhlbgoJCXJldHVybiBsb290LmNoYW5jZQoJZWxzZQoJCWVycm9yKCJMb290IHdpdGggbmFtZSAnIi4udG9zdHJpbmcobmFtZSkuLiInIGRvZXMgbm90IGV4aXN0IikKCWVuZAplbmQKCmZ1bmN0aW9uIE11bHRpTG9vdFBsYW46UmVtb3ZlTG9vdChuYW1lKQoJc2VsZi5Mb290W25hbWVdPW5pbAplbmQKCmZ1bmN0aW9uIE11bHRpTG9vdFBsYW46Q2hhbmdlTG9vdENoYW5jZShuYW1lLCBuZXdDaGFuY2UpCglsb2NhbCBsb290ID0gc2VsZi5Mb290W25hbWVdCglpZiBsb290IHRoZW4KCQlsb290LmNoYW5jZSA9IG5ld0NoYW5jZQoJZWxzZQoJCWVycm9yKCJMb290IHdpdGggbmFtZSAnIi4udG9zdHJpbmcobmFtZSkuLiInIGRvZXMgbm90IGV4aXN0IikKCWVuZAplbmQKCmZ1bmN0aW9uIE11bHRpTG9vdFBsYW46R2V0UmFuZG9tTG9vdChpdGVyYXRpb25zLCBsdWNrKSAtLSBpdGVyYXRpb25zIG9wdGlvbmFsLCBkZWZhdWx0cyB0byAxIHdoZW4gbm90IHByb3ZpZGVkCglsb2NhbCBMb290VGFibGUgPSB7fQoJZm9yIGkgPSAxLGl0ZXJhdGlvbnMgb3IgMSBkbwoJCWZvciBuYW1lLGxvb3QgaW4gc2VsZi5Mb290IGRvIAoJCQlsb2NhbCByZXN1bHQgPSBzZWxmLlJhbmRvbWl6ZXI6TmV4dE51bWJlcigpCgkJCWxvY2FsIGNoYW5jZSA9IChsb290LmNoYW5jZS8xMDApICogKGx1Y2sgb3IgMSkKCQkJaWYgcmVzdWx0IDwgY2hhbmNlIHRoZW4KCQkJCUxvb3RUYWJsZVtuYW1lXSA9IExvb3RUYWJsZVtuYW1lXSBhbmQgTG9vdFRhYmxlW25hbWVdKzEgb3IgMQoJCQllbmQKCQllbmQKCWVuZAoJcmV0dXJuIExvb3RUYWJsZQplbmQKCi0tPiBMb290UGxhbiBDcmVhdG9yIDwtLQoKZnVuY3Rpb24gTG9vdFBsYW4ubmV3KGNsYXNzLCBzZWVkKQoJaWYgY2xhc3MgPT0gIm11bHRpIiB0aGVuCgkJcmV0dXJuIE11bHRpTG9vdFBsYW4ubmV3KHNlZWQpCgllbHNlIC0tIENsYXNzIGRlZmF1bHRzIHRvIHNpbmdsZSB3aGVuIG5vIGNsYXNzIHByb3ZpZGVkCgkJcmV0dXJuIFNpbmdsZUxvb3RQbGFuLm5ldyhzZWVkKQoJZW5kCmVuZAoKcmV0dXJuIExvb3RQbGFu"
  },
  "ProfileStore": {
    "Type": "Module",
    "Code": "LS1bWwpNQUQgU1RVRElPIChieSBsb2xlcmlzKQoKLVtQcm9maWxlU3RvcmVdLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoJUGVyaW9kaWMgRGF0YVN0b3JlIHNhdmluZyBzb2x1dGlvbiB3aXRoIHNlc3Npb24gbG9ja2luZwoJCglXQVJOSU5HUyBGT1IgIlByb2ZpbGUuRGF0YSIgVkFMVUVTOgoJIAkhIERvIG5vdCBjcmVhdGUgbnVtZXJpYyB0YWJsZXMgd2l0aCBnYXBzIC0gYXR0ZW1wdGluZyB0byBzdG9yZSBzdWNoIHRhYmxlcyB3aWxsIHJlc3VsdCBpbiBhbiBlcnJvci4KCQkhIERvIG5vdCBjcmVhdGUgbWl4ZWQgdGFibGVzIChzb21lIHZhbHVlcyBpbmRleGVkIGJ5IG51bWJlciBhbmQgb3RoZXJzIGJ5IGEgc3RyaW5nIGtleSkKCQkJLSBvbmx5IG51bWVyaWNhbGx5IGluZGV4ZWQgIGRhdGEgd2lsbCBiZSBzdG9yZWQuCgkJISBEbyBub3QgaW5kZXggdGFibGVzIGJ5IGFueXRoaW5nIG90aGVyIHRoYW4gbnVtYmVycyBhbmQgc3RyaW5ncy4KCQkhIERvIG5vdCByZWZlcmVuY2UgUm9ibG94IEluc3RhbmNlcwoJCSEgRG8gbm90IHJlZmVyZW5jZSB1c2VyZGF0YSAoVmVjdG9yMywgQ29sb3IzLCBDRnJhbWUuLi4pIC0gU2VyaWFsaXplIHVzZXJkYXRhIGJlZm9yZSByZWZlcmVuY2luZwoJCSEgRG8gbm90IHJlZmVyZW5jZSBmdW5jdGlvbnMKCQkKCU1lbWJlcnM6CgkKCQlQcm9maWxlU3RvcmUuSXNDbG9zaW5nICAgICAgICAgIFtib29sXQoJCQktLSBTZXQgdG8gdHJ1ZSBhZnRlciBhIGdhbWU6QmluZFRvQ2xvc2UoKSB0cmlnZ2VyCgkJCQoJCVByb2ZpbGVTdG9yZS5Jc0NyaXRpY2FsU3RhdGUgICAgW2Jvb2xdCgkJCS0tIFNldCB0byB0cnVlIHdoZW4gUHJvZmlsZVN0b3JlIGV4cGVyaWVuY2VzIHRvbyBtYW55IGNvbnNlY3V0aXZlIGVycm9ycwoJCQoJCVByb2ZpbGVTdG9yZS5PbkVycm9yICAgICAgICAgICAgW1NpZ25hbF0gKG1lc3NhZ2UsIHN0b3JlX25hbWUsIHByb2ZpbGVfa2V5KQoJCQktLSBNb3N0IFByb2ZpbGVTdG9yZSBlcnJvcnMgd2lsbCBiZSBjYXVnaHQgYW5kIHBhc3NlZCB0byB0aGlzIHNpZ25hbAoJCQkKCQlQcm9maWxlU3RvcmUuT25PdmVyd3JpdGUgICAgICAgIFtTaWduYWxdIChzdG9yZV9uYW1lLCBwcm9maWxlX2tleSkKCQkJLS0gVHJpZ2dlcmVkIHdoZW4gYSBEYXRhU3RvcmUga2V5IHdhcyBsaWtlbHkgdXNlZCB0byBzdG9yZSBkYXRhIHRoYXQgd2Fzbid0CgkJCWEgUHJvZmlsZVN0b3JlIHByb2ZpbGUgb3IgdGhlIFByb2ZpbGVTdG9yZSBzdHJ1Y3R1cmUgd2FzIGludmFsaWRseSBtYW51YWxseQoJCQlhbHRlcmVkIGZvciB0aGF0IERhdGFTdG9yZSBrZXkKCQkJCgkJUHJvZmlsZVN0b3JlLk9uQ3JpdGljYWxUb2dnbGUgICBbU2lnbmFsXSAoaXNfY3JpdGljYWwpCgkJCS0tIFRyaWdnZXJlZCB3aGVuIFByb2ZpbGVTdG9yZSBleHBlcmllbmNlcyB0b28gbWFueSBjb25zZWN1dGl2ZSBlcnJvcnMKCQkKCQlQcm9maWxlU3RvcmUuRGF0YVN0b3JlU3RhdGUgICAgIFtzdHJpbmddICgiTm90UmVhZHkiLCAiTm9JbnRlcm5ldCIsICJOb0FjY2VzcyIsICJBY2Nlc3MiKQoJCQktLSBUaGlzIHZhbHVlIHJlc2VtYmxlcyBQcm9maWxlU3RvcmUncyBhY2Nlc3MgdG8gdGhlIERhdGFTdG9yZTsgVGhlIHZhbHVlIHN0YXJ0cwoJCQlhcyAiTm90UmVhZHkiIGFuZCB3aWxsIGV2ZW50dWFsbHkgY2hhbmdlIHRvIG9uZSBvZiB0aGUgb3RoZXIgMyBwb3NzaWJsZSB2YWx1ZXMuCgkKCUZ1bmN0aW9uczoKCQoJCVByb2ZpbGVTdG9yZS5OZXcoc3RvcmVfbmFtZSwgdGVtcGxhdGU/KSAtLT4gW1Byb2ZpbGVTdG9yZV0KCQkJc3RvcmVfbmFtZSAgIFtzdHJpbmddIC0tIERhdGFTdG9yZSBuYW1lCgkJCXRlbXBsYXRlICAgICBbdGFibGVdIG9yIG5pbCAtLSBQcm9maWxlcyB3aWxsIGRlZmF1bHQgdG8gZ2l2ZW4gdGFibGUgKGhhcmQtY29weSkgd2hlbiBubyBkYXRhIHdhcyBzYXZlZCBwcmV2aW91c2x5CgkJCQoJCVByb2ZpbGVTdG9yZS5TZXRDb25zdGFudChuYW1lLCB2YWx1ZSkKCQkJbmFtZSAgICBbc3RyaW5nXQoJCQl2YWx1ZSAgIFtudW1iZXJdCgkJCQkKCU1lbWJlcnMgW1Byb2ZpbGVTdG9yZV06CgkKCQlQcm9maWxlU3RvcmUuTW9jayAgIFtQcm9maWxlU3RvcmVdCgkJCS0tIFJlZmxlY3Rpb24gb2YgUHJvZmlsZVN0b3JlIG1ldGhvZHMsIGJ1dCB0aGUgbWV0aG9kcyB3aWxsIG5vdyBxdWVyeSBhIG1vY2sKCQkJRGF0YVN0b3JlIHdpdGggbm8gcmVsYXRpb24gdG8gdGhlIHJlYWwgRGF0YVN0b3JlCgkJCQoJCVByb2ZpbGVTdG9yZS5OYW1lICAgW3N0cmluZ10KCQkKCU1ldGhvZHMgW1Byb2ZpbGVTdG9yZV06CgkKCQlQcm9maWxlU3RvcmU6U3RhcnRTZXNzaW9uQXN5bmMocHJvZmlsZV9rZXksIHBhcmFtcz8pIC0tPiBbUHJvZmlsZV0gb3IgbmlsCgkJCXByb2ZpbGVfa2V5IFtzdHJpbmddIC0tIERhdGFTdG9yZSBrZXkKCQkJcGFyYW1zICAgICAgbmlsIG9yIFt0YWJsZV06IC0tIEN1c3RvbSBwYXJhbXM7IEUuZy4ge1N0ZWFsID0gdHJ1ZX0KCQkJCXsKCQkJCQlTdGVhbCA9IHRydWUsIC0tIFBhc3MgdGhpcyB0byBkaXNyZWdhcmQgYW4gZXhpc3Rpbmcgc2Vzc2lvbiBsb2NrCgkJCQkJQ2FuY2VsID0gZm4oKSAtPiAoYm9vbGVhbiksIC0tIFBhc3MgdGhpcyB0byBjcmVhdGUgYSByZXF1ZXN0IGNhbmNlbCBjb25kaXRpb24uCgkJCQkJCS0tIElmIHRoZSBjYW5jZWwgZnVuY3Rpb24gcmV0dXJucyB0cnVlLCBQcm9maWxlU3RvcmUgd2lsbCBzdG9wIHRyeWluZyB0bwoJCQkJCQktLSBzdGFydCB0aGUgc2Vzc2lvbiBhbmQgcmV0dXJuIG5pbAoJCQkJfQoJCQkKCQlQcm9maWxlU3RvcmU6TWVzc2FnZUFzeW5jKHByb2ZpbGVfa2V5LCBtZXNzYWdlKSAtLT4gaXNfc3VjY2VzcyBbYm9vbF0KCQkJcHJvZmlsZV9rZXkgW3N0cmluZ10gLS0gRGF0YVN0b3JlIGtleQoJCQltZXNzYWdlICAgICBbdGFibGVdIC0tIERhdGEgdG8gYmUgbWVzc2FnZWQgdG8gdGhlIHByb2ZpbGUKCQkJCgkJUHJvZmlsZVN0b3JlOkdldEFzeW5jKHByb2ZpbGVfa2V5LCB2ZXJzaW9uPykgLS0+IFtQcm9maWxlXSBvciBuaWwKCQkJLS0gUmVhZHMgYSBwcm9maWxlIHdpdGhvdXQgc3RhcnRpbmcgYSBzZXNzaW9uIC0gd2lsbCBub3QgYXV0b3NhdmUKCQkJcHJvZmlsZV9rZXkgICBbc3RyaW5nXSAtLSBEYXRhU3RvcmUga2V5CgkJCXZlcnNpb24gICAgICAgbmlsIG9yIFtzdHJpbmddIC0tIERhdGFTdG9yZSBrZXkgdmVyc2lvbgoKCQlQcm9maWxlU3RvcmU6VmVyc2lvblF1ZXJ5KHByb2ZpbGVfa2V5LCBzb3J0X2RpcmVjdGlvbj8sIG1pbl9kYXRlPywgbWF4X2RhdGU/KSAtLT4gW1ZlcnNpb25RdWVyeV0KCQkJcHJvZmlsZV9rZXkgICAgICBbc3RyaW5nXQoJCQlzb3J0X2RpcmVjdGlvbiAgIG5pbCBvciBbRW51bS5Tb3J0RGlyZWN0aW9uXQoJCQltaW5fZGF0ZSAgICAgICAgIG5pbCBvciBbRGF0ZVRpbWVdCgkJCW1heF9kYXRlICAgICAgICAgbmlsIG9yIFtEYXRlVGltZV0KCQkJCgkJUHJvZmlsZVN0b3JlOlJlbW92ZUFzeW5jKHByb2ZpbGVfa2V5KSAtLT4gaXNfc3VjY2VzcyBbYm9vbF0KCQkJLS0gQ29tcGxldGVseSByZW1vdmVzIHByb2ZpbGUgZGF0YSBmcm9tIHRoZSBEYXRhU3RvcmUgLyBtb2NrIERhdGFTdG9yZSB3aXRoIG5vIHdheSB0byByZWNvdmVyIGl0LgoKCU1ldGhvZHMgW1ZlcnNpb25RdWVyeV06CgoJCVZlcnNpb25RdWVyeTpOZXh0QXN5bmMoKSAtLT4gW1Byb2ZpbGVdIG9yIG5pbCAtLSAoWWllbGRzKQoJCQktLSBSZXR1cm5lZCBwcm9maWxlIGlzIHNpbWlsYXIgdG8gcHJvZmlsZXMgcmV0dXJuZWQgYnkgUHJvZmlsZVN0b3JlOkdldEFzeW5jKCkKCQkKCU1lbWJlcnMgW1Byb2ZpbGVdOgoJCgkJUHJvZmlsZS5EYXRhICAgICAgICAgICAgICAgW3RhYmxlXQoJCQktLSBXaGVuIHRoZSBwcm9maWxlIGlzIGFjdGl2ZSBjaGFuZ2VzIHRvIHRoaXMgdGFibGUgYXJlIGd1YXJhbnRlZWQgdG8gYmUgc2F2ZWQKCQlQcm9maWxlLkxhc3RTYXZlZERhdGEgICAgICBbdGFibGVdIChSZWFkLW9ubHkpCgkJCS0tIExhc3Qgc25hcHNob3Qgb2YgIlByb2ZpbGUuRGF0YSIgdGhhdCBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgc2F2ZWQgdG8gdGhlIERhdGFTdG9yZTsKCQkJVXNlZnVsIGZvciBwcm9wZXIgZGV2ZWxvcGVyIHByb2R1Y3QgcHVyY2hhc2UgcmVjZWlwdCBoYW5kbGluZwoJCQoJCVByb2ZpbGUuRmlyc3RTZXNzaW9uVGltZSAgIFtudW1iZXJdIChSZWFkLW9ubHkpCgkJCS0tIG9zLnRpbWUoKSB0aW1lc3RhbXAgb2YgdGhlIGZpcnN0IHByb2ZpbGUgc2Vzc2lvbgoJCQkKCQlQcm9maWxlLlNlc3Npb25Mb2FkQ291bnQgICBbbnVtYmVyXSAoUmVhZC1vbmx5KSAtLSBBbW91bnQgb2YgdGltZXMgYSBzZXNzaW9uIHdhcyBzdGFydGVkIGZvciB0aGlzIHByb2ZpbGUKCQkJCgkJUHJvZmlsZS5TZXNzaW9uICAgICAgICAgICAgW3RhYmxlXSAoUmVhZC1vbmx5KSB7UGxhY2VJZCA9IG51bWJlciwgSm9iSWQgPSBzdHJpbmd9IC8gbmlsCgkJCS0tIFNldCB0byBhIHRhYmxlIGlmIHRoaXMgcHJvZmlsZSBpcyBpbiB1c2UgYnkgYSBzZXJ2ZXI7IG5pbCBpZiByZWxlYXNlZAoKCQlQcm9maWxlLlJvYmxveE1ldGFEYXRhICAgICBbdGFibGVdIC0tIFdyaXRhYmxlIHRhYmxlIHRoYXQgZ2V0cyBzYXZlZCBhdXRvbWF0aWNhbGx5IGFuZCBvbmNlIHRoZSBwcm9maWxlIGlzIHJlbGVhc2VkCgkJUHJvZmlsZS5Vc2VySWRzICAgICAgICAgICAgW3RhYmxlXSAtLSAoUmVhZC1vbmx5KSAtLSB7dXNlcl9pZCBbbnVtYmVyXSwgLi4ufSAtLSBVc2VyIGlkcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBwcm9maWxlCgoJCVByb2ZpbGUuS2V5SW5mbyAgICAgICAgICAgIFtEYXRhU3RvcmVLZXlJbmZvXSAtLSBDaGFuZ2VzIGJlZm9yZSBPbkFmdGVyU2F2ZSBzaWduYWwKCQkKCQlQcm9maWxlLk9uU2F2ZSAgICAgICAgICAgICBbU2lnbmFsXSAoKQoJCQktLSBUcmlnZ2VyZWQgcmlnaHQgYmVmb3JlIGNoYW5nZXMgdG8gUHJvZmlsZS5EYXRhIGFyZSBzYXZlZCB0byB0aGUgRGF0YVN0b3JlCgkJCQoJCVByb2ZpbGUuT25MYXN0U2F2ZSAgICAgICAgIFtTaWduYWxdIChyZWFzb24gW3N0cmluZ106ICJNYW51YWwiLCAiRXh0ZXJuYWwiLCAiU2h1dGRvd24iKQoJCQktLSBUcmlnZ2VyZWQgcmlnaHQgYmVmb3JlIGNoYW5nZXMgdG8gUHJvZmlsZS5EYXRhIGFyZSBzYXZlZCB0byB0aGUgRGF0YVN0b3JlCgkJCWZvciB0aGUgbGFzdCB0aW1lOyBBIHJlYXNvbiBpcyBwcm92aWRlZCBmb3IgdGhlIGxhc3Qgc2F2ZToKCQkJCS0gIk1hbnVhbCIgICAtIFByb2ZpbGU6RW5kU2Vzc2lvbigpIHdhcyBjYWxsZWQKCQkJCS0gIlNodXRkb3duIiAtIFRoZSBzZXJ2ZXIgdGhhdCBoYXMgb3duZXJzaGlwIG9mIHRoaXMgcHJvZmlsZSBpcyBzaHV0dGluZyBkb3duCgkJCQktICJFeHRlcm5hbCIgLSBBbm90aGVyIHNlcnZlciBoYXMgc3RhcnRlZCBhIHNlc3Npb24gZm9yIHRoaXMgcHJvZmlsZQoJCQlOb3RlIHRoYXQgdGhpcyBldmVudCB3aWxsIG5vdCB0cmlnZ2VyIGZvciB3aGVuIGEgcHJvZmlsZSBzZXNzaW9uIGlzIGVuZGVkIGJ5CgkJCWFub3RoZXIgc2VydmVyIHRyeWluZyB0byB0YWtlIG93bmVyc2hpcCBvZiB0aGUgc2Vzc2lvbiAtIHRoaXMgaXMgaW1wb3NzaWJsZSB0bwoJCQlkbyB3aXRob3V0IGNvbXByb21pc2luZyBvbiBQcm9maWxlU3RvcmUncyBzcGVlZC4KCQkJCgkJUHJvZmlsZS5PblNlc3Npb25FbmQgICAgICAgW1NpZ25hbF0gKCkKCQkJLS0gVHJpZ2dlcmVkIHdoZW4gdGhlIHByb2ZpbGUgc2Vzc2lvbiBpcyB0ZXJtaW5hdGVkIG9uIHRoaXMgc2VydmVyCgkJCgkJUHJvZmlsZS5PbkFmdGVyU2F2ZSAgICAgICAgW1NpZ25hbF0gKGxhc3Rfc2F2ZWRfZGF0YSkKCQkJLS0gVHJpZ2dlcmVkIGFmdGVyIGEgc3VjY2Vzc2Z1bCBzYXZlCgkJCWxhc3Rfc2F2ZWRfZGF0YSBbdGFibGVdIC0tIFByb2ZpbGUuTGFzdFNhdmVkRGF0YQoJCQkKCQlQcm9maWxlLlByb2ZpbGVTdG9yZSAgICAgICBbUHJvZmlsZVN0b3JlXSAtLSBQcm9maWxlU3RvcmUgb2JqZWN0IHRoaXMgcHJvZmlsZSBiZWxvbmdzIHRvCgkJUHJvZmlsZS5LZXkgICAgICAgICAgICAgICAgW3N0cmluZ10gLS0gRGF0YVN0b3JlIGtleQoJCQoJTWV0aG9kcyBbUHJvZmlsZV06CgkKCQlQcm9maWxlOklzQWN0aXZlKCkgLS0+IFtib29sXSAtLSBJZiAidHJ1ZSIgaXMgcmV0dXJuZWQsIGNoYW5nZXMgdG8gUHJvZmlsZS5EYXRhIGFyZSBndWFyYW50ZWVkIHRvIHNhdmU7CgkJCVRoaXMgZ3VhcmFudGVlIGlzIG9ubHkgdmFsaWQgdW50aWwgY29kZSB5aWVsZHMgKGUuZy4gdGFzay53YWl0KCkgaXMgdXNlZCkuCgkJCQoJCVByb2ZpbGU6UmVjb25jaWxlKCkgLS0gRmlsbHMgaW4gbWlzc2luZyAobmlsKSBbc3RyaW5nX2tleV0gPSBbdmFsdWVdIHBhaXJzIHRvIHRoZSBQcm9maWxlLkRhdGEgc3RydWN0dXJlCgkJCWZyb20gdGhlICJ0ZW1wbGF0ZSIgYXJndW1lbnQgdGhhdCB3YXMgcGFzc2VkIHRvICJQcm9maWxlU3RvcmUuTmV3KCkiCgkJCQoJCVByb2ZpbGU6RW5kU2Vzc2lvbigpIC0tIENhbGwgYWZ0ZXIgdGhlIHNlcnZlciBoYXMgZmluaXNoZWQgd29ya2luZyB3aXRoIHRoaXMgcHJvZmlsZQoJCQllLmcuLCBhZnRlciB0aGUgcGxheWVyIGxlYXZlcyAoUHJvZmlsZSBvYmplY3Qgd2lsbCBiZWNvbWUgaW5hY3RpdmUpCgoJCVByb2ZpbGU6QWRkVXNlcklkKHVzZXJfaWQpIC0tIEFzc29jaWF0ZXMgdXNlcl9pZCB3aXRoIHByb2ZpbGUgKEdEUFIgY29tcGxpYW5jZSkKCQkJdXNlcl9pZCAgIFtudW1iZXJdCgoJCVByb2ZpbGU6UmVtb3ZlVXNlcklkKHVzZXJfaWQpIC0tIFVuYXNzb2NpYXRlcyB1c2VyX2lkIHdpdGggcHJvZmlsZSAoc2FmZSBmdW5jdGlvbikKCQkJdXNlcl9pZCAgIFtudW1iZXJdCgkJCQoJCVByb2ZpbGU6TWVzc2FnZUhhbmRsZXIoZm4pIC0tIFNldHMgYSBtZXNzYWdlIGhhbmRsZXIgZm9yIHRoaXMgcHJvZmlsZQoJCQlmbiBbZnVuY3Rpb25dIChtZXNzYWdlIFt0YWJsZV0sIHByb2Nlc3NlZCBbZnVuY3Rpb25dKCkpCgkJCS0tIFRoZSBoYW5kbGVyIGZ1bmN0aW9uIHJlY2VpdmVzIGEgbWVzc2FnZSB0YWJsZSBhbmQgYSBjYWxsYmFjayBmdW5jdGlvbjsKCQkJVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGlzIHRvIGJlIGNhbGxlZCB3aGVuIGEgbWVzc2FnZSBoYXMgYmVlbiBwcm9jZXNzZWQKCQkJLSB0aGlzIHdpbGwgZGlzY2FyZCB0aGUgbWVzc2FnZSBmcm9tIHRoZSBwcm9maWxlIG1lc3NhZ2UgY2FjaGU7IElmIHRoZQoJCQljYWxsYmFjayBmdW5jdGlvbiBpcyBub3QgY2FsbGVkLCBvdGhlciBtZXNzYWdlIGhhbmRsZXJzIHdpbGwgYWxzbyBiZSB0cmlnZ2VyZWQKCQkJd2l0aCB1bnByb2Nlc3NlZCBtZXNzYWdlIGRhdGEuCgkJCQoJCVByb2ZpbGU6U2F2ZSgpIC0tIElmIHRoZSBwcm9maWxlIHNlc3Npb24gaXMgc3RpbGwgYWN0aXZlIG1ha2VzIGFuIFVwZGF0ZUFzeW5jIGNhbGwKCQkJdG8gdGhlIERhdGFTdG9yZSB0byBpbW1lZGlhdGVseSBzYXZlIHByb2ZpbGUgZGF0YQoKCQlQcm9maWxlOlNldEFzeW5jKCkgLS0gRm9yY2VmdWxseSBzYXZlcyBjaGFuZ2VzIHRvIHRoZSBwcm9maWxlOyBPbmx5IGZvciBwcm9maWxlcwoJCQlsb2FkZWQgd2l0aCBQcm9maWxlU3RvcmU6R2V0QXN5bmMoKSBvciBQcm9maWxlU3RvcmU6VmVyc2lvblF1ZXJ5KCkKCQkKLS1dXQoKbG9jYWwgQVVUT19TQVZFX1BFUklPRCA9IDMwMCAtLSAoU2Vjb25kcykgVGltZSBiZXR3ZWVuIHdoZW4gY2hhbmdlcyB0byBhIHByb2ZpbGUgYXJlIHNhdmVkIHRvIHRoZSBEYXRhU3RvcmUKbG9jYWwgTE9BRF9SRVBFQVRfUEVSSU9EID0gMTAgLS0gKFNlY29uZHMpIFRpbWUgYmV0d2VlbiBzdWNjZXNzaXZlIHByb2ZpbGUgcmVhZHMgd2hlbiBoYW5kbGluZyBhIHNlc3Npb24gY29uZmxpY3QKbG9jYWwgRklSU1RfTE9BRF9SRVBFQVQgPSA1IC0tIChTZWNvbmRzKSBUaW1lIGJldHdlZW4gZmlyc3QgYW5kIHNlY29uZCBwcm9maWxlIHJlYWQgd2hlbiBoYW5kbGluZyBhIHNlc3Npb24gY29uZmxpY3QKbG9jYWwgU0VTU0lPTl9TVEVBTCA9IDQwIC0tIChTZWNvbmRzKSBUaW1lIHVudGlsIGEgc2Vzc2lvbiBjb25mbGljdCBpcyByZXNvbHZlZCB3aXRoIHRoZSB3YWl0aW5nIHNlcnZlciBzdGVhbGluZyB0aGUgc2Vzc2lvbgpsb2NhbCBBU1NVTUVfREVBRCA9IDYzMCAtLSAoU2Vjb25kcykgSWYgYSBwcm9maWxlIGhhc24ndCBoYWQgdXBkYXRlcyBmb3IgdGhpcyBsb25nLCBxdWlja2x5IGFzc3VtZSBhbiBhY3RpdmUgc2Vzc2lvbiBiZWxvbmdzIHRvIGEgY3Jhc2hlZCBzZXJ2ZXIKbG9jYWwgU1RBUlRfU0VTU0lPTl9USU1FT1VUID0gMTIwIC0tIChTZWNvbmRzKSBJZiBhIHNlc3Npb24gY2FuJ3QgYmUgc3RhcnRlZCBmb3IgYSBwcm9maWxlIGZvciB0aGlzIGxvbmcsIHN0b3AgcmVwZWF0aW5nIGNhbGxzIHRvIHRoZSBEYXRhU3RvcmUKCmxvY2FsIENSSVRJQ0FMX1NUQVRFX0VSUk9SX0NPVU5UID0gNSAtLSBBc3N1bWUgY3JpdGljYWwgc3RhdGUgaWYgdGhpcyBtYW55IGlzc3VlcyBoYXBwZW4gaW4gYSBzaG9ydCBhbW91bnQgb2YgdGltZQpsb2NhbCBDUklUSUNBTF9TVEFURV9FUlJPUl9FWFBJUkUgPSAxMjAgLS0gKFNlY29uZHMpIEluZGl2aWR1YWwgaXNzdWUgZXhwaXJhdGlvbgpsb2NhbCBDUklUSUNBTF9TVEFURV9FWFBJUkUgPSAxMjAgLS0gKFNlY29uZHMpIENyaXRpY2FsIHN0YXRlIGV4cGlyYXRpb24KCmxvY2FsIE1BWF9NRVNTQUdFX1FVRVVFID0gMTAwMCAtLSBNYXggbWVzc2FnZXMgc2F2ZWQgaW4gYSBwcm9maWxlIHRoYXQgd2VyZSBzZW50IHVzaW5nICJQcm9maWxlU3RvcmU6TWVzc2FnZUFzeW5jKCkiCgotLS0tLSBEZXBlbmRlbmNpZXMgLS0tLS0KCi0tIGxvY2FsIFV0aWwgPSByZXF1aXJlKGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuU2hhcmVkLlV0aWwpCi0tIGxvY2FsIFNpZ25hbCA9IFV0aWwuU2lnbmFsCgpsb2NhbCBTaWduYWwgZG8KCglsb2NhbCBGcmVlUnVubmVyVGhyZWFkCgoJLS1bWwoJCVlpZWxkLXNhZmUgY29yb3V0aW5lIHJldXNpbmcgYnkgc3RyYXZhbnQ7CgkJU291cmNlczoKCQlodHRwczovL2RldmZvcnVtLnJvYmxveC5jb20vdC9sdWEtc2lnbmFsLWNsYXNzLWNvbXBhcmlzb24tb3B0aW1hbC1nb29kc2lnbmFsLWNsYXNzLzEzODcwNjMKCQlodHRwczovL2dpc3QuZ2l0aHViLmNvbS9zdHJhdmFudC9iNzVhMzIyZTA5MTlkNjBkZGU4YTAzMTZkMWYwOWQyZgoJLS1dXQoKCWxvY2FsIGZ1bmN0aW9uIEFjcXVpcmVSdW5uZXJUaHJlYWRBbmRDYWxsRXZlbnRIYW5kbGVyKGZuLCAuLi4pCgkJbG9jYWwgYWNxdWlyZWRfcnVubmVyX3RocmVhZCA9IEZyZWVSdW5uZXJUaHJlYWQKCQlGcmVlUnVubmVyVGhyZWFkID0gbmlsCgkJZm4oLi4uKQoJCS0tIFRoZSBoYW5kbGVyIGZpbmlzaGVkIHJ1bm5pbmcsIHRoaXMgcnVubmVyIHRocmVhZCBpcyBmcmVlIGFnYWluLgoJCUZyZWVSdW5uZXJUaHJlYWQgPSBhY3F1aXJlZF9ydW5uZXJfdGhyZWFkCgllbmQKCglsb2NhbCBmdW5jdGlvbiBSdW5FdmVudEhhbmRsZXJJbkZyZWVUaHJlYWQoLi4uKQoJCUFjcXVpcmVSdW5uZXJUaHJlYWRBbmRDYWxsRXZlbnRIYW5kbGVyKC4uLikKCQl3aGlsZSB0cnVlIGRvCgkJCUFjcXVpcmVSdW5uZXJUaHJlYWRBbmRDYWxsRXZlbnRIYW5kbGVyKGNvcm91dGluZS55aWVsZCgpKQoJCWVuZAoJZW5kCgoJbG9jYWwgQ29ubmVjdGlvbiA9IHt9CglDb25uZWN0aW9uLl9faW5kZXggPSBDb25uZWN0aW9uCgoJbG9jYWwgU2lnbmFsQ2xhc3MgPSB7fQoJU2lnbmFsQ2xhc3MuX19pbmRleCA9IFNpZ25hbENsYXNzCgoJZnVuY3Rpb24gQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKCgkJaWYgc2VsZi5pc19jb25uZWN0ZWQgPT0gZmFsc2UgdGhlbgoJCQlyZXR1cm4KCQllbmQKCgkJbG9jYWwgc2lnbmFsID0gc2VsZi5zaWduYWwKCQlzZWxmLmlzX2Nvbm5lY3RlZCA9IGZhbHNlCgkJc2lnbmFsLmxpc3RlbmVyX2NvdW50IC09IDEKCgkJaWYgc2lnbmFsLmhlYWQgPT0gc2VsZiB0aGVuCgkJCXNpZ25hbC5oZWFkID0gc2VsZi5uZXh0CgkJZWxzZQoJCQlsb2NhbCBwcmV2ID0gc2lnbmFsLmhlYWQKCQkJd2hpbGUgcHJldiB+PSBuaWwgYW5kIHByZXYubmV4dCB+PSBzZWxmIGRvCgkJCQlwcmV2ID0gcHJldi5uZXh0CgkJCWVuZAoJCQlpZiBwcmV2IH49IG5pbCB0aGVuCgkJCQlwcmV2Lm5leHQgPSBzZWxmLm5leHQKCQkJZW5kCgkJZW5kCgoJZW5kCgoJZnVuY3Rpb24gU2lnbmFsQ2xhc3MuTmV3KCkKCgkJbG9jYWwgc2VsZiA9IHsKCQkJaGVhZCA9IG5pbCwKCQkJbGlzdGVuZXJfY291bnQgPSAwLAoJCX0KCQlzZXRtZXRhdGFibGUoc2VsZiwgU2lnbmFsQ2xhc3MpCgoJCXJldHVybiBzZWxmCgoJZW5kCgoJZnVuY3Rpb24gU2lnbmFsQ2xhc3M6Q29ubmVjdChsaXN0ZW5lcjogKC4uLmFueSkgLT4gKCkpCgoJCWlmIHR5cGUobGlzdGVuZXIpIH49ICJmdW5jdGlvbiIgdGhlbgoJCQllcnJvcihgW3tzY3JpcHQuTmFtZX1dOiBcImxpc3RlbmVyXCIgbXVzdCBiZSBhIGZ1bmN0aW9uOyBSZWNlaXZlZCB7dHlwZW9mKGxpc3RlbmVyKX1gKQoJCWVuZAoKCQlsb2NhbCBjb25uZWN0aW9uID0gewoJCQlsaXN0ZW5lciA9IGxpc3RlbmVyLAoJCQlzaWduYWwgPSBzZWxmLAoJCQluZXh0ID0gc2VsZi5oZWFkLAoJCQlpc19jb25uZWN0ZWQgPSB0cnVlLAoJCX0KCQlzZXRtZXRhdGFibGUoY29ubmVjdGlvbiwgQ29ubmVjdGlvbikKCgkJc2VsZi5oZWFkID0gY29ubmVjdGlvbgoJCXNlbGYubGlzdGVuZXJfY291bnQgKz0gMQoKCQlyZXR1cm4gY29ubmVjdGlvbgoKCWVuZAoKCWZ1bmN0aW9uIFNpZ25hbENsYXNzOkdldExpc3RlbmVyQ291bnQoKTogbnVtYmVyCgkJcmV0dXJuIHNlbGYubGlzdGVuZXJfY291bnQKCWVuZAoKCWZ1bmN0aW9uIFNpZ25hbENsYXNzOkZpcmUoLi4uKQoJCWxvY2FsIGl0ZW0gPSBzZWxmLmhlYWQKCQl3aGlsZSBpdGVtIH49IG5pbCBkbwoJCQlpZiBpdGVtLmlzX2Nvbm5lY3RlZCA9PSB0cnVlIHRoZW4KCQkJCWlmIG5vdCBGcmVlUnVubmVyVGhyZWFkIHRoZW4KCQkJCQlGcmVlUnVubmVyVGhyZWFkID0gY29yb3V0aW5lLmNyZWF0ZShSdW5FdmVudEhhbmRsZXJJbkZyZWVUaHJlYWQpCgkJCQllbmQKCQkJCXRhc2suc3Bhd24oRnJlZVJ1bm5lclRocmVhZCwgaXRlbS5saXN0ZW5lciwgLi4uKQoJCQllbmQKCQkJaXRlbSA9IGl0ZW0ubmV4dAoJCWVuZAoJZW5kCgoJZnVuY3Rpb24gU2lnbmFsQ2xhc3M6V2FpdCgpCgkJbG9jYWwgY28gPSBjb3JvdXRpbmUucnVubmluZygpCgkJbG9jYWwgY29ubmVjdGlvbgoJCWNvbm5lY3Rpb24gPSBzZWxmOkNvbm5lY3QoZnVuY3Rpb24oLi4uKQoJCQljb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQoJCQl0YXNrLnNwYXduKGNvLCAuLi4pCgkJZW5kKQoJCXJldHVybiBjb3JvdXRpbmUueWllbGQoKQoJZW5kCgoJU2lnbmFsID0gdGFibGUuZnJlZXplKHsKCQlOZXcgPSBTaWduYWxDbGFzcy5OZXcsCgl9KQoKZW5kCgotLS0tLSBQcml2YXRlIC0tLS0tCgpsb2NhbCBBY3RpdmVTZXNzaW9uQ2hlY2sgPSB7fSAtLSB7W3Nlc3Npb25fdG9rZW5dID0gcHJvZmlsZSwgLi4ufQpsb2NhbCBBdXRvU2F2ZUxpc3QgPSB7fSAtLSB7cHJvZmlsZSwgLi4ufSAtLSBMb2FkZWQgcHJvZmlsZSB0YWJsZSB3aGljaCB3aWxsIGJlIGNpcmN1bGFybHkgYXV0by1zYXZlZApsb2NhbCBJc3N1ZVF1ZXVlID0ge30gLS0ge2lzc3VlX3RpbWUsIC4uLn0KCmxvY2FsIERhdGFTdG9yZVNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkRhdGFTdG9yZVNlcnZpY2UiKQpsb2NhbCBNZXNzYWdpbmdTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJNZXNzYWdpbmdTZXJ2aWNlIikKbG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCgpsb2NhbCBQbGFjZUlkID0gZ2FtZS5QbGFjZUlkCmxvY2FsIEpvYklkID0gZ2FtZS5Kb2JJZAoKbG9jYWwgQXV0b1NhdmVJbmRleCA9IDEgLS0gTmV4dCBwcm9maWxlIHRvIGF1dG8gc2F2ZQpsb2NhbCBMYXN0QXV0b1NhdmUgPSBvcy5jbG9jaygpCgpsb2NhbCBMb2FkSW5kZXggPSAwCgpsb2NhbCBBY3RpdmVQcm9maWxlTG9hZEpvYnMgPSAwIC0tIE51bWJlciBvZiBhY3RpdmUgdGhyZWFkcyB0aGF0IGFyZSBsb2FkaW5nIGluIHByb2ZpbGVzCmxvY2FsIEFjdGl2ZVByb2ZpbGVTYXZlSm9icyA9IDAgLS0gTnVtYmVyIG9mIGFjdGl2ZSB0aHJlYWRzIHRoYXQgYXJlIHNhdmluZyBwcm9maWxlcwoKbG9jYWwgQ3JpdGljYWxTdGF0ZVN0YXJ0ID0gMCAtLSBvcy5jbG9jaygpCgpsb2NhbCBJc1N0dWRpbyA9IFJ1blNlcnZpY2U6SXNTdHVkaW8oKQpsb2NhbCBEYXRhU3RvcmVTdGF0ZTogIk5vdFJlYWR5IiB8ICJOb0ludGVybmV0IiB8ICJOb0FjY2VzcyIgfCAiQWNjZXNzIiA9ICJOb3RSZWFkeSIKCmxvY2FsIE1vY2tTdG9yZSA9IHt9CmxvY2FsIFVzZXJNb2NrU3RvcmUgPSB7fQpsb2NhbCBNb2NrRmxhZyA9IGZhbHNlCgpsb2NhbCBPbkVycm9yID0gU2lnbmFsLk5ldygpIC0tIChtZXNzYWdlLCBzdG9yZV9uYW1lLCBwcm9maWxlX2tleSkKbG9jYWwgT25PdmVyd3JpdGUgPSBTaWduYWwuTmV3KCkgLS0gKHN0b3JlX25hbWUsIHByb2ZpbGVfa2V5KQoKbG9jYWwgVXBkYXRlUXVldWUgPSB7IC0tIEZvciBzdGFiaWxpdHkgc2FrZSwgd2Ugd29uJ3QgZG8gVXBkYXRlQXN5bmMgY2FsbHMgZm9yIHRoZSBzYW1lIGtleSB1bnRpbCBhbGwgcHJldmlvdXMgY2FsbHMgZmluaXNoCgktLVtbCgkJW3Nlc3Npb25fdG9rZW5dID0gewoJCQljb3JvdXRpbmUsIC4uLgoJCX0sCgkJLi4uCgktLV1dCn0KCmxvY2FsIGZ1bmN0aW9uIFdhaXRJblVwZGF0ZVF1ZXVlKHNlc3Npb25fdG9rZW4pIC0tPiBuZXh0X2luX3F1ZXVlKCkKCglsb2NhbCBpc19maXJzdCA9IGZhbHNlCgoJaWYgVXBkYXRlUXVldWVbc2Vzc2lvbl90b2tlbl0gPT0gbmlsIHRoZW4KCQlpc19maXJzdCA9IHRydWUKCQlVcGRhdGVRdWV1ZVtzZXNzaW9uX3Rva2VuXSA9IHt9CgllbmQKCglsb2NhbCBxdWV1ZSA9IFVwZGF0ZVF1ZXVlW3Nlc3Npb25fdG9rZW5dCgoJaWYgaXNfZmlyc3QgPT0gZmFsc2UgdGhlbgoJCXRhYmxlLmluc2VydChxdWV1ZSwgY29yb3V0aW5lLnJ1bm5pbmcoKSkKCQljb3JvdXRpbmUueWllbGQoKQoJZW5kCgoJcmV0dXJuIGZ1bmN0aW9uKCkKCQlsb2NhbCBuZXh0X2NvID0gdGFibGUucmVtb3ZlKHF1ZXVlLCAxKQoJCWlmIG5leHRfY28gfj0gbmlsIHRoZW4KCQkJY29yb3V0aW5lLnJlc3VtZShuZXh0X2NvKQoJCWVsc2UKCQkJVXBkYXRlUXVldWVbc2Vzc2lvbl90b2tlbl0gPSBuaWwKCQllbmQKCWVuZAoKZW5kCgpsb2NhbCBmdW5jdGlvbiBTZXNzaW9uVG9rZW4oc3RvcmVfbmFtZSwgcHJvZmlsZV9rZXksIGlzX21vY2spCgoJbG9jYWwgc2Vzc2lvbl90b2tlbiA9ICJMXyIgLS0gTGl2ZQoKCWlmIGlzX21vY2sgPT0gdHJ1ZSB0aGVuCgkJc2Vzc2lvbl90b2tlbiA9ICJVXyIgLS0gVXNlciBtb2NrCgllbHNlaWYgRGF0YVN0b3JlU3RhdGUgfj0gIkFjY2VzcyIgdGhlbgoJCXNlc3Npb25fdG9rZW4gPSAiTV8iIC0tIE1vY2ssIGNhdXNlIG5vIERhdGFTdG9yZSBhY2Nlc3MKCWVuZAoKCXNlc3Npb25fdG9rZW4gLi49IHN0b3JlX25hbWUgLi4gIlwwIiAuLiBwcm9maWxlX2tleQoKCXJldHVybiBzZXNzaW9uX3Rva2VuCgplbmQKCmxvY2FsIGZ1bmN0aW9uIERlZXBDb3B5VGFibGUodCkKCWxvY2FsIGNvcHkgPSB7fQoJZm9yIGtleSwgdmFsdWUgaW4gcGFpcnModCkgZG8KCQlpZiB0eXBlKHZhbHVlKSA9PSAidGFibGUiIHRoZW4KCQkJY29weVtrZXldID0gRGVlcENvcHlUYWJsZSh2YWx1ZSkKCQllbHNlCgkJCWNvcHlba2V5XSA9IHZhbHVlCgkJZW5kCgllbmQKCXJldHVybiBjb3B5CmVuZAoKbG9jYWwgZnVuY3Rpb24gUmVjb25jaWxlVGFibGUodGFyZ2V0LCB0ZW1wbGF0ZSkKCWZvciBrLCB2IGluIHBhaXJzKHRlbXBsYXRlKSBkbwoJCWlmIHR5cGUoaykgPT0gInN0cmluZyIgdGhlbiAtLSBPbmx5IHN0cmluZyBrZXlzIHdpbGwgYmUgcmVjb25jaWxlZAoJCQlpZiB0YXJnZXRba10gPT0gbmlsIHRoZW4KCQkJCWlmIHR5cGUodikgPT0gInRhYmxlIiB0aGVuCgkJCQkJdGFyZ2V0W2tdID0gRGVlcENvcHlUYWJsZSh2KQoJCQkJZWxzZQoJCQkJCXRhcmdldFtrXSA9IHYKCQkJCWVuZAoJCQllbHNlaWYgdHlwZSh0YXJnZXRba10pID09ICJ0YWJsZSIgYW5kIHR5cGUodikgPT0gInRhYmxlIiB0aGVuCgkJCQlSZWNvbmNpbGVUYWJsZSh0YXJnZXRba10sIHYpCgkJCWVuZAoJCWVuZAoJZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gUmVnaXN0ZXJFcnJvcihlcnJvcl9tZXNzYWdlLCBzdG9yZV9uYW1lLCBwcm9maWxlX2tleSkgLS0gQ2FsbGVkIHdoZW4gYSBEYXRhU3RvcmUgQVBJIGNhbGwgZXJyb3JzCgl3YXJuKGBbe3NjcmlwdC5OYW1lfV06IERhdGFTdG9yZSBBUEkgZXJyb3IgKFNUT1JFOntzdG9yZV9uYW1lfTsgS0VZOntwcm9maWxlX2tleX0pIC0ge3Rvc3RyaW5nKGVycm9yX21lc3NhZ2UpfWApCgl0YWJsZS5pbnNlcnQoSXNzdWVRdWV1ZSwgb3MuY2xvY2soKSkgLS0gQWRkaW5nIGlzc3VlIHRpbWUgdG8gcXVldWUKCU9uRXJyb3I6RmlyZSh0b3N0cmluZyhlcnJvcl9tZXNzYWdlKSwgc3RvcmVfbmFtZSwgcHJvZmlsZV9rZXkpCmVuZAoKbG9jYWwgZnVuY3Rpb24gUmVnaXN0ZXJPdmVyd3JpdGUoc3RvcmVfbmFtZSwgcHJvZmlsZV9rZXkpIC0tIENhbGxlZCB3aGVuIGEgY29ycnVwdGVkIHByb2ZpbGUgaXMgbG9hZGVkCgl3YXJuKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgcHJvZmlsZSB3YXMgb3ZlcndyaXR0ZW4gKFNUT1JFOntzdG9yZV9uYW1lfTsgS0VZOntwcm9maWxlX2tleX0pYCkKCU9uT3ZlcndyaXRlOkZpcmUoc3RvcmVfbmFtZSwgcHJvZmlsZV9rZXkpCmVuZAoKbG9jYWwgZnVuY3Rpb24gTmV3TW9ja0RhdGFTdG9yZUtleUluZm8ocGFyYW1zKQoKCWxvY2FsIHZlcnNpb25faWRfc3RyaW5nID0gdG9zdHJpbmcocGFyYW1zLlZlcnNpb25JZCBvciAwKQoJbG9jYWwgbWV0YV9kYXRhID0gcGFyYW1zLk1ldGFEYXRhIG9yIHt9Cglsb2NhbCB1c2VyX2lkcyA9IHBhcmFtcy5Vc2VySWRzIG9yIHt9CgoJcmV0dXJuIHsKCQlDcmVhdGVkVGltZSA9IHBhcmFtcy5DcmVhdGVkVGltZSwKCQlVcGRhdGVkVGltZSA9IHBhcmFtcy5VcGRhdGVkVGltZSwKCQlWZXJzaW9uID0gc3RyaW5nLnJlcCgiMCIsIDE2KSAuLiAiLiIKCQkJLi4gc3RyaW5nLnJlcCgiMCIsIDEwIC0gc3RyaW5nLmxlbih2ZXJzaW9uX2lkX3N0cmluZykpIC4uIHZlcnNpb25faWRfc3RyaW5nCgkJCS4uICIuIiAuLiBzdHJpbmcucmVwKCIwIiwgMTYpIC4uICIuIiAuLiAiMDEiLAoKCQlHZXRNZXRhZGF0YSA9IGZ1bmN0aW9uKCkKCQkJcmV0dXJuIERlZXBDb3B5VGFibGUobWV0YV9kYXRhKQoJCWVuZCwKCgkJR2V0VXNlcklkcyA9IGZ1bmN0aW9uKCkKCQkJcmV0dXJuIERlZXBDb3B5VGFibGUodXNlcl9pZHMpCgkJZW5kLAoJfQoKZW5kCgpsb2NhbCBmdW5jdGlvbiBNb2NrVXBkYXRlQXN5bmMobW9ja19kYXRhX3N0b3JlLCBwcm9maWxlX3N0b3JlX25hbWUsIGtleSwgdHJhbnNmb3JtX2Z1bmN0aW9uLCBpc19nZXRfY2FsbCkgLS0+IGxvYWRlZF9kYXRhLCBrZXlfaW5mbwoKCWxvY2FsIHByb2ZpbGVfc3RvcmUgPSBtb2NrX2RhdGFfc3RvcmVbcHJvZmlsZV9zdG9yZV9uYW1lXQoKCWlmIHByb2ZpbGVfc3RvcmUgPT0gbmlsIHRoZW4KCQlwcm9maWxlX3N0b3JlID0ge30KCQltb2NrX2RhdGFfc3RvcmVbcHJvZmlsZV9zdG9yZV9uYW1lXSA9IHByb2ZpbGVfc3RvcmUKCWVuZAoKCWxvY2FsIGVwb2NoX3RpbWUgPSBtYXRoLmZsb29yKG9zLnRpbWUoKSAqIDEwMDApCglsb2NhbCBtb2NrX2VudHJ5ID0gcHJvZmlsZV9zdG9yZVtrZXldCglsb2NhbCBtb2NrX2VudHJ5X3dhc19uaWwgPSBmYWxzZQoKCWlmIG1vY2tfZW50cnkgPT0gbmlsIHRoZW4KCQltb2NrX2VudHJ5X3dhc19uaWwgPSB0cnVlCgkJaWYgaXNfZ2V0X2NhbGwgfj0gdHJ1ZSB0aGVuCgkJCW1vY2tfZW50cnkgPSB7CgkJCQlEYXRhID0gbmlsLAoJCQkJQ3JlYXRlZFRpbWUgPSBlcG9jaF90aW1lLAoJCQkJVXBkYXRlZFRpbWUgPSBlcG9jaF90aW1lLAoJCQkJVmVyc2lvbklkID0gMCwKCQkJCVVzZXJJZHMgPSB7fSwKCQkJCU1ldGFEYXRhID0ge30sCgkJCX0KCQkJcHJvZmlsZV9zdG9yZVtrZXldID0gbW9ja19lbnRyeQoJCWVuZAoJZW5kCgoJbG9jYWwgbW9ja19rZXlfaW5mbyA9IG1vY2tfZW50cnlfd2FzX25pbCA9PSBmYWxzZSBhbmQgTmV3TW9ja0RhdGFTdG9yZUtleUluZm8obW9ja19lbnRyeSkgb3IgbmlsCgoJbG9jYWwgdHJhbnNmb3JtLCB1c2VyX2lkcywgcm9ibG94X21ldGFfZGF0YSA9IHRyYW5zZm9ybV9mdW5jdGlvbihtb2NrX2VudHJ5IGFuZCBtb2NrX2VudHJ5LkRhdGEsIG1vY2tfa2V5X2luZm8pCgoJaWYgdHJhbnNmb3JtID09IG5pbCB0aGVuCgkJcmV0dXJuIG5pbAoJZWxzZQoJCWlmIG1vY2tfZW50cnkgfj0gbmlsIGFuZCBpc19nZXRfY2FsbCB+PSB0cnVlIHRoZW4KCQkJbW9ja19lbnRyeS5EYXRhID0gRGVlcENvcHlUYWJsZSh0cmFuc2Zvcm0pCgkJCW1vY2tfZW50cnkuVXNlcklkcyA9IERlZXBDb3B5VGFibGUodXNlcl9pZHMgb3Ige30pCgkJCW1vY2tfZW50cnkuTWV0YURhdGEgPSBEZWVwQ29weVRhYmxlKHJvYmxveF9tZXRhX2RhdGEgb3Ige30pCgkJCW1vY2tfZW50cnkuVmVyc2lvbklkICs9IDEKCQkJbW9ja19lbnRyeS5VcGRhdGVkVGltZSA9IGVwb2NoX3RpbWUKCQllbmQKCgkJcmV0dXJuIERlZXBDb3B5VGFibGUodHJhbnNmb3JtKSwgbW9ja19lbnRyeSB+PSBuaWwgYW5kIE5ld01vY2tEYXRhU3RvcmVLZXlJbmZvKG1vY2tfZW50cnkpIG9yIG5pbAoJZW5kCgplbmQKCmxvY2FsIGZ1bmN0aW9uIFVwZGF0ZUFzeW5jKHByb2ZpbGVfc3RvcmUsIHByb2ZpbGVfa2V5LCB0cmFuc2Zvcm1fcGFyYW1zLCBpc191c2VyX21vY2ssIGlzX2dldF9jYWxsLCB2ZXJzaW9uKSAtLT4gbG9hZGVkX2RhdGEsIGtleV9pbmZvCgktLXRyYW5zZm9ybV9wYXJhbXMgPSB7CgktLQlFeGlzdGluZ1Byb2ZpbGVIYW5kbGUgPSBmdW5jdGlvbihsYXRlc3RfZGF0YSksCgktLQlNaXNzaW5nUHJvZmlsZUhhbmRsZSA9IGZ1bmN0aW9uKGxhdGVzdF9kYXRhKSwKCS0tCUVkaXRQcm9maWxlID0gZnVuY3Rpb24obGFzdGVzdF9kYXRhKSwKCS0tfQoKCWxvY2FsIGxvYWRlZF9kYXRhLCBrZXlfaW5mbwoKCWxvY2FsIG5leHRfaW5fcXVldWUgPSBXYWl0SW5VcGRhdGVRdWV1ZShTZXNzaW9uVG9rZW4ocHJvZmlsZV9zdG9yZS5OYW1lLCBwcm9maWxlX2tleSwgaXNfdXNlcl9tb2NrKSkKCglsb2NhbCBzdWNjZXNzID0gdHJ1ZQoKCWxvY2FsIHN1Y2Nlc3MsIGVycm9yX21lc3NhZ2UgPSBwY2FsbChmdW5jdGlvbigpCgkJbG9jYWwgdHJhbnNmb3JtX2Z1bmN0aW9uID0gZnVuY3Rpb24obGF0ZXN0X2RhdGEpCgoJCQlsb2NhbCBtaXNzaW5nX3Byb2ZpbGUgPSBmYWxzZQoJCQlsb2NhbCBvdmVyd3JpdHRlbiA9IGZhbHNlCgkJCWxvY2FsIGdsb2JhbF91cGRhdGVzID0gezAsIHt9fQoKCQkJaWYgbGF0ZXN0X2RhdGEgPT0gbmlsIHRoZW4KCgkJCQltaXNzaW5nX3Byb2ZpbGUgPSB0cnVlCgoJCQllbHNlaWYgdHlwZShsYXRlc3RfZGF0YSkgfj0gInRhYmxlIiB0aGVuCgoJCQkJbWlzc2luZ19wcm9maWxlID0gdHJ1ZQoJCQkJb3ZlcndyaXR0ZW4gPSB0cnVlCgoJCQllbHNlCgoJCQkJaWYgdHlwZShsYXRlc3RfZGF0YS5EYXRhKSA9PSAidGFibGUiIGFuZCB0eXBlKGxhdGVzdF9kYXRhLk1ldGFEYXRhKSA9PSAidGFibGUiIGFuZCB0eXBlKGxhdGVzdF9kYXRhLkdsb2JhbFVwZGF0ZXMpID09ICJ0YWJsZSIgdGhlbgoKCQkJCQktLSBSZWd1bGFyIHByb2ZpbGUgc3RydWN0dXJlIGRldGVjdGVkOgoKCQkJCQlsYXRlc3RfZGF0YS5XYXNPdmVyd3JpdHRlbiA9IGZhbHNlIC0tIE11c3QgYmUgc2V0IHRvIGZhbHNlIGlmIHNldCBwcmV2aW91c2x5CgkJCQkJZ2xvYmFsX3VwZGF0ZXMgPSBsYXRlc3RfZGF0YS5HbG9iYWxVcGRhdGVzCgoJCQkJCWlmIHRyYW5zZm9ybV9wYXJhbXMuRXhpc3RpbmdQcm9maWxlSGFuZGxlIH49IG5pbCB0aGVuCgkJCQkJCXRyYW5zZm9ybV9wYXJhbXMuRXhpc3RpbmdQcm9maWxlSGFuZGxlKGxhdGVzdF9kYXRhKQoJCQkJCWVuZAoKCQkJCWVsc2VpZiBsYXRlc3RfZGF0YS5EYXRhID09IG5pbCBhbmQgbGF0ZXN0X2RhdGEuTWV0YURhdGEgPT0gbmlsIGFuZCB0eXBlKGxhdGVzdF9kYXRhLkdsb2JhbFVwZGF0ZXMpID09ICJ0YWJsZSIgdGhlbgoKCQkJCQktLSBSZWd1bGFyIHN0cnVjdHVyZSBub3QgZGV0ZWN0ZWQsIGJ1dCBHbG9iYWxVcGRhdGUgZGF0YSBleGlzdHM6CgoJCQkJCWxhdGVzdF9kYXRhLldhc092ZXJ3cml0dGVuID0gZmFsc2UgLS0gTXVzdCBiZSBzZXQgdG8gZmFsc2UgaWYgc2V0IHByZXZpb3VzbHkKCQkJCQlnbG9iYWxfdXBkYXRlcyA9IGxhdGVzdF9kYXRhLkdsb2JhbFVwZGF0ZXMgb3IgZ2xvYmFsX3VwZGF0ZXMKCQkJCQltaXNzaW5nX3Byb2ZpbGUgPSB0cnVlCgoJCQkJZWxzZQoKCQkJCQltaXNzaW5nX3Byb2ZpbGUgPSB0cnVlCgkJCQkJb3ZlcndyaXR0ZW4gPSB0cnVlCgoJCQkJZW5kCgoJCQllbmQKCgkJCS0tIFByb2ZpbGUgd2FzIG5vdCBjcmVhdGVkIG9yIGNvcnJ1cHRlZCBhbmQgbm8gR2xvYmFsVXBkYXRlIGRhdGEgZXhpc3RzOgoJCQlpZiBtaXNzaW5nX3Byb2ZpbGUgPT0gdHJ1ZSB0aGVuCgkJCQlsYXRlc3RfZGF0YSA9IHsKCQkJCQktLSBEYXRhID0gbmlsLAoJCQkJCS0tIE1ldGFEYXRhID0gbmlsLAoJCQkJCUdsb2JhbFVwZGF0ZXMgPSBnbG9iYWxfdXBkYXRlcywKCQkJCX0KCQkJCWlmIHRyYW5zZm9ybV9wYXJhbXMuTWlzc2luZ1Byb2ZpbGVIYW5kbGUgfj0gbmlsIHRoZW4KCQkJCQl0cmFuc2Zvcm1fcGFyYW1zLk1pc3NpbmdQcm9maWxlSGFuZGxlKGxhdGVzdF9kYXRhKQoJCQkJZW5kCgkJCWVuZAoKCQkJLS0gRWRpdGluZyBwcm9maWxlOgoJCQlpZiB0cmFuc2Zvcm1fcGFyYW1zLkVkaXRQcm9maWxlIH49IG5pbCB0aGVuCgkJCQl0cmFuc2Zvcm1fcGFyYW1zLkVkaXRQcm9maWxlKGxhdGVzdF9kYXRhKQoJCQllbmQKCgkJCS0tIEludmFsaWQgZGF0YSBoYW5kbGluZyAoU2lsZW50bHkgb3ZlcnJpZGUgd2l0aCBlbXB0eSBwcm9maWxlKQoJCQlpZiBvdmVyd3JpdHRlbiA9PSB0cnVlIHRoZW4KCQkJCWxhdGVzdF9kYXRhLldhc092ZXJ3cml0dGVuID0gdHJ1ZSAtLSBUZW1wb3JhcnkgdGFnIHRoYXQgd2lsbCBiZSByZW1vdmVkIG9uIGZpcnN0IHNhdmUKCQkJZW5kCgoJCQlyZXR1cm4gbGF0ZXN0X2RhdGEsIGxhdGVzdF9kYXRhLlVzZXJJZHMsIGxhdGVzdF9kYXRhLlJvYmxveE1ldGFEYXRhCgkJZW5kCgoJCWlmIGlzX3VzZXJfbW9jayA9PSB0cnVlIHRoZW4gLS0gVXNlZCB3aGVuIHRoZSBwcm9maWxlIGlzIGFjY2Vzc2VkIHRocm91Z2ggUHJvZmlsZVN0b3JlLk1vY2sKCgkJCWxvYWRlZF9kYXRhLCBrZXlfaW5mbyA9IE1vY2tVcGRhdGVBc3luYyhVc2VyTW9ja1N0b3JlLCBwcm9maWxlX3N0b3JlLk5hbWUsIHByb2ZpbGVfa2V5LCB0cmFuc2Zvcm1fZnVuY3Rpb24sIGlzX2dldF9jYWxsKQoJCQl0YXNrLndhaXQoKSAtLSBTaW11bGF0ZSBBUEkgY2FsbCB5aWVsZAoKCQllbHNlaWYgRGF0YVN0b3JlU3RhdGUgfj0gIkFjY2VzcyIgdGhlbiAtLSBVc2VkIHdoZW4gQVBJIGFjY2VzcyBpcyBkaXNhYmxlZAoKCQkJbG9hZGVkX2RhdGEsIGtleV9pbmZvID0gTW9ja1VwZGF0ZUFzeW5jKE1vY2tTdG9yZSwgcHJvZmlsZV9zdG9yZS5OYW1lLCBwcm9maWxlX2tleSwgdHJhbnNmb3JtX2Z1bmN0aW9uLCBpc19nZXRfY2FsbCkKCQkJdGFzay53YWl0KCkgLS0gU2ltdWxhdGUgQVBJIGNhbGwgeWllbGQKCgkJZWxzZQoKCQkJaWYgaXNfZ2V0X2NhbGwgPT0gdHJ1ZSB0aGVuCgoJCQkJaWYgdmVyc2lvbiB+PSBuaWwgdGhlbgoKCQkJCQlsb2NhbCBzdWNjZXNzLCBlcnJvcl9tZXNzYWdlID0gcGNhbGwoZnVuY3Rpb24oKQoJCQkJCQlsb2FkZWRfZGF0YSwga2V5X2luZm8gPSBwcm9maWxlX3N0b3JlLmRhdGFfc3RvcmU6R2V0VmVyc2lvbkFzeW5jKHByb2ZpbGVfa2V5LCB2ZXJzaW9uKQoJCQkJCWVuZCkKCgkJCQkJaWYgc3VjY2VzcyA9PSBmYWxzZSBhbmQgdHlwZShlcnJvcl9tZXNzYWdlKSA9PSAic3RyaW5nIiBhbmQgc3RyaW5nLmZpbmQoZXJyb3JfbWVzc2FnZSwgIm5vdCB2YWxpZCIpIH49IG5pbCB0aGVuCgkJCQkJCXdhcm4oYFt7c2NyaXB0Lk5hbWV9XTogUGFzc2VkIHZlcnNpb24gYXJndW1lbnQgaXMgbm90IHZhbGlkOyBUcmFjZWJhY2s6XG5gIC4uIGRlYnVnLnRyYWNlYmFjaygpKQoJCQkJCWVuZAoKCQkJCWVsc2UKCgkJCQkJbG9hZGVkX2RhdGEsIGtleV9pbmZvID0gcHJvZmlsZV9zdG9yZS5kYXRhX3N0b3JlOkdldEFzeW5jKHByb2ZpbGVfa2V5KQoKCQkJCWVuZAoKCQkJCWxvYWRlZF9kYXRhID0gdHJhbnNmb3JtX2Z1bmN0aW9uKGxvYWRlZF9kYXRhKQoKCQkJZWxzZQoKCQkJCWxvYWRlZF9kYXRhLCBrZXlfaW5mbyA9IHByb2ZpbGVfc3RvcmUuZGF0YV9zdG9yZTpVcGRhdGVBc3luYyhwcm9maWxlX2tleSwgdHJhbnNmb3JtX2Z1bmN0aW9uKQoKCQkJZW5kCgoJCWVuZAoKCWVuZCkKCgluZXh0X2luX3F1ZXVlKCkKCglpZiBzdWNjZXNzID09IHRydWUgYW5kIHR5cGUobG9hZGVkX2RhdGEpID09ICJ0YWJsZSIgdGhlbgoJCS0tIEludmFsaWQgZGF0YSBoYW5kbGluZzoKCQlpZiBsb2FkZWRfZGF0YS5XYXNPdmVyd3JpdHRlbiA9PSB0cnVlIGFuZCBpc19nZXRfY2FsbCB+PSB0cnVlIHRoZW4KCQkJUmVnaXN0ZXJPdmVyd3JpdGUoCgkJCQlwcm9maWxlX3N0b3JlLk5hbWUsCgkJCQlwcm9maWxlX2tleQoJCQkpCgkJZW5kCgkJLS0gUmV0dXJuIGxvYWRlZF9kYXRhOgoJCXJldHVybiBsb2FkZWRfZGF0YSwga2V5X2luZm8KCWVsc2UKCQktLSBFcnJvciBoYW5kbGluZzoKCQlSZWdpc3RlckVycm9yKAoJCQllcnJvcl9tZXNzYWdlIG9yICJVbmRlZmluZWQgZXJyb3IiLAoJCQlwcm9maWxlX3N0b3JlLk5hbWUsCgkJCXByb2ZpbGVfa2V5CgkJKQoJCS0tIFJldHVybiBub3RoaW5nOgoJCXJldHVybiBuaWwKCWVuZAoKZW5kCgpsb2NhbCBmdW5jdGlvbiBJc1RoaXNTZXNzaW9uKHNlc3Npb25fdGFnKQoJcmV0dXJuIHNlc3Npb25fdGFnWzFdID09IFBsYWNlSWQgYW5kIHNlc3Npb25fdGFnWzJdID09IEpvYklkCmVuZAoKbG9jYWwgZnVuY3Rpb24gUmVhZE1vY2tGbGFnKCk6IGJvb2xlYW4KCWxvY2FsIGlzX21vY2sgPSBNb2NrRmxhZwoJTW9ja0ZsYWcgPSBmYWxzZQoJcmV0dXJuIGlzX21vY2sKZW5kCgpsb2NhbCBmdW5jdGlvbiBXYWl0Rm9yU3RvcmVSZWFkeShwcm9maWxlX3N0b3JlKQoJd2hpbGUgcHJvZmlsZV9zdG9yZS5pc19yZWFkeSA9PSBmYWxzZSBkbwoJCXRhc2sud2FpdCgpCgllbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBBZGRQcm9maWxlVG9BdXRvU2F2ZShwcm9maWxlKQoKCUFjdGl2ZVNlc3Npb25DaGVja1twcm9maWxlLnNlc3Npb25fdG9rZW5dID0gcHJvZmlsZQoKCS0tIEFkZCBhdCBBdXRvU2F2ZUluZGV4IGFuZCBtb3ZlIEF1dG9TYXZlSW5kZXggcmlnaHQ6CgoJdGFibGUuaW5zZXJ0KEF1dG9TYXZlTGlzdCwgQXV0b1NhdmVJbmRleCwgcHJvZmlsZSkKCglpZiAjQXV0b1NhdmVMaXN0ID4gMSB0aGVuCgkJQXV0b1NhdmVJbmRleCA9IEF1dG9TYXZlSW5kZXggKyAxCgllbHNlaWYgI0F1dG9TYXZlTGlzdCA9PSAxIHRoZW4KCQktLSBGaXJzdCBwcm9maWxlIGNyZWF0ZWQgLSBtYWtlIHN1cmUgaXQgZG9lc24ndCBnZXQgaW1tZWRpYXRlbHkgYXV0byBzYXZlZDoKCQlMYXN0QXV0b1NhdmUgPSBvcy5jbG9jaygpCgllbmQKCmVuZAoKbG9jYWwgZnVuY3Rpb24gUmVtb3ZlUHJvZmlsZUZyb21BdXRvU2F2ZShwcm9maWxlKQoKCUFjdGl2ZVNlc3Npb25DaGVja1twcm9maWxlLnNlc3Npb25fdG9rZW5dID0gbmlsCgoJbG9jYWwgYXV0b19zYXZlX2luZGV4ID0gdGFibGUuZmluZChBdXRvU2F2ZUxpc3QsIHByb2ZpbGUpCgoJaWYgYXV0b19zYXZlX2luZGV4IH49IG5pbCB0aGVuCgkJdGFibGUucmVtb3ZlKEF1dG9TYXZlTGlzdCwgYXV0b19zYXZlX2luZGV4KQoJCWlmIGF1dG9fc2F2ZV9pbmRleCA8IEF1dG9TYXZlSW5kZXggdGhlbgoJCQlBdXRvU2F2ZUluZGV4ID0gQXV0b1NhdmVJbmRleCAtIDEgLS0gVGFibGUgY29udGVudHMgd2VyZSBtb3ZlZCBsZWZ0IGJlZm9yZSBBdXRvU2F2ZUluZGV4IHNvIG1vdmUgQXV0b1NhdmVJbmRleCBsZWZ0IGFzIHdlbGwKCQllbmQKCQlpZiBBdXRvU2F2ZUxpc3RbQXV0b1NhdmVJbmRleF0gPT0gbmlsIHRoZW4gLS0gQXV0b1NhdmVJbmRleCB3YXMgYXQgdGhlIGVuZCBvZiB0aGUgQXV0b1NhdmVMaXN0IC0gcmVzZXQgdG8gMQoJCQlBdXRvU2F2ZUluZGV4ID0gMQoJCWVuZAoJZW5kCgplbmQKCmxvY2FsIGZ1bmN0aW9uIFNhdmVQcm9maWxlQXN5bmMocHJvZmlsZSwgaXNfZW5kaW5nX3Nlc3Npb24sIGlzX292ZXJ3cml0aW5nLCBsYXN0X3NhdmVfcmVhc29uKQoKCWlmIHR5cGUocHJvZmlsZS5EYXRhKSB+PSAidGFibGUiIHRoZW4KCQllcnJvcihgW3tzY3JpcHQuTmFtZX1dOiBEZXZlbG9wZXIgY29kZSBsaWtlbHkgc2V0ICJQcm9maWxlLkRhdGEiIHRvIGEgbm9uLXRhYmxlIHZhbHVlISAoU1RPUkU6e3Byb2ZpbGUuUHJvZmlsZVN0b3JlLk5hbWV9OyBLRVk6e3Byb2ZpbGUuS2V5fSlgKQoJZW5kCgoJcHJvZmlsZS5PblNhdmU6RmlyZSgpCglpZiBpc19lbmRpbmdfc2Vzc2lvbiA9PSB0cnVlIHRoZW4KCQlwcm9maWxlLk9uTGFzdFNhdmU6RmlyZShsYXN0X3NhdmVfcmVhc29uIG9yICJNYW51YWwiKQoJZW5kCgoJaWYgaXNfZW5kaW5nX3Nlc3Npb24gPT0gdHJ1ZSBhbmQgaXNfb3ZlcndyaXRpbmcgfj0gdHJ1ZSB0aGVuCgkJaWYgcHJvZmlsZS5yb2Jsb3hfbWVzc2FnZV9zdWJzY3JpcHRpb24gfj0gbmlsIHRoZW4KCQkJcHJvZmlsZS5yb2Jsb3hfbWVzc2FnZV9zdWJzY3JpcHRpb246RGlzY29ubmVjdCgpCgkJZW5kCgkJUmVtb3ZlUHJvZmlsZUZyb21BdXRvU2F2ZShwcm9maWxlKQoJCXByb2ZpbGUuT25TZXNzaW9uRW5kOkZpcmUoKQoJZW5kCgoJQWN0aXZlUHJvZmlsZVNhdmVKb2JzID0gQWN0aXZlUHJvZmlsZVNhdmVKb2JzICsgMQoKCS0tIENvbXBhcmUgIlNlc3Npb25Mb2FkQ291bnQiIHdoZW4gd3JpdGluZyB0byBwcm9maWxlIHRvIHByZXZlbnQgYSByYXJlIGNhc2Ugb2YgcmVwZWF0IGxhc3Qgc2F2ZSB3aGVuIHRoZSBwcm9maWxlIGlzIGxvYWRlZCBvbiB0aGUgc2FtZSBzZXJ2ZXIgYWdhaW4KCglsb2NhbCByZXBlYXRfc2F2ZV9mbGFnID0gdHJ1ZSAtLSBSZWxlYXNlZCBQcm9maWxlIHNhdmUgY2FsbHMgaGF2ZSB0byByZXBlYXQgdW50aWwgdGhleSBzdWNjZWVkCglsb2NhbCBleHBfYmFja29mZiA9IDEKCgl3aGlsZSByZXBlYXRfc2F2ZV9mbGFnID09IHRydWUgZG8KCgkJaWYgaXNfZW5kaW5nX3Nlc3Npb24gfj0gdHJ1ZSB0aGVuCgkJCXJlcGVhdF9zYXZlX2ZsYWcgPSBmYWxzZQoJCWVuZAoKCQlsb2NhbCBsb2FkZWRfZGF0YSwga2V5X2luZm8gPSBVcGRhdGVBc3luYygKCQkJcHJvZmlsZS5Qcm9maWxlU3RvcmUsCgkJCXByb2ZpbGUuS2V5LAoJCQl7CgkJCQlFeGlzdGluZ1Byb2ZpbGVIYW5kbGUgPSBuaWwsCgkJCQlNaXNzaW5nUHJvZmlsZUhhbmRsZSA9IG5pbCwKCQkJCUVkaXRQcm9maWxlID0gZnVuY3Rpb24obGF0ZXN0X2RhdGEpCgoJCQkJCS0tIENoZWNrIGlmIHRoaXMgc2Vzc2lvbiBzdGlsbCBvd25zIHRoZSBwcm9maWxlOgoKCQkJCQlsb2NhbCBzZXNzaW9uX293bnNfcHJvZmlsZSA9IGZhbHNlCgoJCQkJCWlmIGlzX292ZXJ3cml0aW5nIH49IHRydWUgdGhlbgoKCQkJCQkJbG9jYWwgYWN0aXZlX3Nlc3Npb24gPSBsYXRlc3RfZGF0YS5NZXRhRGF0YS5BY3RpdmVTZXNzaW9uCgkJCQkJCWxvY2FsIHNlc3Npb25fbG9hZF9jb3VudCA9IGxhdGVzdF9kYXRhLk1ldGFEYXRhLlNlc3Npb25Mb2FkQ291bnQKCgkJCQkJCWlmIHR5cGUoYWN0aXZlX3Nlc3Npb24pID09ICJ0YWJsZSIgdGhlbgoJCQkJCQkJc2Vzc2lvbl9vd25zX3Byb2ZpbGUgPSBJc1RoaXNTZXNzaW9uKGFjdGl2ZV9zZXNzaW9uKSBhbmQgc2Vzc2lvbl9sb2FkX2NvdW50ID09IHByb2ZpbGUubG9hZF9pbmRleAoJCQkJCQllbmQKCgkJCQkJZWxzZQoJCQkJCQlzZXNzaW9uX293bnNfcHJvZmlsZSA9IHRydWUKCQkJCQllbmQKCgkJCQkJLS0gV2UgbWF5IG9ubHkgZWRpdCB0aGUgcHJvZmlsZSBpZiB0aGlzIHNlcnZlciBoYXMgb3duZXJzaGlwIG9mIHRoZSBwcm9maWxlOgoKCQkJCQlpZiBzZXNzaW9uX293bnNfcHJvZmlsZSA9PSB0cnVlIHRoZW4KCgkJCQkJCS0tIENsZWFyIHByb2Nlc3NlZCB1cGRhdGVzIChtZXNzYWdlcyk6CgoJCQkJCQlsb2NhbCBsb2NrZWRfdXBkYXRlcyA9IHByb2ZpbGUubG9ja2VkX2dsb2JhbF91cGRhdGVzIC0tIFtpbmRleF0gPSB0cnVlLCAuLi4KCQkJCQkJbG9jYWwgYWN0aXZlX3VwZGF0ZXMgPSBsYXRlc3RfZGF0YS5HbG9iYWxVcGRhdGVzWzJdCgkJCQkJCS0tIFByb2ZpbGVTZXJ2aWNlIG1vZHVsZSBmb3JtYXQ6IHt7dXBkYXRlX2lkLCB2ZXJzaW9uX2lkLCB1cGRhdGVfbG9ja2VkLCB1cGRhdGVfZGF0YX0sIC4uLn0KCQkJCQkJLS0gUHJvZmlsZVN0b3JlIG1vZHVsZSBmb3JtYXQ6IHt7dXBkYXRlX2lkLCB1cGRhdGVfZGF0YX0sIC4uLn0KCgkJCQkJCWlmIG5leHQobG9ja2VkX3VwZGF0ZXMpIH49IG5pbCB0aGVuCgkJCQkJCQlsb2NhbCBpID0gMQoJCQkJCQkJd2hpbGUgaSA8PSAjYWN0aXZlX3VwZGF0ZXMgZG8KCQkJCQkJCQlsb2NhbCB1cGRhdGUgPSBhY3RpdmVfdXBkYXRlc1tpXQoJCQkJCQkJCWlmIGxvY2tlZF91cGRhdGVzW3VwZGF0ZVsxXV0gPT0gdHJ1ZSB0aGVuCgkJCQkJCQkJCXRhYmxlLnJlbW92ZShhY3RpdmVfdXBkYXRlcywgaSkKCQkJCQkJCQllbHNlCgkJCQkJCQkJCWkgKz0gMQoJCQkJCQkJCWVuZAoJCQkJCQkJZW5kCgkJCQkJCWVuZAoKCQkJCQkJLS0gU2F2ZSBwcm9maWxlIGRhdGE6CgoJCQkJCQlsYXRlc3RfZGF0YS5EYXRhID0gcHJvZmlsZS5EYXRhCgkJCQkJCWxhdGVzdF9kYXRhLlJvYmxveE1ldGFEYXRhID0gcHJvZmlsZS5Sb2Jsb3hNZXRhRGF0YQoJCQkJCQlsYXRlc3RfZGF0YS5Vc2VySWRzID0gcHJvZmlsZS5Vc2VySWRzCgoJCQkJCQlpZiBpc19vdmVyd3JpdGluZyB+PSB0cnVlIHRoZW4KCgkJCQkJCQlsYXRlc3RfZGF0YS5NZXRhRGF0YS5MYXN0VXBkYXRlID0gb3MudGltZSgpCgoJCQkJCQkJaWYgaXNfZW5kaW5nX3Nlc3Npb24gPT0gdHJ1ZSB0aGVuCgkJCQkJCQkJbGF0ZXN0X2RhdGEuTWV0YURhdGEuQWN0aXZlU2Vzc2lvbiA9IG5pbAoJCQkJCQkJZW5kCgoJCQkJCQllbHNlCgoJCQkJCQkJbGF0ZXN0X2RhdGEuTWV0YURhdGEuQWN0aXZlU2Vzc2lvbiA9IG5pbAoJCQkJCQkJbGF0ZXN0X2RhdGEuTWV0YURhdGEuRm9yY2VMb2FkU2Vzc2lvbiA9IG5pbAoKCQkJCQkJZW5kCgoJCQkJCWVuZAoKCQkJCWVuZCwKCQkJfSwKCQkJcHJvZmlsZS5pc19tb2NrCgkJKQoKCQlpZiBsb2FkZWRfZGF0YSB+PSBuaWwgYW5kIGtleV9pbmZvIH49IG5pbCB0aGVuCgoJCQlpZiBpc19vdmVyd3JpdGluZyA9PSB0cnVlIHRoZW4KCQkJCWJyZWFrCgkJCWVuZAoKCQkJcmVwZWF0X3NhdmVfZmxhZyA9IGZhbHNlCgoJCQlsb2NhbCBhY3RpdmVfc2Vzc2lvbiA9IGxvYWRlZF9kYXRhLk1ldGFEYXRhLkFjdGl2ZVNlc3Npb24KCQkJbG9jYWwgc2Vzc2lvbl9sb2FkX2NvdW50ID0gbG9hZGVkX2RhdGEuTWV0YURhdGEuU2Vzc2lvbkxvYWRDb3VudAoJCQlsb2NhbCBzZXNzaW9uX293bnNfcHJvZmlsZSA9IGZhbHNlCgoJCQlpZiB0eXBlKGFjdGl2ZV9zZXNzaW9uKSA9PSAidGFibGUiIHRoZW4KCQkJCXNlc3Npb25fb3duc19wcm9maWxlID0gSXNUaGlzU2Vzc2lvbihhY3RpdmVfc2Vzc2lvbikgYW5kIHNlc3Npb25fbG9hZF9jb3VudCA9PSBwcm9maWxlLmxvYWRfaW5kZXgKCQkJZW5kCgoJCQlsb2NhbCBmb3JjZV9sb2FkX3Nlc3Npb24gPSBsb2FkZWRfZGF0YS5NZXRhRGF0YS5Gb3JjZUxvYWRTZXNzaW9uCgkJCWxvY2FsIGZvcmNlX2xvYWRfcGVuZGluZyA9IGZhbHNlCgkJCWlmIHR5cGUoZm9yY2VfbG9hZF9zZXNzaW9uKSA9PSAidGFibGUiIHRoZW4KCQkJCWZvcmNlX2xvYWRfcGVuZGluZyA9IG5vdCBJc1RoaXNTZXNzaW9uKGZvcmNlX2xvYWRfc2Vzc2lvbikKCQkJZW5kCgoJCQlsb2NhbCBpc19hY3RpdmUgPSBwcm9maWxlOklzQWN0aXZlKCkKCgkJCS0tIElmIGFub3RoZXIgc2VydmVyIGlzIHRyeWluZyB0byBzdGFydCBhIHNlc3Npb24gZm9yIHRoaXMgcHJvZmlsZSAtIGVuZCB0aGUgc2Vzc2lvbjoKCgkJCWlmIGZvcmNlX2xvYWRfcGVuZGluZyA9PSB0cnVlIGFuZCBzZXNzaW9uX293bnNfcHJvZmlsZSA9PSB0cnVlIHRoZW4KCQkJCWlmIGlzX2FjdGl2ZSA9PSB0cnVlIHRoZW4KCQkJCQlTYXZlUHJvZmlsZUFzeW5jKHByb2ZpbGUsIHRydWUsIGZhbHNlLCAiRXh0ZXJuYWwiKQoJCQkJZW5kCgkJCQlicmVhawoJCQllbmQKCgkJCS0tIENsZWFyaW5nIHByb2Nlc3NlZCB1cGRhdGUgbGlzdCAvIERldGVjdGluZyBuZXcgdXBkYXRlczoKCgkJCWxvY2FsIGxvY2tlZF91cGRhdGVzID0gcHJvZmlsZS5sb2NrZWRfZ2xvYmFsX3VwZGF0ZXMgLS0gW2luZGV4XSA9IHRydWUsIC4uLgoJCQlsb2NhbCByZWNlaXZlZF91cGRhdGVzID0gcHJvZmlsZS5yZWNlaXZlZF9nbG9iYWxfdXBkYXRlcyAtLSBbaW5kZXhdID0gdHJ1ZSwgLi4uCgkJCWxvY2FsIGFjdGl2ZV91cGRhdGVzID0gbG9hZGVkX2RhdGEuR2xvYmFsVXBkYXRlc1syXQoKCQkJbG9jYWwgbmV3X3VwZGF0ZXMgPSB7fSAtLSB7fSwgLi4uCgkJCWxvY2FsIHN0aWxsX3BlbmRpbmcgPSB7fSAtLSBbaW5kZXhdID0gdHJ1ZSwgLi4uCgoJCQlmb3IgXywgdXBkYXRlIGluIGlwYWlycyhhY3RpdmVfdXBkYXRlcykgZG8KCQkJCWlmIGxvY2tlZF91cGRhdGVzW3VwZGF0ZVsxXV0gPT0gdHJ1ZSB0aGVuCgkJCQkJc3RpbGxfcGVuZGluZ1t1cGRhdGVbMV1dID0gdHJ1ZQoJCQkJZWxzZWlmIHJlY2VpdmVkX3VwZGF0ZXNbdXBkYXRlWzFdXSB+PSB0cnVlIHRoZW4KCQkJCQlyZWNlaXZlZF91cGRhdGVzW3VwZGF0ZVsxXV0gPSB0cnVlCgkJCQkJdGFibGUuaW5zZXJ0KG5ld191cGRhdGVzLCB1cGRhdGUpCgkJCQllbmQKCQkJZW5kCgoJCQlmb3IgaW5kZXggaW4gcGFpcnMobG9ja2VkX3VwZGF0ZXMpIGRvCgkJCQlpZiBzdGlsbF9wZW5kaW5nW2luZGV4XSB+PSB0cnVlIHRoZW4KCQkJCQlsb2NrZWRfdXBkYXRlc1tpbmRleF0gPSBuaWwKCQkJCWVuZAoJCQllbmQKCgkJCS0tIFVwZGF0aW5nIHByb2ZpbGUgdmFsdWVzOgoKCQkJcHJvZmlsZS5LZXlJbmZvID0ga2V5X2luZm8KCQkJcHJvZmlsZS5MYXN0U2F2ZWREYXRhID0gbG9hZGVkX2RhdGEuRGF0YQoJCQlwcm9maWxlLmdsb2JhbF91cGRhdGVzID0gbG9hZGVkX2RhdGEuR2xvYmFsVXBkYXRlcyBhbmQgbG9hZGVkX2RhdGEuR2xvYmFsVXBkYXRlc1syXSBvciB7fQoKCQkJaWYgc2Vzc2lvbl9vd25zX3Byb2ZpbGUgPT0gdHJ1ZSB0aGVuCgkJCQlpZiBpc19hY3RpdmUgPT0gdHJ1ZSBhbmQgaXNfZW5kaW5nX3Nlc3Npb24gfj0gdHJ1ZSB0aGVuCgoJCQkJCS0tIFByb2Nlc3NpbmcgbmV3IGdsb2JhbCB1cGRhdGVzIChtZXNzYWdlcyk6CgoJCQkJCWZvciBfLCB1cGRhdGUgaW4gaXBhaXJzKG5ld191cGRhdGVzKSBkbwoKCQkJCQkJbG9jYWwgaW5kZXggPSB1cGRhdGVbMV0KCQkJCQkJbG9jYWwgdXBkYXRlX2RhdGEgPSB1cGRhdGVbI3VwZGF0ZV0gLS0gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCBQcm9maWxlU2VydmljZQoKCQkJCQkJZm9yIF8sIGhhbmRsZXIgaW4gaXBhaXJzKHByb2ZpbGUubWVzc2FnZV9oYW5kbGVycykgZG8KCgkJCQkJCQlsb2NhbCBpc19wcm9jZXNzZWQgPSBmYWxzZQoJCQkJCQkJbG9jYWwgcHJvY2Vzc2VkX2NhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCQkJCWlzX3Byb2Nlc3NlZCA9IHRydWUKCQkJCQkJCQlsb2NrZWRfdXBkYXRlc1tpbmRleF0gPSB0cnVlCgkJCQkJCQllbmQKCgkJCQkJCQlsb2NhbCBzZW5kX3VwZGF0ZV9kYXRhID0gRGVlcENvcHlUYWJsZSh1cGRhdGVfZGF0YSkKCgkJCQkJCQl0YXNrLnNwYXduKGhhbmRsZXIsIHNlbmRfdXBkYXRlX2RhdGEsIHByb2Nlc3NlZF9jYWxsYmFjaykKCgkJCQkJCQlpZiBpc19wcm9jZXNzZWQgPT0gdHJ1ZSB0aGVuCgkJCQkJCQkJYnJlYWsKCQkJCQkJCWVuZAoKCQkJCQkJZW5kCgoJCQkJCWVuZAoKCQkJCWVuZAoJCQllbHNlCgoJCQkJaWYgcHJvZmlsZS5yb2Jsb3hfbWVzc2FnZV9zdWJzY3JpcHRpb24gfj0gbmlsIHRoZW4KCQkJCQlwcm9maWxlLnJvYmxveF9tZXNzYWdlX3N1YnNjcmlwdGlvbjpEaXNjb25uZWN0KCkKCQkJCWVuZAoKCQkJCWlmIGlzX2FjdGl2ZSA9PSB0cnVlIHRoZW4KCQkJCQlSZW1vdmVQcm9maWxlRnJvbUF1dG9TYXZlKHByb2ZpbGUpCgkJCQkJcHJvZmlsZS5PblNlc3Npb25FbmQ6RmlyZSgpCgkJCQllbmQKCgkJCWVuZAoKCQkJcHJvZmlsZS5PbkFmdGVyU2F2ZTpGaXJlKHByb2ZpbGUuTGFzdFNhdmVkRGF0YSkKCgkJZWxzZWlmIHJlcGVhdF9zYXZlX2ZsYWcgPT0gdHJ1ZSB0aGVuCgoJCQktLSBEYXRhU3RvcmUgY2FsbCBsaWtlbHkgcmVzdWx0ZWQgaW4gYW4gZXJyb3I7IFJlcGVhdCB0aGUgRGF0YVN0b3JlIGNhbGwgc2hvcnRseQoJCQl0YXNrLndhaXQoZXhwX2JhY2tvZmYpCgkJCWV4cF9iYWNrb2ZmID0gbWF0aC5taW4oaWYgbGFzdF9zYXZlX3JlYXNvbiA9PSAiU2h1dGRvd24iIHRoZW4gOCBlbHNlIDIwLCBleHBfYmFja29mZiAqIDIpCgoJCWVuZAoKCWVuZAoKCUFjdGl2ZVByb2ZpbGVTYXZlSm9icyA9IEFjdGl2ZVByb2ZpbGVTYXZlSm9icyAtIDEKCmVuZAoKLS0tLS0gUHVibGljIC0tLS0tCgotLVtbCglTYXZlZCBwcm9maWxlIHN0cnVjdHVyZToKCQoJewoJCURhdGEgPSB7fSwKCQkKCQlNZXRhRGF0YSA9IHsKCQkJUHJvZmlsZUNyZWF0ZVRpbWUgPSAwLAoJCQlTZXNzaW9uTG9hZENvdW50ID0gMCwKCQkJQWN0aXZlU2Vzc2lvbiA9IHtwbGFjZV9pZCwgZ2FtZV9qb2JfaWQsIHVuaXF1ZV9zZXNzaW9uX2lkfSAvIG5pbCwKCQkJRm9yY2VMb2FkU2Vzc2lvbiA9IHtwbGFjZV9pZCwgZ2FtZV9qb2JfaWR9IC8gbmlsLAoJCQlMYXN0VXBkYXRlID0gMCwgLS0gb3MudGltZSgpCgkJCU1ldGFUYWdzID0ge30sIC0tIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHdpdGggUHJvZmlsZVNlcnZpY2UKCQl9LAoJCQoJCVJvYmxveE1ldGFEYXRhID0ge30sCgkJVXNlcklkcyA9IHt9LAoJCQoJCUdsb2JhbFVwZGF0ZXMgPSB7CgkJCXVwZGF0ZV9pbmRleCwKCQkJewoJCQkJe3VwZGF0ZV9pbmRleCwgZGF0YX0sIC4uLgoJCQl9LAoJCX0sCgl9CgotLV1dCgpleHBvcnQgdHlwZSBQcm9maWxlPFQ+ID0gewoJRGF0YTogVCAmIHtbYW55XTogYW55fSwKCUxhc3RTYXZlZERhdGE6IFQgJiB7W2FueV06IGFueX0sCglGaXJzdFNlc3Npb25UaW1lOiBudW1iZXIsCglTZXNzaW9uTG9hZENvdW50OiBudW1iZXIsCglTZXNzaW9uOiB7UGxhY2VJZDogbnVtYmVyLCBKb2JJZDogc3RyaW5nfT8sCglSb2Jsb3hNZXRhRGF0YToge1thbnldOiBhbnl9LAoJVXNlcklkczoge1thbnldOiBhbnl9LAoJS2V5SW5mbzogRGF0YVN0b3JlS2V5SW5mbywKCU9uU2F2ZToge0Nvbm5lY3Q6IChzZWxmOiBhbnksIGxpc3RlbmVyOiAoKSAtPiAoKSkgLT4gKHtEaXNjb25uZWN0OiAoc2VsZjogYW55KSAtPiAoKX0pfSwKCU9uTGFzdFNhdmU6IHtDb25uZWN0OiAoc2VsZjogYW55LCBsaXN0ZW5lcjogKHJlYXNvbjogIk1hbnVhbCIgfCAiRXh0ZXJuYWwiIHwgIlNodXRkb3duIikgLT4gKCkpIC0+ICh7RGlzY29ubmVjdDogKHNlbGY6IGFueSkgLT4gKCl9KX0sCglPblNlc3Npb25FbmQ6IHtDb25uZWN0OiAoc2VsZjogYW55LCBsaXN0ZW5lcjogKCkgLT4gKCkpIC0+ICh7RGlzY29ubmVjdDogKHNlbGY6IGFueSkgLT4gKCl9KX0sCglPbkFmdGVyU2F2ZToge0Nvbm5lY3Q6IChzZWxmOiBhbnksIGxpc3RlbmVyOiAobGFzdF9zYXZlZF9kYXRhOiBUICYge1thbnldOiBhbnl9KSAtPiAoKSkgLT4gKHtEaXNjb25uZWN0OiAoc2VsZjogYW55KSAtPiAoKX0pfSwKCVByb2ZpbGVTdG9yZToge1thbnldOiBhbnl9LAoJS2V5OiBzdHJpbmcsCgoJSXNBY3RpdmU6IChzZWxmOiBhbnkpIC0+IChib29sZWFuKSwKCVJlY29uY2lsZTogKHNlbGY6IGFueSkgLT4gKCksCglFbmRTZXNzaW9uOiAoc2VsZjogYW55KSAtPiAoKSwKCUFkZFVzZXJJZDogKHNlbGY6IGFueSwgdXNlcl9pZDogbnVtYmVyKSAtPiAoKSwKCVJlbW92ZVVzZXJJZDogKHNlbGY6IGFueSwgdXNlcl9pZDogbnVtYmVyKSAtPiAoKSwKCU1lc3NhZ2VIYW5kbGVyOiAoc2VsZjogYW55LCBmbjogKG1lc3NhZ2U6IHtbYW55XTogYW55fSwgcHJvY2Vzc2VkOiAoKSAtPiAoKSkgLT4gKCkpIC0+ICgpLAoJU2F2ZTogKHNlbGY6IGFueSkgLT4gKCksCglTZXRBc3luYzogKHNlbGY6IGFueSkgLT4gKCksCn0KCmV4cG9ydCB0eXBlIFZlcnNpb25RdWVyeTxUPiA9IHsKCU5leHRBc3luYzogKHNlbGY6IGFueSkgLT4gKFByb2ZpbGU8VD4/KSwKfQoKdHlwZSBQcm9maWxlU3RvcmVTdGFuZGFyZDxUPiA9IHsKCU5hbWU6IHN0cmluZywKCVN0YXJ0U2Vzc2lvbkFzeW5jOiAoc2VsZjogYW55LCBwcm9maWxlX2tleTogc3RyaW5nLCBwYXJhbXM6IHtTdGVhbDogYm9vbGVhbj99KSAtPiAoUHJvZmlsZTxUPj8pLAoJTWVzc2FnZUFzeW5jOiAoc2VsZjogYW55LCBwcm9maWxlX2tleTogc3RyaW5nLCBtZXNzYWdlOiB7W2FueV06IGFueX0pIC0+IChib29sZWFuKSwKCUdldEFzeW5jOiAoc2VsZjogYW55LCBwcm9maWxlX2tleTogc3RyaW5nLCB2ZXJzaW9uOiBzdHJpbmc/KSAtPiAoUHJvZmlsZTxUPj8pLAoJVmVyc2lvblF1ZXJ5OiAoc2VsZjogYW55LCBwcm9maWxlX2tleTogc3RyaW5nLCBzb3J0X2RpcmVjdGlvbjogRW51bS5Tb3J0RGlyZWN0aW9uPywgbWluX2RhdGU6IERhdGVUaW1lIHwgbnVtYmVyIHwgbmlsLCBtYXhfZGF0ZTogRGF0ZVRpbWUgfCBudW1iZXIgfCBuaWwpIC0+IChWZXJzaW9uUXVlcnk8VD4pLAoJUmVtb3ZlQXN5bmM6IChzZWxmOiBhbnksIHByb2ZpbGVfa2V5OiBzdHJpbmcpIC0+IChib29sZWFuKSwKfQoKZXhwb3J0IHR5cGUgUHJvZmlsZVN0b3JlPFQ+ID0gewoJTW9jazogUHJvZmlsZVN0b3JlU3RhbmRhcmQ8VD4sCn0gJiBQcm9maWxlU3RvcmVTdGFuZGFyZDxUPgoKdHlwZSBDb25zdGFudE5hbWUgPSAiQVVUT19TQVZFX1BFUklPRCIgfCAiTE9BRF9SRVBFQVRfUEVSSU9EIiB8ICJGSVJTVF9MT0FEX1JFUEVBVCIgfCAiU0VTU0lPTl9TVEVBTCIKfCAiQVNTVU1FX0RFQUQiIHwgIlNUQVJUX1NFU1NJT05fVElNRU9VVCIgfCAiQ1JJVElDQUxfU1RBVEVfRVJST1JfQ09VTlQiIHwgIkNSSVRJQ0FMX1NUQVRFX0VSUk9SX0VYUElSRSIKfCAiQ1JJVElDQUxfU1RBVEVfRVhQSVJFIiB8ICJNQVhfTUVTU0FHRV9RVUVVRSIKCmV4cG9ydCB0eXBlIFByb2ZpbGVTdG9yZU1vZHVsZSA9IHsKCUlzQ2xvc2luZzogYm9vbGVhbiwKCUlzQ3JpdGljYWxTdGF0ZTogYm9vbGVhbiwKCU9uRXJyb3I6IHtDb25uZWN0OiAoc2VsZjogYW55LCBsaXN0ZW5lcjogKG1lc3NhZ2U6IHN0cmluZywgc3RvcmVfbmFtZTogc3RyaW5nLCBwcm9maWxlX2tleTogc3RyaW5nKSAtPiAoKSkgLT4gKHtEaXNjb25uZWN0OiAoc2VsZjogYW55KSAtPiAoKX0pfSwKCU9uT3ZlcndyaXRlOiB7Q29ubmVjdDogKHNlbGY6IGFueSwgbGlzdGVuZXI6IChzdG9yZV9uYW1lOiBzdHJpbmcsIHByb2ZpbGVfa2V5OiBzdHJpbmcpIC0+ICgpKSAtPiAoe0Rpc2Nvbm5lY3Q6IChzZWxmOiBhbnkpIC0+ICgpfSl9LAoJT25Dcml0aWNhbFRvZ2dsZToge0Nvbm5lY3Q6IChzZWxmOiBhbnksIGxpc3RlbmVyOiAoaXNfY3JpdGljYWw6IGJvb2xlYW4pIC0+ICgpKSAtPiAoe0Rpc2Nvbm5lY3Q6IChzZWxmOiBhbnkpIC0+ICgpfSl9LAoJRGF0YVN0b3JlU3RhdGU6ICJOb3RSZWFkeSIgfCAiTm9JbnRlcm5ldCIgfCAiTm9BY2Nlc3MiIHwgIkFjY2VzcyIsCglOZXc6IDxUPihzdG9yZV9uYW1lOiBzdHJpbmcsIHRlbXBsYXRlOiBUPykgLT4gKFByb2ZpbGVTdG9yZTxUPiksCglTZXRDb25zdGFudDogKG5hbWU6IENvbnN0YW50TmFtZSwgdmFsdWU6IG51bWJlcikgLT4gKCkKfQoKbG9jYWwgUHJvZmlsZSA9IHt9ClByb2ZpbGUuX19pbmRleCA9IFByb2ZpbGUKCmZ1bmN0aW9uIFByb2ZpbGUuTmV3KHJhd19kYXRhLCBrZXlfaW5mbywgcHJvZmlsZV9zdG9yZSwga2V5LCBpc19tb2NrLCBzZXNzaW9uX3Rva2VuKQoKCWxvY2FsIGRhdGEgPSByYXdfZGF0YS5EYXRhIG9yIHt9Cglsb2NhbCBzZXNzaW9uID0gcmF3X2RhdGEuTWV0YURhdGEgYW5kIHJhd19kYXRhLk1ldGFEYXRhLkFjdGl2ZVNlc3Npb24gb3IgbmlsCgoJbG9jYWwgZ2xvYmFsX3VwZGF0ZXMgPSByYXdfZGF0YS5HbG9iYWxVcGRhdGVzIGFuZCByYXdfZGF0YS5HbG9iYWxVcGRhdGVzWzJdIG9yIHt9Cglsb2NhbCByZWNlaXZlZF9nbG9iYWxfdXBkYXRlcyA9IHt9CgoJZm9yIF8sIHVwZGF0ZSBpbiBpcGFpcnMoZ2xvYmFsX3VwZGF0ZXMpIGRvCgkJcmVjZWl2ZWRfZ2xvYmFsX3VwZGF0ZXNbdXBkYXRlWzFdXSA9IHRydWUKCWVuZAoKCWxvY2FsIHNlbGYgPSB7CgoJCURhdGEgPSBkYXRhLAoJCUxhc3RTYXZlZERhdGEgPSBEZWVwQ29weVRhYmxlKGRhdGEpLAoKCQlGaXJzdFNlc3Npb25UaW1lID0gcmF3X2RhdGEuTWV0YURhdGEgYW5kIHJhd19kYXRhLk1ldGFEYXRhLlByb2ZpbGVDcmVhdGVUaW1lIG9yIDAsCgkJU2Vzc2lvbkxvYWRDb3VudCA9IHJhd19kYXRhLk1ldGFEYXRhIGFuZCByYXdfZGF0YS5NZXRhRGF0YS5TZXNzaW9uTG9hZENvdW50IG9yIDAsCgkJU2Vzc2lvbiA9IHNlc3Npb24gYW5kIHtQbGFjZUlkID0gc2Vzc2lvblsxXSwgSm9iSWQgPSBzZXNzaW9uWzJdfSwKCgkJUm9ibG94TWV0YURhdGEgPSByYXdfZGF0YS5Sb2Jsb3hNZXRhRGF0YSBvciB7fSwKCQlVc2VySWRzID0gcmF3X2RhdGEuVXNlcklkcyBvciB7fSwKCQlLZXlJbmZvID0ga2V5X2luZm8sCgoJCU9uQWZ0ZXJTYXZlID0gU2lnbmFsLk5ldygpLAoJCU9uU2F2ZSA9IFNpZ25hbC5OZXcoKSwKCQlPbkxhc3RTYXZlID0gU2lnbmFsLk5ldygpLAoJCU9uU2Vzc2lvbkVuZCA9IFNpZ25hbC5OZXcoKSwKCgkJUHJvZmlsZVN0b3JlID0gcHJvZmlsZV9zdG9yZSwKCQlLZXkgPSBrZXksCgoJCWxvYWRfdGltZXN0YW1wID0gb3MuY2xvY2soKSwKCQlpc19tb2NrID0gaXNfbW9jaywKCQlzZXNzaW9uX3Rva2VuID0gc2Vzc2lvbl90b2tlbiBvciAiIiwKCQlsb2FkX2luZGV4ID0gcmF3X2RhdGEuTWV0YURhdGEgYW5kIHJhd19kYXRhLk1ldGFEYXRhLlNlc3Npb25Mb2FkQ291bnQgb3IgMCwKCQlsb2NrZWRfZ2xvYmFsX3VwZGF0ZXMgPSB7fSwKCQlyZWNlaXZlZF9nbG9iYWxfdXBkYXRlcyA9IHJlY2VpdmVkX2dsb2JhbF91cGRhdGVzLAoJCW1lc3NhZ2VfaGFuZGxlcnMgPSB7fSwKCQlnbG9iYWxfdXBkYXRlcyA9IGdsb2JhbF91cGRhdGVzLAoKCX0KCXNldG1ldGF0YWJsZShzZWxmLCBQcm9maWxlKQoKCXJldHVybiBzZWxmCgplbmQKCmZ1bmN0aW9uIFByb2ZpbGU6SXNBY3RpdmUoKQoJcmV0dXJuIEFjdGl2ZVNlc3Npb25DaGVja1tzZWxmLnNlc3Npb25fdG9rZW5dID09IHNlbGYKZW5kCgpmdW5jdGlvbiBQcm9maWxlOlJlY29uY2lsZSgpCglSZWNvbmNpbGVUYWJsZShzZWxmLkRhdGEsIHNlbGYuUHJvZmlsZVN0b3JlLnRlbXBsYXRlKQplbmQKCmZ1bmN0aW9uIFByb2ZpbGU6RW5kU2Vzc2lvbigpCglpZiBzZWxmOklzQWN0aXZlKCkgPT0gdHJ1ZSB0aGVuCgkJdGFzay5zcGF3bihTYXZlUHJvZmlsZUFzeW5jLCBzZWxmLCB0cnVlLCBuaWwsICJNYW51YWwiKSAtLSBDYWxsIHNhdmUgZnVuY3Rpb24gaW4gYSBuZXcgdGhyZWFkIHdpdGggcmVsZWFzZV9mcm9tX3Nlc3Npb24gPSB0cnVlCgllbmQKZW5kCgpmdW5jdGlvbiBQcm9maWxlOkFkZFVzZXJJZCh1c2VyX2lkKSAtLSBBc3NvY2lhdGVzIHVzZXJfaWQgd2l0aCBwcm9maWxlIChHRFBSIGNvbXBsaWFuY2UpCgoJaWYgdHlwZSh1c2VyX2lkKSB+PSAibnVtYmVyIiBvciB1c2VyX2lkICUgMSB+PSAwIHRoZW4KCQl3YXJuKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgVXNlcklkIGFyZ3VtZW50IGZvciA6QWRkVXNlcklkKCkgKHt0b3N0cmluZyh1c2VyX2lkKX0pOyBUcmFjZWJhY2s6XG5gIC4uIGRlYnVnLnRyYWNlYmFjaygpKQoJCXJldHVybgoJZW5kCgoJaWYgdXNlcl9pZCA8IDAgYW5kIHNlbGYuaXNfbW9jayB+PSB0cnVlIGFuZCBEYXRhU3RvcmVTdGF0ZSA9PSAiQWNjZXNzIiB0aGVuCgkJcmV0dXJuIC0tIEF2b2lkIGdpdmluZyByZWFsIFJvYmxveCBBUElzIG5lZ2F0aXZlIFVzZXJJZCdzCgllbmQKCglpZiB0YWJsZS5maW5kKHNlbGYuVXNlcklkcywgdXNlcl9pZCkgPT0gbmlsIHRoZW4KCQl0YWJsZS5pbnNlcnQoc2VsZi5Vc2VySWRzLCB1c2VyX2lkKQoJZW5kCgplbmQKCmZ1bmN0aW9uIFByb2ZpbGU6UmVtb3ZlVXNlcklkKHVzZXJfaWQpIC0tIFVuYXNzb2NpYXRlcyB1c2VyX2lkIHdpdGggcHJvZmlsZSAoc2FmZSBmdW5jdGlvbikKCglpZiB0eXBlKHVzZXJfaWQpIH49ICJudW1iZXIiIG9yIHVzZXJfaWQgJSAxIH49IDAgdGhlbgoJCXdhcm4oYFt7c2NyaXB0Lk5hbWV9XTogSW52YWxpZCBVc2VySWQgYXJndW1lbnQgZm9yIDpSZW1vdmVVc2VySWQoKSAoe3Rvc3RyaW5nKHVzZXJfaWQpfSk7IFRyYWNlYmFjazpcbmAgLi4gZGVidWcudHJhY2ViYWNrKCkpCgkJcmV0dXJuCgllbmQKCglsb2NhbCBpbmRleCA9IHRhYmxlLmZpbmQoc2VsZi5Vc2VySWRzLCB1c2VyX2lkKQoKCWlmIGluZGV4IH49IG5pbCB0aGVuCgkJdGFibGUucmVtb3ZlKHNlbGYuVXNlcklkcywgaW5kZXgpCgllbmQKCmVuZAoKZnVuY3Rpb24gUHJvZmlsZTpTZXRBc3luYygpIC0tIFNhdmVzIHRoZSBwcm9maWxlIHRvIHRoZSBEYXRhU3RvcmUgYW5kIHJlbW92ZXMgdGhlIHNlc3Npb24gbG9jawoKCWlmIHNlbGYudmlld19tb2RlIH49IHRydWUgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IDpTZXRBc3luYygpIGNhbiBvbmx5IGJlIHVzZWQgaW4gdmlldyBtb2RlYCkKCWVuZAoKCVNhdmVQcm9maWxlQXN5bmMoc2VsZiwgbmlsLCB0cnVlKQoKZW5kCgpmdW5jdGlvbiBQcm9maWxlOk1lc3NhZ2VIYW5kbGVyKGZuKQoKCWlmIHR5cGUoZm4pIH49ICJmdW5jdGlvbiIgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IGZuIGFyZ3VtZW50IGlzIG5vdCBhIGZ1bmN0aW9uYCkKCWVuZAoKCWlmIHNlbGYudmlld19tb2RlIH49IHRydWUgYW5kIHNlbGY6SXNBY3RpdmUoKSB+PSB0cnVlIHRoZW4KCQlyZXR1cm4gLS0gRG9uJ3QgcHJvY2VzcyBtZXNzYWdlcyBpZiB0aGUgcHJvZmlsZSBzZXNzaW9uIHdhcyBlbmRlZAoJZW5kCgoJbG9jYWwgbG9ja2VkX3VwZGF0ZXMgPSBzZWxmLmxvY2tlZF9nbG9iYWxfdXBkYXRlcwoJdGFibGUuaW5zZXJ0KHNlbGYubWVzc2FnZV9oYW5kbGVycywgZm4pCgoJZm9yIF8sIHVwZGF0ZSBpbiBpcGFpcnMoc2VsZi5nbG9iYWxfdXBkYXRlcykgZG8KCgkJbG9jYWwgaW5kZXggPSB1cGRhdGVbMV0KCQlsb2NhbCB1cGRhdGVfZGF0YSA9IHVwZGF0ZVsjdXBkYXRlXSAtLSBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoIFByb2ZpbGVTZXJ2aWNlCgoJCWlmIGxvY2tlZF91cGRhdGVzW2luZGV4XSB+PSB0cnVlIHRoZW4KCgkJCWxvY2FsIHByb2Nlc3NlZF9jYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJCWxvY2tlZF91cGRhdGVzW2luZGV4XSA9IHRydWUKCQkJZW5kCgoJCQlsb2NhbCBzZW5kX3VwZGF0ZV9kYXRhID0gRGVlcENvcHlUYWJsZSh1cGRhdGVfZGF0YSkKCgkJCXRhc2suc3Bhd24oZm4sIHNlbmRfdXBkYXRlX2RhdGEsIHByb2Nlc3NlZF9jYWxsYmFjaykKCgkJZW5kCgoJZW5kCgplbmQKCmZ1bmN0aW9uIFByb2ZpbGU6U2F2ZSgpCgoJaWYgc2VsZi52aWV3X21vZGUgPT0gdHJ1ZSB0aGVuCgkJZXJyb3IoYFt7c2NyaXB0Lk5hbWV9XTogQ2FuJ3Qgc2F2ZSBwcm9maWxlIGluIHZpZXcgbW9kZTsgU2hvdWxkIHlvdSBiZSBjYWxsaW5nIDpTZXRBc3luYygpIGluc3RlYWQ/YCkKCWVuZAoKCWlmIHNlbGY6SXNBY3RpdmUoKSA9PSBmYWxzZSB0aGVuCgkJd2FybihgW3tzY3JpcHQuTmFtZX1dOiBBdHRlbXB0ZWQgc2F2aW5nIGFuIGluYWN0aXZlIHByb2ZpbGUgKFNUT1JFOntzZWxmLlByb2ZpbGVTdG9yZS5OYW1lfTsgS0VZOntzZWxmLktleX0pO2AKCQkJLi4gYCBUcmFjZWJhY2s6XG5gIC4uIGRlYnVnLnRyYWNlYmFjaygpKQoJCXJldHVybgoJZW5kCgoJLS0gTW92ZSB0aGUgcHJvZmlsZSByaWdodCBiZWhpbmQgdGhlIGF1dG8gc2F2ZSBpbmRleCB0byBkZWxheSB0aGUgbmV4dCBhdXRvIHNhdmUgZm9yIGl0OgoJUmVtb3ZlUHJvZmlsZUZyb21BdXRvU2F2ZShzZWxmKQoJQWRkUHJvZmlsZVRvQXV0b1NhdmUoc2VsZikKCgktLSBQZXJmb3JtIHNhdmUgaW4gbmV3IHRocmVhZDoKCXRhc2suc3Bhd24oU2F2ZVByb2ZpbGVBc3luYywgc2VsZikKCmVuZAoKbG9jYWwgUHJvZmlsZVN0b3JlOiBQcm9maWxlU3RvcmVNb2R1bGUgPSB7CgoJSXNDbG9zaW5nID0gZmFsc2UsCglJc0NyaXRpY2FsU3RhdGUgPSBmYWxzZSwKCU9uRXJyb3IgPSBPbkVycm9yLCAtLSAobWVzc2FnZSwgc3RvcmVfbmFtZSwgcHJvZmlsZV9rZXkpCglPbk92ZXJ3cml0ZSA9IE9uT3ZlcndyaXRlLCAtLSAoc3RvcmVfbmFtZSwgcHJvZmlsZV9rZXkpCglPbkNyaXRpY2FsVG9nZ2xlID0gU2lnbmFsLk5ldygpLCAtLSAoaXNfY3JpdGljYWwpCglEYXRhU3RvcmVTdGF0ZSA9ICJOb3RSZWFkeSIsIC0tICgiTm90UmVhZHkiLCAiTm9JbnRlcm5ldCIsICJOb0FjY2VzcyIsICJBY2Nlc3MiKQoKfQpQcm9maWxlU3RvcmUuX19pbmRleCA9IFByb2ZpbGVTdG9yZQoKZnVuY3Rpb24gUHJvZmlsZVN0b3JlLlNldENvbnN0YW50KG5hbWUsIHZhbHVlKQoKCWlmIHR5cGUodmFsdWUpIH49ICJudW1iZXIiIHRoZW4KCQllcnJvcihgW3tzY3JpcHQuTmFtZX1dOiBJbnZhbGlkIHZhbHVlIHR5cGVgKQoJZW5kCgoJaWYgbmFtZSA9PSAiQVVUT19TQVZFX1BFUklPRCIgdGhlbgoJCUFVVE9fU0FWRV9QRVJJT0QgPSB2YWx1ZQoJZWxzZWlmIG5hbWUgPT0gIkxPQURfUkVQRUFUX1BFUklPRCIgdGhlbgoJCUxPQURfUkVQRUFUX1BFUklPRCA9IHZhbHVlCgllbHNlaWYgbmFtZSA9PSAiRklSU1RfTE9BRF9SRVBFQVQiIHRoZW4KCQlGSVJTVF9MT0FEX1JFUEVBVCA9IHZhbHVlCgllbHNlaWYgbmFtZSA9PSAiU0VTU0lPTl9TVEVBTCIgdGhlbgoJCVNFU1NJT05fU1RFQUwgPSB2YWx1ZQoJZWxzZWlmIG5hbWUgPT0gIkFTU1VNRV9ERUFEIiB0aGVuCgkJQVNTVU1FX0RFQUQgPSB2YWx1ZQoJZWxzZWlmIG5hbWUgPT0gIlNUQVJUX1NFU1NJT05fVElNRU9VVCIgdGhlbgoJCVNUQVJUX1NFU1NJT05fVElNRU9VVCA9IHZhbHVlCgllbHNlaWYgbmFtZSA9PSAiQ1JJVElDQUxfU1RBVEVfRVJST1JfQ09VTlQiIHRoZW4KCQlDUklUSUNBTF9TVEFURV9FUlJPUl9DT1VOVCA9IHZhbHVlCgllbHNlaWYgbmFtZSA9PSAiQ1JJVElDQUxfU1RBVEVfRVJST1JfRVhQSVJFIiB0aGVuCgkJQ1JJVElDQUxfU1RBVEVfRVJST1JfRVhQSVJFID0gdmFsdWUKCWVsc2VpZiBuYW1lID09ICJDUklUSUNBTF9TVEFURV9FWFBJUkUiIHRoZW4KCQlDUklUSUNBTF9TVEFURV9FWFBJUkUgPSB2YWx1ZQoJZWxzZWlmIG5hbWUgPT0gIk1BWF9NRVNTQUdFX1FVRVVFIiB0aGVuCgkJTUFYX01FU1NBR0VfUVVFVUUgPSB2YWx1ZQoJZWxzZQoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgY29uc3RhbnQgbmFtZSB3YXMgcHJvdmlkZWRgKQoJZW5kCgplbmQKCmZ1bmN0aW9uIFByb2ZpbGVTdG9yZS5UZXN0KCkKCXJldHVybiB7CgkJQWN0aXZlU2Vzc2lvbkNoZWNrID0gQWN0aXZlU2Vzc2lvbkNoZWNrLAoJCUF1dG9TYXZlTGlzdCA9IEF1dG9TYXZlTGlzdCwKCQlBY3RpdmVQcm9maWxlTG9hZEpvYnMgPSBBY3RpdmVQcm9maWxlTG9hZEpvYnMsCgkJQWN0aXZlUHJvZmlsZVNhdmVKb2JzID0gQWN0aXZlUHJvZmlsZVNhdmVKb2JzLAoJCU1vY2tTdG9yZSA9IE1vY2tTdG9yZSwKCQlVc2VyTW9ja1N0b3JlID0gVXNlck1vY2tTdG9yZSwKCQlVcGRhdGVRdWV1ZSA9IFVwZGF0ZVF1ZXVlLAoJfQplbmQKCmZ1bmN0aW9uIFByb2ZpbGVTdG9yZS5OZXcoc3RvcmVfbmFtZSwgdGVtcGxhdGUpCgoJdGVtcGxhdGUgPSB0ZW1wbGF0ZSBvciB7fQoKCWlmIHR5cGUoc3RvcmVfbmFtZSkgfj0gInN0cmluZyIgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgb3IgbWlzc2luZyAic3RvcmVfbmFtZSJgKQoJZWxzZWlmIHN0cmluZy5sZW4oc3RvcmVfbmFtZSkgPT0gMCB0aGVuCgkJZXJyb3IoYFt7c2NyaXB0Lk5hbWV9XTogc3RvcmVfbmFtZSBjYW5ub3QgYmUgYW4gZW1wdHkgc3RyaW5nYCkKCWVsc2VpZiBzdHJpbmcubGVuKHN0b3JlX25hbWUpID4gNTAgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IHN0b3JlX25hbWUgaXMgdG9vIGxvbmdgKQoJZW5kCgoJaWYgdHlwZSh0ZW1wbGF0ZSkgfj0gInRhYmxlIiB0aGVuCgkJZXJyb3IoYFt7c2NyaXB0Lk5hbWV9XTogSW52YWxpZCB0ZW1wbGF0ZSBhcmd1bWVudGApCgllbmQKCglsb2NhbCBzZWxmCglzZWxmID0gewoKCQlNb2NrID0gewoKCQkJTmFtZSA9IHN0b3JlX25hbWUsCgoJCQlTdGFydFNlc3Npb25Bc3luYyA9IGZ1bmN0aW9uKF8sIHByb2ZpbGVfa2V5KQoJCQkJTW9ja0ZsYWcgPSB0cnVlCgkJCQlyZXR1cm4gc2VsZjpTdGFydFNlc3Npb25Bc3luYyhwcm9maWxlX2tleSkKCQkJZW5kLAoJCQlNZXNzYWdlQXN5bmMgPSBmdW5jdGlvbihfLCBwcm9maWxlX2tleSwgbWVzc2FnZSkKCQkJCU1vY2tGbGFnID0gdHJ1ZQoJCQkJcmV0dXJuIHNlbGY6TWVzc2FnZUFzeW5jKHByb2ZpbGVfa2V5LCBtZXNzYWdlKQoJCQllbmQsCgkJCUdldEFzeW5jID0gZnVuY3Rpb24oXywgcHJvZmlsZV9rZXksIHZlcnNpb24pCgkJCQlNb2NrRmxhZyA9IHRydWUKCQkJCXJldHVybiBzZWxmOkdldEFzeW5jKHByb2ZpbGVfa2V5LCB2ZXJzaW9uKQoJCQllbmQsCgkJCVZlcnNpb25RdWVyeSA9IGZ1bmN0aW9uKF8sIHByb2ZpbGVfa2V5LCBzb3J0X2RpcmVjdGlvbiwgbWluX2RhdGUsIG1heF9kYXRlKQoJCQkJTW9ja0ZsYWcgPSB0cnVlCgkJCQlyZXR1cm4gc2VsZjpWZXJzaW9uUXVlcnkocHJvZmlsZV9rZXksIHNvcnRfZGlyZWN0aW9uLCBtaW5fZGF0ZSwgbWF4X2RhdGUpCgkJCWVuZCwKCQkJUmVtb3ZlQXN5bmMgPSBmdW5jdGlvbihfLCBwcm9maWxlX2tleSkKCQkJCU1vY2tGbGFnID0gdHJ1ZQoJCQkJcmV0dXJuIHNlbGY6UmVtb3ZlQXN5bmMocHJvZmlsZV9rZXkpCgkJCWVuZAoJCX0sCgoJCU5hbWUgPSBzdG9yZV9uYW1lLAoKCQl0ZW1wbGF0ZSA9IHRlbXBsYXRlLAoJCWRhdGFfc3RvcmUgPSBuaWwsCgkJbG9hZF9qb2JzID0ge30sCgkJbW9ja19sb2FkX2pvYnMgPSB7fSwKCQlpc19yZWFkeSA9IHRydWUsCgoJfQoJc2V0bWV0YXRhYmxlKHNlbGYsIFByb2ZpbGVTdG9yZSkKCglsb2NhbCBvcHRpb25zID0gSW5zdGFuY2UubmV3KCJEYXRhU3RvcmVPcHRpb25zIikKCW9wdGlvbnM6U2V0RXhwZXJpbWVudGFsRmVhdHVyZXMoe3YyID0gdHJ1ZX0pCgoJaWYgRGF0YVN0b3JlU3RhdGUgPT0gIk5vdFJlYWR5IiB0aGVuCgoJCS0tIFRoZSBtb2R1bGUgaXMgbm90IHN1cmUgd2hldGhlciBEYXRhU3RvcmVzIGFyZSBhY2Nlc3NpYmxlIHlldDoKCgkJc2VsZi5pc19yZWFkeSA9IGZhbHNlCgoJCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoKCQkJcmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIERhdGFTdG9yZVN0YXRlIH49ICJOb3RSZWFkeSIKCgkJCWlmIERhdGFTdG9yZVN0YXRlID09ICJBY2Nlc3MiIHRoZW4KCQkJCXNlbGYuZGF0YV9zdG9yZSA9IERhdGFTdG9yZVNlcnZpY2U6R2V0RGF0YVN0b3JlKHN0b3JlX25hbWUsIG5pbCwgb3B0aW9ucykKCQkJZW5kCgoJCQlzZWxmLmlzX3JlYWR5ID0gdHJ1ZQoKCQllbmQpCgoJZWxzZWlmIERhdGFTdG9yZVN0YXRlID09ICJBY2Nlc3MiIHRoZW4KCgkJc2VsZi5kYXRhX3N0b3JlID0gRGF0YVN0b3JlU2VydmljZTpHZXREYXRhU3RvcmUoc3RvcmVfbmFtZSwgbmlsLCBvcHRpb25zKQoKCWVuZAoKCXJldHVybiBzZWxmCgplbmQKCmZ1bmN0aW9uIFByb2ZpbGVTdG9yZTpTdGFydFNlc3Npb25Bc3luYyhwcm9maWxlX2tleSwgcGFyYW1zKQoKCWxvY2FsIGlzX21vY2sgPSBSZWFkTW9ja0ZsYWcoKQoKCWlmIHR5cGUocHJvZmlsZV9rZXkpIH49ICJzdHJpbmciIHRoZW4KCQllcnJvcihgW3tzY3JpcHQuTmFtZX1dOiBwcm9maWxlX2tleSBtdXN0IGJlIGEgc3RyaW5nYCkKCWVsc2VpZiBzdHJpbmcubGVuKHByb2ZpbGVfa2V5KSA9PSAwIHRoZW4KCQllcnJvcihgW3tzY3JpcHQuTmFtZX1dOiBJbnZhbGlkIHByb2ZpbGVfa2V5YCkKCWVsc2VpZiBzdHJpbmcubGVuKHByb2ZpbGVfa2V5KSA+IDUwIHRoZW4KCQllcnJvcihgW3tzY3JpcHQuTmFtZX1dOiBwcm9maWxlX2tleSBpcyB0b28gbG9uZ2ApCgllbmQKCglpZiBwYXJhbXMgfj0gbmlsIGFuZCB0eXBlKHBhcmFtcykgfj0gInRhYmxlIiB0aGVuCgkJZXJyb3IoYFt7c2NyaXB0Lk5hbWV9XTogSW52YWxpZCBwYXJhbXNgKQoJZW5kCgoJcGFyYW1zID0gcGFyYW1zIG9yIHt9CgoJaWYgUHJvZmlsZVN0b3JlLklzQ2xvc2luZyA9PSB0cnVlIHRoZW4KCQlyZXR1cm4gbmlsCgllbmQKCglXYWl0Rm9yU3RvcmVSZWFkeShzZWxmKQoKCWxvY2FsIHNlc3Npb25fdG9rZW4gPSBTZXNzaW9uVG9rZW4oc2VsZi5OYW1lLCBwcm9maWxlX2tleSwgaXNfbW9jaykKCglpZiBBY3RpdmVTZXNzaW9uQ2hlY2tbc2Vzc2lvbl90b2tlbl0gfj0gbmlsIHRoZW4KCQllcnJvcihgW3tzY3JpcHQuTmFtZX1dOiBQcm9maWxlIChTVE9SRTp7c2VsZi5OYW1lfTsgS0VZOntwcm9maWxlX2tleX0pIGlzIGFscmVhZHkgbG9hZGVkIGluIHRoaXMgc2Vzc2lvbmApCgllbmQKCglBY3RpdmVQcm9maWxlTG9hZEpvYnMgPSBBY3RpdmVQcm9maWxlTG9hZEpvYnMgKyAxCgoJbG9jYWwgaXNfdXNlcl9jYW5jZWwgPSBmYWxzZQoKCWxvY2FsIGZ1bmN0aW9uIGNhbmNlbF9jb25kaXRpb24oKQoJCWlmIGlzX3VzZXJfY2FuY2VsID09IGZhbHNlIHRoZW4KCQkJaWYgcGFyYW1zLkNhbmNlbCB+PSBuaWwgdGhlbgoJCQkJaXNfdXNlcl9jYW5jZWwgPSBwYXJhbXMuQ2FuY2VsKCkgPT0gdHJ1ZQoJCQllbmQKCQkJcmV0dXJuIGlzX3VzZXJfY2FuY2VsCgkJZW5kCgkJcmV0dXJuIHRydWUKCWVuZAoKCWxvY2FsIHVzZXJfc3RlYWwgPSBwYXJhbXMuU3RlYWwgPT0gdHJ1ZQoKCWxvY2FsIGZvcmNlX2xvYWRfc3RlcHMgPSAwIC0tIFNlc3Npb24gY29uZmxpY3QgaGFuZGxpbmcgdmFsdWVzCglsb2NhbCByZXF1ZXN0X2ZvcmNlX2xvYWQgPSB0cnVlCglsb2NhbCBzdGVhbF9zZXNzaW9uID0gZmFsc2UKCglsb2NhbCBzdGFydCA9IG9zLmNsb2NrKCkKCWxvY2FsIGV4cF9iYWNrb2ZmID0gMQoKCXdoaWxlIFByb2ZpbGVTdG9yZS5Jc0Nsb3NpbmcgPT0gZmFsc2UgYW5kIGNhbmNlbF9jb25kaXRpb24oKSA9PSBmYWxzZSBkbwoKCQktLSBMb2FkIHByb2ZpbGU6CgoJCS0tIFNQRUNJQUwgQ0FTRSAtIElmIFN0YXJ0U2Vzc2lvbkFzeW5jIGlzIGNhbGxlZCBmb3IgdGhlIHNhbWUga2V5IGFnYWluIGJlZm9yZSBhbm90aGVyIFN0YXJ0U2Vzc2lvbkFzeW5jIGZpbmlzaGVzLAoJCS0tIGdyYWIgdGhlIERhdGFTdG9yZSByZXR1cm4gZm9yIHRoZSBuZXcgY2FsbC4gVGhlIGVhcmx5IGNhbGwgd2lsbCByZXR1cm4gbmlsLiBUaGlzIGlzIHN1cHBvc2VkIHRvIHJldGFpbgoJCS0tIGV4cGVjdGVkIGFuZCBlZmZpY2llbnQgYmVoYXZpb3VyIGluIGNhc2VzIHdoZXJlIGEgcGxheWVyIHdvdWxkIHF1aWNrbHkgcmVqb2luIHRoZSBzYW1lIHNlcnZlci4KCgkJTG9hZEluZGV4ICs9IDEKCQlsb2NhbCBsb2FkX2lkID0gTG9hZEluZGV4CgkJbG9jYWwgcHJvZmlsZV9sb2FkX2pvYnMgPSBpc19tb2NrID09IHRydWUgYW5kIHNlbGYubW9ja19sb2FkX2pvYnMgb3Igc2VsZi5sb2FkX2pvYnMKCQlsb2NhbCBwcm9maWxlX2xvYWRfam9iID0gcHJvZmlsZV9sb2FkX2pvYnNbcHJvZmlsZV9rZXldIC0tIHtsb2FkX2lkLCB7bG9hZGVkX2RhdGEsIGtleV9pbmZvfSBvciBuaWx9CgoJCWxvY2FsIGxvYWRlZF9kYXRhLCBrZXlfaW5mbwoJCWxvY2FsIHVuaXF1ZV9zZXNzaW9uX2lkID0gSHR0cFNlcnZpY2U6R2VuZXJhdGVHVUlEKGZhbHNlKQoKCQlpZiBwcm9maWxlX2xvYWRfam9iIH49IG5pbCB0aGVuCgoJCQlwcm9maWxlX2xvYWRfam9iWzFdID0gbG9hZF9pZCAtLSBTdGVhbCBsb2FkIGpvYgoJCQl3aGlsZSBwcm9maWxlX2xvYWRfam9iWzJdID09IG5pbCBkbyAtLSBXYWl0IGZvciBqb2IgdG8gZmluaXNoCgkJCQl0YXNrLndhaXQoKQoJCQllbmQKCQkJaWYgcHJvZmlsZV9sb2FkX2pvYlsxXSA9PSBsb2FkX2lkIHRoZW4gLS0gTG9hZCBqb2IgaGFzbid0IGJlZW4gZG91YmxlLXN0b2xlbgoJCQkJbG9hZGVkX2RhdGEsIGtleV9pbmZvID0gdGFibGUudW5wYWNrKHByb2ZpbGVfbG9hZF9qb2JbMl0pCgkJCQlwcm9maWxlX2xvYWRfam9ic1twcm9maWxlX2tleV0gPSBuaWwKCQkJZWxzZQoJCQkJQWN0aXZlUHJvZmlsZUxvYWRKb2JzID0gQWN0aXZlUHJvZmlsZUxvYWRKb2JzIC0gMQoJCQkJcmV0dXJuIG5pbAoJCQllbmQKCgkJZWxzZQoKCQkJcHJvZmlsZV9sb2FkX2pvYiA9IHtsb2FkX2lkLCBuaWx9CgkJCXByb2ZpbGVfbG9hZF9qb2JzW3Byb2ZpbGVfa2V5XSA9IHByb2ZpbGVfbG9hZF9qb2IKCgkJCXByb2ZpbGVfbG9hZF9qb2JbMl0gPSB0YWJsZS5wYWNrKFVwZGF0ZUFzeW5jKAoJCQkJc2VsZiwKCQkJCXByb2ZpbGVfa2V5LAoJCQkJewoJCQkJCUV4aXN0aW5nUHJvZmlsZUhhbmRsZSA9IGZ1bmN0aW9uKGxhdGVzdF9kYXRhKQoKCQkJCQkJaWYgUHJvZmlsZVN0b3JlLklzQ2xvc2luZyA9PSB0cnVlIG9yIGNhbmNlbF9jb25kaXRpb24oKSA9PSB0cnVlIHRoZW4KCQkJCQkJCXJldHVybgoJCQkJCQllbmQKCgkJCQkJCWxvY2FsIGFjdGl2ZV9zZXNzaW9uID0gbGF0ZXN0X2RhdGEuTWV0YURhdGEuQWN0aXZlU2Vzc2lvbgoJCQkJCQlsb2NhbCBmb3JjZV9sb2FkX3Nlc3Npb24gPSBsYXRlc3RfZGF0YS5NZXRhRGF0YS5Gb3JjZUxvYWRTZXNzaW9uCgoJCQkJCQlpZiBhY3RpdmVfc2Vzc2lvbiA9PSBuaWwgdGhlbgoJCQkJCQkJbGF0ZXN0X2RhdGEuTWV0YURhdGEuQWN0aXZlU2Vzc2lvbiA9IHtQbGFjZUlkLCBKb2JJZCwgdW5pcXVlX3Nlc3Npb25faWR9CgkJCQkJCQlsYXRlc3RfZGF0YS5NZXRhRGF0YS5Gb3JjZUxvYWRTZXNzaW9uID0gbmlsCgkJCQkJCWVsc2VpZiB0eXBlKGFjdGl2ZV9zZXNzaW9uKSA9PSAidGFibGUiIHRoZW4KCQkJCQkJCWlmIElzVGhpc1Nlc3Npb24oYWN0aXZlX3Nlc3Npb24pID09IGZhbHNlIHRoZW4KCQkJCQkJCQlsb2NhbCBsYXN0X3VwZGF0ZSA9IGxhdGVzdF9kYXRhLk1ldGFEYXRhLkxhc3RVcGRhdGUKCQkJCQkJCQlpZiBsYXN0X3VwZGF0ZSB+PSBuaWwgdGhlbgoJCQkJCQkJCQlpZiBvcy50aW1lKCkgLSBsYXN0X3VwZGF0ZSA+IEFTU1VNRV9ERUFEIHRoZW4KCQkJCQkJCQkJCWxhdGVzdF9kYXRhLk1ldGFEYXRhLkFjdGl2ZVNlc3Npb24gPSB7UGxhY2VJZCwgSm9iSWQsIHVuaXF1ZV9zZXNzaW9uX2lkfQoJCQkJCQkJCQkJbGF0ZXN0X2RhdGEuTWV0YURhdGEuRm9yY2VMb2FkU2Vzc2lvbiA9IG5pbAoJCQkJCQkJCQkJcmV0dXJuCgkJCQkJCQkJCWVuZAoJCQkJCQkJCWVuZAoJCQkJCQkJCWlmIHN0ZWFsX3Nlc3Npb24gPT0gdHJ1ZSBvciB1c2VyX3N0ZWFsID09IHRydWUgdGhlbgoJCQkJCQkJCQlsb2NhbCBmb3JjZV9sb2FkX2ludGVycnVwdGVkID0gaWYgZm9yY2VfbG9hZF9zZXNzaW9uIH49IG5pbCB0aGVuIG5vdCBJc1RoaXNTZXNzaW9uKGZvcmNlX2xvYWRfc2Vzc2lvbikgZWxzZSB0cnVlCgkJCQkJCQkJCWlmIGZvcmNlX2xvYWRfaW50ZXJydXB0ZWQgPT0gZmFsc2Ugb3IgdXNlcl9zdGVhbCA9PSB0cnVlIHRoZW4KCQkJCQkJCQkJCWxhdGVzdF9kYXRhLk1ldGFEYXRhLkFjdGl2ZVNlc3Npb24gPSB7UGxhY2VJZCwgSm9iSWQsIHVuaXF1ZV9zZXNzaW9uX2lkfQoJCQkJCQkJCQkJbGF0ZXN0X2RhdGEuTWV0YURhdGEuRm9yY2VMb2FkU2Vzc2lvbiA9IG5pbAoJCQkJCQkJCQllbmQKCQkJCQkJCQllbHNlaWYgcmVxdWVzdF9mb3JjZV9sb2FkID09IHRydWUgdGhlbgoJCQkJCQkJCQlsYXRlc3RfZGF0YS5NZXRhRGF0YS5Gb3JjZUxvYWRTZXNzaW9uID0ge1BsYWNlSWQsIEpvYklkfQoJCQkJCQkJCWVuZAoJCQkJCQkJZWxzZQoJCQkJCQkJCWxhdGVzdF9kYXRhLk1ldGFEYXRhLkZvcmNlTG9hZFNlc3Npb24gPSBuaWwKCQkJCQkJCWVuZAoJCQkJCQllbmQKCgkJCQkJZW5kLAoJCQkJCU1pc3NpbmdQcm9maWxlSGFuZGxlID0gZnVuY3Rpb24obGF0ZXN0X2RhdGEpCgoJCQkJCQlsb2NhbCBpc19jYW5jZWwgPSBQcm9maWxlU3RvcmUuSXNDbG9zaW5nID09IHRydWUgb3IgY2FuY2VsX2NvbmRpdGlvbigpID09IHRydWUKCgkJCQkJCWxhdGVzdF9kYXRhLkRhdGEgPSBEZWVwQ29weVRhYmxlKHNlbGYudGVtcGxhdGUpCgkJCQkJCWxhdGVzdF9kYXRhLk1ldGFEYXRhID0gewoJCQkJCQkJUHJvZmlsZUNyZWF0ZVRpbWUgPSBvcy50aW1lKCksCgkJCQkJCQlTZXNzaW9uTG9hZENvdW50ID0gMCwKCQkJCQkJCUFjdGl2ZVNlc3Npb24gPSBpZiBpc19jYW5jZWwgPT0gZmFsc2UgdGhlbiB7UGxhY2VJZCwgSm9iSWQsIHVuaXF1ZV9zZXNzaW9uX2lkfSBlbHNlIG5pbCwKCQkJCQkJCUZvcmNlTG9hZFNlc3Npb24gPSBuaWwsCgkJCQkJCQlNZXRhVGFncyA9IHt9LCAtLSBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoIFByb2ZpbGVTZXJ2aWNlCgkJCQkJCX0KCgkJCQkJZW5kLAoJCQkJCUVkaXRQcm9maWxlID0gZnVuY3Rpb24obGF0ZXN0X2RhdGEpCgoJCQkJCQlpZiBQcm9maWxlU3RvcmUuSXNDbG9zaW5nID09IHRydWUgb3IgY2FuY2VsX2NvbmRpdGlvbigpID09IHRydWUgdGhlbgoJCQkJCQkJcmV0dXJuCgkJCQkJCWVuZAoKCQkJCQkJbG9jYWwgYWN0aXZlX3Nlc3Npb24gPSBsYXRlc3RfZGF0YS5NZXRhRGF0YS5BY3RpdmVTZXNzaW9uCgkJCQkJCWlmIGFjdGl2ZV9zZXNzaW9uIH49IG5pbCBhbmQgSXNUaGlzU2Vzc2lvbihhY3RpdmVfc2Vzc2lvbikgPT0gdHJ1ZSB0aGVuCgkJCQkJCQlsYXRlc3RfZGF0YS5NZXRhRGF0YS5TZXNzaW9uTG9hZENvdW50ID0gbGF0ZXN0X2RhdGEuTWV0YURhdGEuU2Vzc2lvbkxvYWRDb3VudCArIDEKCQkJCQkJCWxhdGVzdF9kYXRhLk1ldGFEYXRhLkxhc3RVcGRhdGUgPSBvcy50aW1lKCkKCQkJCQkJZW5kCgoJCQkJCWVuZCwKCQkJCX0sCgkJCQlpc19tb2NrCgkJCQkpKQoJCQlpZiBwcm9maWxlX2xvYWRfam9iWzFdID09IGxvYWRfaWQgdGhlbiAtLSBMb2FkIGpvYiBoYXNuJ3QgYmVlbiBzdG9sZW4KCQkJCWxvYWRlZF9kYXRhLCBrZXlfaW5mbyA9IHRhYmxlLnVucGFjayhwcm9maWxlX2xvYWRfam9iWzJdKQoJCQkJcHJvZmlsZV9sb2FkX2pvYnNbcHJvZmlsZV9rZXldID0gbmlsCgkJCWVsc2UKCQkJCUFjdGl2ZVByb2ZpbGVMb2FkSm9icyA9IEFjdGl2ZVByb2ZpbGVMb2FkSm9icyAtIDEKCQkJCXJldHVybiBuaWwgLS0gTG9hZCBqb2Igc3RvbGVuCgkJCWVuZAoJCWVuZAoKCQktLSBIYW5kbGUgbG9hZF9kYXRhOgoKCQlpZiBsb2FkZWRfZGF0YSB+PSBuaWwgYW5kIGtleV9pbmZvIH49IG5pbCB0aGVuCgkJCWxvY2FsIGFjdGl2ZV9zZXNzaW9uID0gbG9hZGVkX2RhdGEuTWV0YURhdGEuQWN0aXZlU2Vzc2lvbgoJCQlpZiB0eXBlKGFjdGl2ZV9zZXNzaW9uKSA9PSAidGFibGUiIHRoZW4KCgkJCQlpZiBJc1RoaXNTZXNzaW9uKGFjdGl2ZV9zZXNzaW9uKSA9PSB0cnVlIHRoZW4KCgkJCQkJLS0gUHJvZmlsZSBpcyBub3cgdGFrZW4gYnkgdGhpcyBzZXNzaW9uOgoKCQkJCQlsb2NhbCBwcm9maWxlID0gUHJvZmlsZS5OZXcobG9hZGVkX2RhdGEsIGtleV9pbmZvLCBzZWxmLCBwcm9maWxlX2tleSwgaXNfbW9jaywgc2Vzc2lvbl90b2tlbikKCQkJCQlBZGRQcm9maWxlVG9BdXRvU2F2ZShwcm9maWxlKQoKCQkJCQlpZiBpc19tb2NrIH49IHRydWUgYW5kIERhdGFTdG9yZVN0YXRlID09ICJBY2Nlc3MiIHRoZW4KCgkJCQkJCS0tIFVzZSBNZXNzYWdpbmdTZXJ2aWNlIHRvIHF1aWNrbHkgZGV0ZWN0IHNlc3Npb24gY29uZmxpY3RzIGFuZCByZXNvbHZlIHRoZW0gcXVpY2tseToKCgkJCQkJCWxvY2FsIGxhc3Rfcm9ibG94X21lc3NhZ2UgPSAwCgoJCQkJCQlwcm9maWxlLnJvYmxveF9tZXNzYWdlX3N1YnNjcmlwdGlvbiA9IE1lc3NhZ2luZ1NlcnZpY2U6U3Vic2NyaWJlQXN5bmMoIlBTXyIgLi4gdW5pcXVlX3Nlc3Npb25faWQsIGZ1bmN0aW9uKG1lc3NhZ2UpCgkJCQkJCQlpZiB0eXBlKG1lc3NhZ2UuRGF0YSkgPT0gInRhYmxlIiBhbmQgbWVzc2FnZS5EYXRhLkxvYWRDb3VudCA9PSBwcm9maWxlLlNlc3Npb25Mb2FkQ291bnQgdGhlbgoJCQkJCQkJCS0tIEhpZ2ggcmVhY3Rpb24gcmF0ZSwgYmFzZWQgb24gbnVtUGxheWVycyDDlyAxMCBEYXRhU3RvcmUgYnVkZ2V0IGFzIG9mIHdyaXRpbmcKCQkJCQkJCQlpZiBvcy5jbG9jaygpIC0gbGFzdF9yb2Jsb3hfbWVzc2FnZSA+IDYgdGhlbiAKCQkJCQkJCQkJbGFzdF9yb2Jsb3hfbWVzc2FnZSA9IG9zLmNsb2NrKCkKCQkJCQkJCQkJaWYgcHJvZmlsZTpJc0FjdGl2ZSgpID09IHRydWUgdGhlbgoJCQkJCQkJCQkJaWYgbWVzc2FnZS5EYXRhLkVuZFNlc3Npb24gPT0gdHJ1ZSB0aGVuCgkJCQkJCQkJCQkJU2F2ZVByb2ZpbGVBc3luYyhwcm9maWxlLCB0cnVlLCBmYWxzZSwgIkV4dGVybmFsIikKCQkJCQkJCQkJCWVsc2UKCQkJCQkJCQkJCQlwcm9maWxlOlNhdmUoKQoJCQkJCQkJCQkJZW5kCgkJCQkJCQkJCWVuZAoJCQkJCQkJCWVuZAoJCQkJCQkJZW5kCgkJCQkJCWVuZCkKCgkJCQkJZW5kCgoJCQkJCWlmIFByb2ZpbGVTdG9yZS5Jc0Nsb3NpbmcgPT0gdHJ1ZSBvciBjYW5jZWxfY29uZGl0aW9uKCkgPT0gdHJ1ZSB0aGVuCgkJCQkJCS0tIFRoZSBzZXJ2ZXIgaGFzIGluaXRpYXRlZCBhIHNodXRkb3duIGJ5IHRoZSB0aW1lIHRoaXMgcHJvZmlsZSB3YXMgbG9hZGVkCgkJCQkJCVNhdmVQcm9maWxlQXN5bmMocHJvZmlsZSwgdHJ1ZSkgLS0gUmVsZWFzZSBwcm9maWxlIGFuZCB5aWVsZCB1bnRpbCB0aGUgRGF0YVN0b3JlIGNhbGwgaXMgZmluaXNoZWQKCQkJCQkJcHJvZmlsZSA9IG5pbCAtLSBEb24ndCByZXR1cm4gdGhlIHByb2ZpbGUgb2JqZWN0CgkJCQkJZW5kCgoJCQkJCUFjdGl2ZVByb2ZpbGVMb2FkSm9icyA9IEFjdGl2ZVByb2ZpbGVMb2FkSm9icyAtIDEKCQkJCQlyZXR1cm4gcHJvZmlsZQoKCQkJCWVsc2UKCgkJCQkJaWYgUHJvZmlsZVN0b3JlLklzQ2xvc2luZyA9PSB0cnVlIG9yIGNhbmNlbF9jb25kaXRpb24oKSA9PSB0cnVlIHRoZW4KCQkJCQkJQWN0aXZlUHJvZmlsZUxvYWRKb2JzID0gQWN0aXZlUHJvZmlsZUxvYWRKb2JzIC0gMQoJCQkJCQlyZXR1cm4gbmlsCgkJCQkJZW5kCgoJCQkJCS0tIFByb2ZpbGUgaXMgdGFrZW4gYnkgc29tZSBvdGhlciBzZXNzaW9uOgoKCQkJCQlsb2NhbCBmb3JjZV9sb2FkX3Nlc3Npb24gPSBsb2FkZWRfZGF0YS5NZXRhRGF0YS5Gb3JjZUxvYWRTZXNzaW9uCgkJCQkJbG9jYWwgZm9yY2VfbG9hZF9pbnRlcnJ1cHRlZCA9IGlmIGZvcmNlX2xvYWRfc2Vzc2lvbiB+PSBuaWwgdGhlbiBub3QgSXNUaGlzU2Vzc2lvbihmb3JjZV9sb2FkX3Nlc3Npb24pIGVsc2UgdHJ1ZQoKCQkJCQlpZiBmb3JjZV9sb2FkX2ludGVycnVwdGVkID09IGZhbHNlIHRoZW4KCgkJCQkJCWlmIHJlcXVlc3RfZm9yY2VfbG9hZCA9PSBmYWxzZSB0aGVuCgkJCQkJCQlmb3JjZV9sb2FkX3N0ZXBzID0gZm9yY2VfbG9hZF9zdGVwcyArIDEKCQkJCQkJCWlmIGZvcmNlX2xvYWRfc3RlcHMgPj0gbWF0aC5jZWlsKFNFU1NJT05fU1RFQUwgLyBMT0FEX1JFUEVBVF9QRVJJT0QpIHRoZW4KCQkJCQkJCQlzdGVhbF9zZXNzaW9uID0gdHJ1ZQoJCQkJCQkJZW5kCgkJCQkJCWVuZAoKCQkJCQkJLS0gUmVxdWVzdCB0aGUgcmVtb3RlIHNlcnZlciB0byBlbmQgaXRzIHNlc3Npb246CgkJCQkJCWlmIHR5cGUoYWN0aXZlX3Nlc3Npb25bM10pID09ICJzdHJpbmciIHRoZW4KCQkJCQkJCWxvY2FsIHNlc3Npb25fbG9hZF9jb3VudCA9IGxvYWRlZF9kYXRhLk1ldGFEYXRhLlNlc3Npb25Mb2FkQ291bnQgb3IgMAoJCQkJCQkJTWVzc2FnaW5nU2VydmljZTpQdWJsaXNoQXN5bmMoIlBTXyIgLi4gYWN0aXZlX3Nlc3Npb25bM10sIHtMb2FkQ291bnQgPSBzZXNzaW9uX2xvYWRfY291bnQsIEVuZFNlc3Npb24gPSB0cnVlfSkKCQkJCQkJZW5kCgoJCQkJCQktLSBBdHRlbXB0IHRvIGxvYWQgdGhlIHByb2ZpbGUgYWdhaW4gYWZ0ZXIgYSBkZWxheQoJCQkJCQlsb2NhbCB3YWl0X3VudGlsID0gb3MuY2xvY2soKSArIGlmIHJlcXVlc3RfZm9yY2VfbG9hZCA9PSB0cnVlIHRoZW4gRklSU1RfTE9BRF9SRVBFQVQgZWxzZSBMT0FEX1JFUEVBVF9QRVJJT0QKCQkJCQkJcmVwZWF0IHRhc2sud2FpdCgpIHVudGlsIG9zLmNsb2NrKCkgPj0gd2FpdF91bnRpbCBvciBQcm9maWxlU3RvcmUuSXNDbG9zaW5nID09IHRydWUKCgkJCQkJZWxzZQoJCQkJCQktLSBBbm90aGVyIHNlc3Npb24gdHJpZWQgdG8gbG9hZCB0aGlzIHByb2ZpbGU6CgkJCQkJCUFjdGl2ZVByb2ZpbGVMb2FkSm9icyA9IEFjdGl2ZVByb2ZpbGVMb2FkSm9icyAtIDEKCQkJCQkJcmV0dXJuIG5pbAoJCQkJCWVuZAoKCQkJCQlyZXF1ZXN0X2ZvcmNlX2xvYWQgPSBmYWxzZSAtLSBPbmx5IHJlcXVlc3QgYSBmb3JjZSBsb2FkIG9uY2UKCgkJCQllbmQKCgkJCWVsc2UKCQkJCUFjdGl2ZVByb2ZpbGVMb2FkSm9icyA9IEFjdGl2ZVByb2ZpbGVMb2FkSm9icyAtIDEKCQkJCXJldHVybiBuaWwgLS0gSW4gdGhpcyBzY2VuYXJpbyBpdCBpcyBsaWtlbHkgdGhhdCB0aGlzIHNlcnZlciBzdGFydGVkIHNodXR0aW5nIGRvd24KCQkJZW5kCgkJZWxzZQoKCQkJLS0gQSBEYXRhU3RvcmUgY2FsbCBoYXMgbGlrZWx5IGVuZGVkIGluIGFuIGVycm9yOgoKCQkJbG9jYWwgZGVmYXVsdF90aW1lb3V0ID0gZmFsc2UKCgkJCWlmIHBhcmFtcy5DYW5jZWwgPT0gbmlsIHRoZW4KCQkJCWRlZmF1bHRfdGltZW91dCA9IG9zLmNsb2NrKCkgLSBzdGFydCA+PSBTVEFSVF9TRVNTSU9OX1RJTUVPVVQKCQkJZW5kCgoJCQlpZiBkZWZhdWx0X3RpbWVvdXQgPT0gdHJ1ZSBvciBQcm9maWxlU3RvcmUuSXNDbG9zaW5nID09IHRydWUgb3IgY2FuY2VsX2NvbmRpdGlvbigpID09IHRydWUgdGhlbgoJCQkJQWN0aXZlUHJvZmlsZUxvYWRKb2JzID0gQWN0aXZlUHJvZmlsZUxvYWRKb2JzIC0gMQoJCQkJcmV0dXJuIG5pbAoJCQllbmQKCgkJCXRhc2sud2FpdChleHBfYmFja29mZikgIC0tIFJlcGVhdCB0aGUgY2FsbCBzaG9ydGx5CgkJCWV4cF9iYWNrb2ZmID0gbWF0aC5taW4oMjAsIGV4cF9iYWNrb2ZmICogMikKCgkJZW5kCgoJZW5kCgoJQWN0aXZlUHJvZmlsZUxvYWRKb2JzID0gQWN0aXZlUHJvZmlsZUxvYWRKb2JzIC0gMQoJcmV0dXJuIG5pbCAtLSBHYW1lIHN0YXJ0ZWQgc2h1dHRpbmcgZG93biBvciB0aGUgcmVxdWVzdCB3YXMgY2FuY2VsbGVkIC0gZG9uJ3QgcmV0dXJuIHRoZSBwcm9maWxlCgplbmQKCmZ1bmN0aW9uIFByb2ZpbGVTdG9yZTpNZXNzYWdlQXN5bmMocHJvZmlsZV9rZXksIG1lc3NhZ2UpCgoJbG9jYWwgaXNfbW9jayA9IFJlYWRNb2NrRmxhZygpCgoJaWYgdHlwZShwcm9maWxlX2tleSkgfj0gInN0cmluZyIgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IHByb2ZpbGVfa2V5IG11c3QgYmUgYSBzdHJpbmdgKQoJZWxzZWlmIHN0cmluZy5sZW4ocHJvZmlsZV9rZXkpID09IDAgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgcHJvZmlsZV9rZXlgKQoJZWxzZWlmIHN0cmluZy5sZW4ocHJvZmlsZV9rZXkpID4gNTAgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IHByb2ZpbGVfa2V5IGlzIHRvbyBsb25nYCkKCWVuZAoKCWlmIHR5cGUobWVzc2FnZSkgfj0gInRhYmxlIiB0aGVuCgkJZXJyb3IoYFt7c2NyaXB0Lk5hbWV9XTogbWVzc2FnZSBtdXN0IGJlIGEgdGFibGVgKQoJZW5kCgoJaWYgUHJvZmlsZVN0b3JlLklzQ2xvc2luZyA9PSB0cnVlIHRoZW4KCQlyZXR1cm4gZmFsc2UKCWVuZAoKCVdhaXRGb3JTdG9yZVJlYWR5KHNlbGYpCgoJbG9jYWwgZXhwX2JhY2tvZmYgPSAxCgoJd2hpbGUgUHJvZmlsZVN0b3JlLklzQ2xvc2luZyA9PSBmYWxzZSBkbwoKCQktLSBVcGRhdGluZyBwcm9maWxlOgoKCQlsb2NhbCBsb2FkZWRfZGF0YSA9IFVwZGF0ZUFzeW5jKAoJCQlzZWxmLAoJCQlwcm9maWxlX2tleSwKCQkJewoJCQkJRXhpc3RpbmdQcm9maWxlSGFuZGxlID0gbmlsLAoJCQkJTWlzc2luZ1Byb2ZpbGVIYW5kbGUgPSBuaWwsCgkJCQlFZGl0UHJvZmlsZSA9IGZ1bmN0aW9uKGxhdGVzdF9kYXRhKQoKCQkJCQlsb2NhbCBnbG9iYWxfdXBkYXRlcyA9IGxhdGVzdF9kYXRhLkdsb2JhbFVwZGF0ZXMKCQkJCQlsb2NhbCB1cGRhdGVfbGlzdCA9IGdsb2JhbF91cGRhdGVzWzJdCgkJCQkJLS17CgkJCQkJLS0JdXBkYXRlX2luZGV4LAoJCQkJCS0tCXsKCQkJCQktLQkJe3VwZGF0ZV9pbmRleCwgZGF0YX0sIC4uLgoJCQkJCS0tCX0sCgkJCQkJLS19LAoKCQkJCQlnbG9iYWxfdXBkYXRlc1sxXSArPSAxCgkJCQkJdGFibGUuaW5zZXJ0KHVwZGF0ZV9saXN0LCB7Z2xvYmFsX3VwZGF0ZXNbMV0sIG1lc3NhZ2V9KQoKCQkJCQktLSBDbGVhcmluZyBxdWV1ZSBpZiBhYm92ZSBsaW1pdDoKCgkJCQkJd2hpbGUgI3VwZGF0ZV9saXN0ID4gTUFYX01FU1NBR0VfUVVFVUUgZG8KCQkJCQkJdGFibGUucmVtb3ZlKHVwZGF0ZV9saXN0LCAxKQoJCQkJCWVuZAoKCQkJCWVuZCwKCQkJfSwKCQkJaXNfbW9jawoJCSkKCgkJaWYgbG9hZGVkX2RhdGEgfj0gbmlsIHRoZW4KCgkJCWxvY2FsIHNlc3Npb25fdG9rZW4gPSBTZXNzaW9uVG9rZW4oc2VsZi5OYW1lLCBwcm9maWxlX2tleSwgaXNfbW9jaykKCgkJCWxvY2FsIHByb2ZpbGUgPSBBY3RpdmVTZXNzaW9uQ2hlY2tbc2Vzc2lvbl90b2tlbl0KCgkJCWlmIHByb2ZpbGUgfj0gbmlsIHRoZW4KCgkJCQktLSBUaGUgbWVzc2FnZSB3YXMgc2VudCB0byBhIHByb2ZpbGUgdGhhdCBpcyBhY3RpdmUgaW4gdGhpcyBzZXJ2ZXI6CgkJCQlwcm9maWxlOlNhdmUoKQoKCQkJZWxzZQoKCQkJCWxvY2FsIG1ldGFfZGF0YSA9IGxvYWRlZF9kYXRhLk1ldGFEYXRhIG9yIHt9CgkJCQlsb2NhbCBhY3RpdmVfc2Vzc2lvbiA9IG1ldGFfZGF0YS5BY3RpdmVTZXNzaW9uCgkJCQlsb2NhbCBzZXNzaW9uX2xvYWRfY291bnQgPSBtZXRhX2RhdGEuU2Vzc2lvbkxvYWRDb3VudCBvciAwCgoJCQkJaWYgdHlwZShhY3RpdmVfc2Vzc2lvbikgPT0gInRhYmxlIiBhbmQgdHlwZShhY3RpdmVfc2Vzc2lvblszXSkgPT0gInN0cmluZyIgdGhlbgoJCQkJCS0tIFJlcXVlc3QgdGhlIHJlbW90ZSBzZXJ2ZXIgdG8gYXV0by1zYXZlIHNvb25lciBhbmQgcmVjZWl2ZSB0aGUgbWVzc2FnZToKCQkJCQlNZXNzYWdpbmdTZXJ2aWNlOlB1Ymxpc2hBc3luYygiUFNfIiAuLiBhY3RpdmVfc2Vzc2lvblszXSwge0xvYWRDb3VudCA9IHNlc3Npb25fbG9hZF9jb3VudH0pCgkJCQllbmQKCgkJCWVuZAoKCQkJcmV0dXJuIHRydWUKCgkJZWxzZQoKCQkJdGFzay53YWl0KGV4cF9iYWNrb2ZmKSAtLSBBIERhdGFTdG9yZSBjYWxsIGhhcyBsaWtlbHkgZW5kZWQgaW4gYW4gZXJyb3IgLSByZXBlYXQgdGhlIGNhbGwgc2hvcnRseQoJCQlleHBfYmFja29mZiA9IG1hdGgubWluKDIwLCBleHBfYmFja29mZiAqIDIpCgoJCWVuZAoKCWVuZAoKCXJldHVybiBmYWxzZQoKZW5kCgpmdW5jdGlvbiBQcm9maWxlU3RvcmU6R2V0QXN5bmMocHJvZmlsZV9rZXksIHZlcnNpb24pCgoJbG9jYWwgaXNfbW9jayA9IFJlYWRNb2NrRmxhZygpCgoJaWYgdHlwZShwcm9maWxlX2tleSkgfj0gInN0cmluZyIgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IHByb2ZpbGVfa2V5IG11c3QgYmUgYSBzdHJpbmdgKQoJZWxzZWlmIHN0cmluZy5sZW4ocHJvZmlsZV9rZXkpID09IDAgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgcHJvZmlsZV9rZXlgKQoJZWxzZWlmIHN0cmluZy5sZW4ocHJvZmlsZV9rZXkpID4gNTAgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IHByb2ZpbGVfa2V5IGlzIHRvbyBsb25nYCkKCWVuZAoKCWlmIFByb2ZpbGVTdG9yZS5Jc0Nsb3NpbmcgPT0gdHJ1ZSB0aGVuCgkJcmV0dXJuIG5pbAoJZW5kCgoJV2FpdEZvclN0b3JlUmVhZHkoc2VsZikKCglpZiB2ZXJzaW9uIH49IG5pbCBhbmQgKGlzX21vY2sgb3IgRGF0YVN0b3JlU3RhdGUgfj0gIkFjY2VzcyIpIHRoZW4KCQlyZXR1cm4gbmlsIC0tIE5vIHZlcnNpb24gc3VwcG9ydCBpbiBtb2NrIG1vZGUKCWVuZAoKCWxvY2FsIGV4cF9iYWNrb2ZmID0gMQoKCXdoaWxlIFByb2ZpbGVTdG9yZS5Jc0Nsb3NpbmcgPT0gZmFsc2UgZG8KCgkJLS0gTG9hZCBwcm9maWxlOgoKCQlsb2NhbCBsb2FkZWRfZGF0YSwga2V5X2luZm8gPSBVcGRhdGVBc3luYygKCQkJc2VsZiwKCQkJcHJvZmlsZV9rZXksCgkJCXsKCQkJCUV4aXN0aW5nUHJvZmlsZUhhbmRsZSA9IG5pbCwKCQkJCU1pc3NpbmdQcm9maWxlSGFuZGxlID0gZnVuY3Rpb24obGF0ZXN0X2RhdGEpCgoJCQkJCWxhdGVzdF9kYXRhLkRhdGEgPSBEZWVwQ29weVRhYmxlKHNlbGYudGVtcGxhdGUpCgkJCQkJbGF0ZXN0X2RhdGEuTWV0YURhdGEgPSB7CgkJCQkJCVByb2ZpbGVDcmVhdGVUaW1lID0gb3MudGltZSgpLAoJCQkJCQlTZXNzaW9uTG9hZENvdW50ID0gMCwKCQkJCQkJQWN0aXZlU2Vzc2lvbiA9IG5pbCwKCQkJCQkJRm9yY2VMb2FkU2Vzc2lvbiA9IG5pbCwKCQkJCQkJTWV0YVRhZ3MgPSB7fSwgLS0gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCBQcm9maWxlU2VydmljZQoJCQkJCX0KCgkJCQllbmQsCgkJCQlFZGl0UHJvZmlsZSA9IG5pbCwKCQkJfSwKCQkJaXNfbW9jaywKCQkJdHJ1ZSwgLS0gVXNlIDpHZXRBc3luYygpCgkJCXZlcnNpb24gLS0gRGF0YVN0b3JlIGtleSB2ZXJzaW9uCgkJKQoKCQktLSBIYW5kbGUgbG9hZF9kYXRhOgoKCQlpZiBsb2FkZWRfZGF0YSB+PSBuaWwgdGhlbgoKCQkJaWYga2V5X2luZm8gPT0gbmlsIHRoZW4KCQkJCXJldHVybiBuaWwgLS0gTG9hZCB3YXMgc3VjY2Vzc2Z1bCwgYnV0IHRoZSBrZXkgd2FzIGVtcHR5IC0gcmV0dXJuIG5vIHByb2ZpbGUgb2JqZWN0CgkJCWVuZAoKCQkJbG9jYWwgcHJvZmlsZSA9IFByb2ZpbGUuTmV3KGxvYWRlZF9kYXRhLCBrZXlfaW5mbywgc2VsZiwgcHJvZmlsZV9rZXksIGlzX21vY2spCgkJCXByb2ZpbGUudmlld19tb2RlID0gdHJ1ZQoKCQkJcmV0dXJuIHByb2ZpbGUKCgkJZWxzZQoKCQkJdGFzay53YWl0KGV4cF9iYWNrb2ZmKSAtLSBBIERhdGFTdG9yZSBjYWxsIGhhcyBsaWtlbHkgZW5kZWQgaW4gYW4gZXJyb3IgLSByZXBlYXQgdGhlIGNhbGwgc2hvcnRseQoJCQlleHBfYmFja29mZiA9IG1hdGgubWluKDIwLCBleHBfYmFja29mZiAqIDIpCgoJCWVuZAoKCWVuZAoKCXJldHVybiBuaWwgLS0gR2FtZSBzdGFydGVkIHNodXR0aW5nIGRvd24gLSBkb24ndCByZXR1cm4gdGhlIHByb2ZpbGUKCmVuZAoKZnVuY3Rpb24gUHJvZmlsZVN0b3JlOlJlbW92ZUFzeW5jKHByb2ZpbGVfa2V5KQoKCWxvY2FsIGlzX21vY2sgPSBSZWFkTW9ja0ZsYWcoKQoKCWlmIHR5cGUocHJvZmlsZV9rZXkpIH49ICJzdHJpbmciIG9yIHN0cmluZy5sZW4ocHJvZmlsZV9rZXkpID09IDAgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgcHJvZmlsZV9rZXlgKQoJZW5kCgoJaWYgUHJvZmlsZVN0b3JlLklzQ2xvc2luZyA9PSB0cnVlIHRoZW4KCQlyZXR1cm4gZmFsc2UKCWVuZAoKCVdhaXRGb3JTdG9yZVJlYWR5KHNlbGYpCgoJbG9jYWwgd2lwZV9zdGF0dXMgPSBmYWxzZQoKCWxvY2FsIG5leHRfaW5fcXVldWUgPSBXYWl0SW5VcGRhdGVRdWV1ZShTZXNzaW9uVG9rZW4oc2VsZi5OYW1lLCBwcm9maWxlX2tleSwgaXNfbW9jaykpCgoJaWYgaXNfbW9jayA9PSB0cnVlIHRoZW4gLS0gVXNlZCB3aGVuIHRoZSBwcm9maWxlIGlzIGFjY2Vzc2VkIHRocm91Z2ggUHJvZmlsZVN0b3JlLk1vY2sKCgkJbG9jYWwgbW9ja19kYXRhX3N0b3JlID0gVXNlck1vY2tTdG9yZVtzZWxmLk5hbWVdCgoJCWlmIG1vY2tfZGF0YV9zdG9yZSB+PSBuaWwgdGhlbgoJCQltb2NrX2RhdGFfc3RvcmVbcHJvZmlsZV9rZXldID0gbmlsCgkJCWlmIG5leHQobW9ja19kYXRhX3N0b3JlKSA9PSBuaWwgdGhlbgoJCQkJVXNlck1vY2tTdG9yZVtzZWxmLk5hbWVdID0gbmlsCgkJCWVuZAoJCWVuZAoKCQl3aXBlX3N0YXR1cyA9IHRydWUKCQl0YXNrLndhaXQoKSAtLSBTaW11bGF0ZSBBUEkgY2FsbCB5aWVsZAoKCWVsc2VpZiBEYXRhU3RvcmVTdGF0ZSB+PSAiQWNjZXNzIiB0aGVuIC0tIFVzZWQgd2hlbiBBUEkgYWNjZXNzIGlzIGRpc2FibGVkCgoJCWxvY2FsIG1vY2tfZGF0YV9zdG9yZSA9IE1vY2tTdG9yZVtzZWxmLk5hbWVdCgoJCWlmIG1vY2tfZGF0YV9zdG9yZSB+PSBuaWwgdGhlbgoJCQltb2NrX2RhdGFfc3RvcmVbcHJvZmlsZV9rZXldID0gbmlsCgkJCWlmIG5leHQobW9ja19kYXRhX3N0b3JlKSA9PSBuaWwgdGhlbgoJCQkJTW9ja1N0b3JlW3NlbGYuTmFtZV0gPSBuaWwKCQkJZW5kCgkJZW5kCgoJCXdpcGVfc3RhdHVzID0gdHJ1ZQoJCXRhc2sud2FpdCgpIC0tIFNpbXVsYXRlIEFQSSBjYWxsIHlpZWxkCgoJZWxzZSAtLSBMaXZlIERhdGFTdG9yZQoKCQl3aXBlX3N0YXR1cyA9IHBjYWxsKGZ1bmN0aW9uKCkKCQkJc2VsZi5kYXRhX3N0b3JlOlJlbW92ZUFzeW5jKHByb2ZpbGVfa2V5KQoJCWVuZCkKCgllbmQKCgluZXh0X2luX3F1ZXVlKCkKCglyZXR1cm4gd2lwZV9zdGF0dXMKCmVuZAoKbG9jYWwgUHJvZmlsZVZlcnNpb25RdWVyeSA9IHt9ClByb2ZpbGVWZXJzaW9uUXVlcnkuX19pbmRleCA9IFByb2ZpbGVWZXJzaW9uUXVlcnkKCmZ1bmN0aW9uIFByb2ZpbGVWZXJzaW9uUXVlcnkuTmV3KHByb2ZpbGVfc3RvcmUsIHByb2ZpbGVfa2V5LCBzb3J0X2RpcmVjdGlvbiwgbWluX2RhdGUsIG1heF9kYXRlKQoKCWxvY2FsIHNlbGYgPSB7CgkJcHJvZmlsZV9zdG9yZSA9IHByb2ZpbGVfc3RvcmUsCgkJcHJvZmlsZV9rZXkgPSBwcm9maWxlX2tleSwKCQlzb3J0X2RpcmVjdGlvbiA9IHNvcnRfZGlyZWN0aW9uLAoJCW1pbl9kYXRlID0gbWluX2RhdGUsCgkJbWF4X2RhdGUgPSBtYXhfZGF0ZSwKCgkJcXVlcnlfcGFnZXMgPSBuaWwsCgkJcXVlcnlfaW5kZXggPSAwLAoJCXF1ZXJ5X2ZhaWx1cmUgPSBmYWxzZSwKCgkJaXNfcXVlcnlfeWllbGRlZCA9IGZhbHNlLAoJCXF1ZXJ5X3F1ZXVlID0ge30sCgl9CglzZXRtZXRhdGFibGUoc2VsZiwgUHJvZmlsZVZlcnNpb25RdWVyeSkKCglyZXR1cm4gc2VsZgoKZW5kCgpmdW5jdGlvbiBNb3ZlVmVyc2lvblF1ZXJ5UXVldWUoc2VsZikgLS0gSGlkZGVuIFByb2ZpbGVWZXJzaW9uUXVlcnkgbWV0aG9kCgl3aGlsZSAjc2VsZi5xdWVyeV9xdWV1ZSA+IDAgZG8KCgkJbG9jYWwgcXVldWVfZW50cnkgPSB0YWJsZS5yZW1vdmUoc2VsZi5xdWVyeV9xdWV1ZSwgMSkKCgkJdGFzay5zcGF3bihxdWV1ZV9lbnRyeSkKCgkJaWYgc2VsZi5pc19xdWVyeV95aWVsZGVkID09IHRydWUgdGhlbgoJCQlicmVhawoJCWVuZAoKCWVuZAplbmQKCmxvY2FsIFZlcnNpb25RdWVyeU5leHRBc3luY1N0YWNraW5nRmxhZyA9IGZhbHNlCgpmdW5jdGlvbiBQcm9maWxlVmVyc2lvblF1ZXJ5Ok5leHRBc3luYygpCgoJbG9jYWwgaXNfc3RhY2tpbmcgPSBWZXJzaW9uUXVlcnlOZXh0QXN5bmNTdGFja2luZ0ZsYWcgPT0gdHJ1ZQoJVmVyc2lvblF1ZXJ5TmV4dEFzeW5jU3RhY2tpbmdGbGFnID0gZmFsc2UKCglpZiBzZWxmLnByb2ZpbGVfc3RvcmUgPT0gbmlsIHRoZW4KCQlyZXR1cm4gbmlsCgllbmQKCglXYWl0Rm9yU3RvcmVSZWFkeShzZWxmLnByb2ZpbGVfc3RvcmUpCgoJbG9jYWwgcHJvZmlsZQoJbG9jYWwgaXNfZmluaXNoZWQgPSBmYWxzZQoKCWxvY2FsIGZ1bmN0aW9uIHF1ZXJ5X2pvYigpCgoJCWlmIHNlbGYucXVlcnlfZmFpbHVyZSA9PSB0cnVlIHRoZW4KCQkJaXNfZmluaXNoZWQgPSB0cnVlCgkJCXJldHVybgoJCWVuZAoKCQktLSBGaXJzdCAibmV4dCIgY2FsbCBsb2FkcyB2ZXJzaW9uIHBhZ2VzOgoKCQlpZiBzZWxmLnF1ZXJ5X3BhZ2VzID09IG5pbCB0aGVuCgoJCQlzZWxmLmlzX3F1ZXJ5X3lpZWxkZWQgPSB0cnVlCgoJCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJCVZlcnNpb25RdWVyeU5leHRBc3luY1N0YWNraW5nRmxhZyA9IHRydWUKCQkJCXByb2ZpbGUgPSBzZWxmOk5leHRBc3luYygpCgkJCQlpc19maW5pc2hlZCA9IHRydWUKCQkJZW5kKQoKCQkJbG9jYWwgbGlzdF9zdWNjZXNzLCBlcnJvcl9tZXNzYWdlID0gcGNhbGwoZnVuY3Rpb24oKQoJCQkJc2VsZi5xdWVyeV9wYWdlcyA9IHNlbGYucHJvZmlsZV9zdG9yZS5kYXRhX3N0b3JlOkxpc3RWZXJzaW9uc0FzeW5jKAoJCQkJCXNlbGYucHJvZmlsZV9rZXksCgkJCQkJc2VsZi5zb3J0X2RpcmVjdGlvbiwKCQkJCQlzZWxmLm1pbl9kYXRlLAoJCQkJCXNlbGYubWF4X2RhdGUKCQkJCSkKCQkJCXNlbGYucXVlcnlfaW5kZXggPSAwCgkJCWVuZCkKCgkJCWlmIGxpc3Rfc3VjY2VzcyA9PSBmYWxzZSBvciBzZWxmLnF1ZXJ5X3BhZ2VzID09IG5pbCB0aGVuCgkJCQl3YXJuKGBbe3NjcmlwdC5OYW1lfV06IFZlcnNpb24gcXVlcnkgZmFpbCAtIHt0b3N0cmluZyhlcnJvcl9tZXNzYWdlKX1gKQoJCQkJc2VsZi5xdWVyeV9mYWlsdXJlID0gdHJ1ZQoJCQllbmQKCgkJCXNlbGYuaXNfcXVlcnlfeWllbGRlZCA9IGZhbHNlCgoJCQlNb3ZlVmVyc2lvblF1ZXJ5UXVldWUoc2VsZikKCgkJCXJldHVybgoKCQllbmQKCgkJbG9jYWwgY3VycmVudF9wYWdlID0gc2VsZi5xdWVyeV9wYWdlczpHZXRDdXJyZW50UGFnZSgpCgkJbG9jYWwgbmV4dF9pdGVtID0gY3VycmVudF9wYWdlW3NlbGYucXVlcnlfaW5kZXggKyAxXQoKCQktLSBObyBtb3JlIGVudHJpZXM6CgoJCWlmIHNlbGYucXVlcnlfcGFnZXMuSXNGaW5pc2hlZCA9PSB0cnVlIGFuZCBuZXh0X2l0ZW0gPT0gbmlsIHRoZW4KCQkJaXNfZmluaXNoZWQgPSB0cnVlCgkJCXJldHVybgoJCWVuZAoKCQktLSBMb2FkIG5leHQgcGFnZSB3aGVuIHRoaXMgcGFnZSBpcyBvdmVyOgoKCQlpZiBuZXh0X2l0ZW0gPT0gbmlsIHRoZW4KCgkJCXNlbGYuaXNfcXVlcnlfeWllbGRlZCA9IHRydWUKCQkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCQlWZXJzaW9uUXVlcnlOZXh0QXN5bmNTdGFja2luZ0ZsYWcgPSB0cnVlCgkJCQlwcm9maWxlID0gc2VsZjpOZXh0QXN5bmMoKQoJCQkJaXNfZmluaXNoZWQgPSB0cnVlCgkJCWVuZCkKCgkJCWxvY2FsIHN1Y2Nlc3MsIGVycm9yX21lc3NhZ2UgPSBwY2FsbChmdW5jdGlvbigpCgkJCQlzZWxmLnF1ZXJ5X3BhZ2VzOkFkdmFuY2VUb05leHRQYWdlQXN5bmMoKQoJCQkJc2VsZi5xdWVyeV9pbmRleCA9IDAKCQkJZW5kKQoKCQkJaWYgc3VjY2VzcyA9PSBmYWxzZSBvciAjc2VsZi5xdWVyeV9wYWdlczpHZXRDdXJyZW50UGFnZSgpID09IDAgdGhlbgoJCQkJc2VsZi5xdWVyeV9mYWlsdXJlID0gdHJ1ZQoJCQllbmQKCgkJCXNlbGYuaXNfcXVlcnlfeWllbGRlZCA9IGZhbHNlCgkJCU1vdmVWZXJzaW9uUXVlcnlRdWV1ZShzZWxmKQoKCQkJcmV0dXJuCgoJCWVuZAoKCQktLSBOZXh0IHBhZ2UgaXRlbToKCgkJc2VsZi5xdWVyeV9pbmRleCArPSAxCgkJcHJvZmlsZSA9IHNlbGYucHJvZmlsZV9zdG9yZTpHZXRBc3luYyhzZWxmLnByb2ZpbGVfa2V5LCBuZXh0X2l0ZW0uVmVyc2lvbikKCQlpc19maW5pc2hlZCA9IHRydWUKCgllbmQKCglpZiBzZWxmLmlzX3F1ZXJ5X3lpZWxkZWQgPT0gZmFsc2UgdGhlbgoJCXF1ZXJ5X2pvYigpCgllbHNlCgkJaWYgaXNfc3RhY2tpbmcgPT0gdHJ1ZSB0aGVuCgkJCXRhYmxlLmluc2VydChzZWxmLnF1ZXJ5X3F1ZXVlLCAxLCBxdWVyeV9qb2IpCgkJZWxzZQoJCQl0YWJsZS5pbnNlcnQoc2VsZi5xdWVyeV9xdWV1ZSwgcXVlcnlfam9iKQoJCWVuZAoJZW5kCgoJd2hpbGUgaXNfZmluaXNoZWQgPT0gZmFsc2UgZG8KCQl0YXNrLndhaXQoKQoJZW5kCgoJcmV0dXJuIHByb2ZpbGUKCmVuZAoKbG9jYWwgV2FybkFib3V0VmVyc2lvblF1ZXJ5T25jZSA9IGZhbHNlCgpmdW5jdGlvbiBQcm9maWxlU3RvcmU6VmVyc2lvblF1ZXJ5KHByb2ZpbGVfa2V5LCBzb3J0X2RpcmVjdGlvbiwgbWluX2RhdGUsIG1heF9kYXRlKQoKCWxvY2FsIGlzX21vY2sgPSBSZWFkTW9ja0ZsYWcoKQoKCWlmIHR5cGUocHJvZmlsZV9rZXkpIH49ICJzdHJpbmciIG9yIHN0cmluZy5sZW4ocHJvZmlsZV9rZXkpID09IDAgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgcHJvZmlsZV9rZXlgKQoJZW5kCgoJaWYgUHJvZmlsZVN0b3JlLklzQ2xvc2luZyA9PSB0cnVlIHRoZW4KCQlyZXR1cm4gc2V0bWV0YXRhYmxlKHt9LCBQcm9maWxlVmVyc2lvblF1ZXJ5KSAtLSBTaWxlbnRseSBmYWlsIDpOZXh0QXN5bmMoKSByZXF1ZXN0cwoJZW5kCgoJaWYgaXNfbW9jayBvciBEYXRhU3RvcmVTdGF0ZSB+PSAiQWNjZXNzIiB0aGVuCgkJaWYgSXNTdHVkaW8gPT0gdHJ1ZSBhbmQgV2FybkFib3V0VmVyc2lvblF1ZXJ5T25jZSA9PSBmYWxzZSB0aGVuCgkJCVdhcm5BYm91dFZlcnNpb25RdWVyeU9uY2UgPSB0cnVlCgkJCXdhcm4oYFt7c2NyaXB0Lk5hbWV9XTogOlZlcnNpb25RdWVyeSgpIGlzIG5vdCBzdXBwb3J0ZWQgaW4gbW9jayBtb2RlIWApCgkJZW5kCgkJcmV0dXJuIHNldG1ldGF0YWJsZSh7fSwgUHJvZmlsZVZlcnNpb25RdWVyeSkgLS0gU2lsZW50bHkgZmFpbCA6TmV4dEFzeW5jKCkgcmVxdWVzdHMKCWVuZAoKCS0tIFR5cGUgY2hlY2s6CgoJaWYgc29ydF9kaXJlY3Rpb24gfj0gbmlsIGFuZCAodHlwZW9mKHNvcnRfZGlyZWN0aW9uKSB+PSAiRW51bUl0ZW0iCgkJb3Igc29ydF9kaXJlY3Rpb24uRW51bVR5cGUgfj0gRW51bS5Tb3J0RGlyZWN0aW9uKSB0aGVuCgkJZXJyb3IoYFt7c2NyaXB0Lk5hbWV9XTogSW52YWxpZCBzb3J0X2RpcmVjdGlvbiAoe3Rvc3RyaW5nKHNvcnRfZGlyZWN0aW9uKX0pYCkKCWVuZAoKCWlmIG1pbl9kYXRlIH49IG5pbCBhbmQgdHlwZW9mKG1pbl9kYXRlKSB+PSAiRGF0ZVRpbWUiIGFuZCB0eXBlb2YobWluX2RhdGUpIH49ICJudW1iZXIiIHRoZW4KCQllcnJvcihgW3tzY3JpcHQuTmFtZX1dOiBJbnZhbGlkIG1pbl9kYXRlICh7dG9zdHJpbmcobWluX2RhdGUpfSlgKQoJZW5kCgoJaWYgbWF4X2RhdGUgfj0gbmlsIGFuZCB0eXBlb2YobWF4X2RhdGUpIH49ICJEYXRlVGltZSIgYW5kIHR5cGVvZihtYXhfZGF0ZSkgfj0gIm51bWJlciIgdGhlbgoJCWVycm9yKGBbe3NjcmlwdC5OYW1lfV06IEludmFsaWQgbWF4X2RhdGUgKHt0b3N0cmluZyhtYXhfZGF0ZSl9KWApCgllbmQKCgltaW5fZGF0ZSA9IHR5cGVvZihtaW5fZGF0ZSkgPT0gIkRhdGVUaW1lIiBhbmQgbWluX2RhdGUuVW5peFRpbWVzdGFtcE1pbGxpcyBvciBtaW5fZGF0ZQoJbWF4X2RhdGUgPSB0eXBlb2YobWF4X2RhdGUpID09ICJEYXRlVGltZSIgYW5kIG1heF9kYXRlLlVuaXhUaW1lc3RhbXBNaWxsaXMgb3IgbWF4X2RhdGUKCglyZXR1cm4gUHJvZmlsZVZlcnNpb25RdWVyeS5OZXcoc2VsZiwgcHJvZmlsZV9rZXksIHNvcnRfZGlyZWN0aW9uLCBtaW5fZGF0ZSwgbWF4X2RhdGUpCgplbmQKCi0tIERhdGFTdG9yZSBBUEkgYWNjZXNzIGNoZWNrOgoKaWYgSXNTdHVkaW8gPT0gdHJ1ZSB0aGVuCgoJdGFzay5zcGF3bihmdW5jdGlvbigpCgoJCWxvY2FsIG5ld19zdGF0ZSA9ICJOb0FjY2VzcyIKCgkJbG9jYWwgc3RhdHVzLCBtZXNzYWdlID0gcGNhbGwoZnVuY3Rpb24oKQoJCQktLSBUaGlzIHdpbGwgZXJyb3IgaWYgY3VycmVudCBpbnN0YW5jZSBoYXMgbm8gU3R1ZGlvIEFQSSBhY2Nlc3M6CgkJCURhdGFTdG9yZVNlcnZpY2U6R2V0RGF0YVN0b3JlKCJfX19fUFMiKTpTZXRBc3luYygiX19fX1BTIiwgb3MudGltZSgpKQoJCWVuZCkKCgkJbG9jYWwgbm9faW50ZXJuZXRfYWNjZXNzID0gc3RhdHVzID09IGZhbHNlIGFuZCBzdHJpbmcuZmluZChtZXNzYWdlLCAiQ29ubmVjdEZhaWwiLCAxLCB0cnVlKSB+PSBuaWwKCgkJaWYgbm9faW50ZXJuZXRfYWNjZXNzID09IHRydWUgdGhlbgoJCQl3YXJuKGBbe3NjcmlwdC5OYW1lfV06IE5vIGludGVybmV0IGFjY2VzcyAtIGNoZWNrIHlvdXIgbmV0d29yayBjb25uZWN0aW9uYCkKCQllbmQKCgkJaWYgc3RhdHVzID09IGZhbHNlIGFuZAoJCQkoc3RyaW5nLmZpbmQobWVzc2FnZSwgIjQwMyIsIDEsIHRydWUpIH49IG5pbCBvciAtLSBDYW5ub3Qgd3JpdGUgdG8gRGF0YVN0b3JlIGZyb20gc3R1ZGlvIGlmIEFQSSBhY2Nlc3MgaXMgbm90IGVuYWJsZWQKCQkJCXN0cmluZy5maW5kKG1lc3NhZ2UsICJtdXN0IHB1Ymxpc2giLCAxLCB0cnVlKSB+PSBuaWwgb3IgLS0gR2FtZSBtdXN0IGJlIHB1Ymxpc2hlZCB0byBhY2Nlc3MgbGl2ZSBrZXlzCgkJCQlub19pbnRlcm5ldF9hY2Nlc3MgPT0gdHJ1ZSkgdGhlbiAtLSBObyBpbnRlcm5ldCBhY2Nlc3MKCgkJCW5ld19zdGF0ZSA9IGlmIG5vX2ludGVybmV0X2FjY2VzcyA9PSB0cnVlIHRoZW4gIk5vSW50ZXJuZXQiIGVsc2UgIk5vQWNjZXNzIgoJCQlwcmludChgW3tzY3JpcHQuTmFtZX1dOiBSb2Jsb3ggQVBJIHNlcnZpY2VzIHVuYXZhaWxhYmxlIC0gZGF0YSB3aWxsIG5vdCBiZSBzYXZlZGApCgkJZWxzZQoJCQluZXdfc3RhdGUgPSAiQWNjZXNzIgoJCQktLXByaW50KGBbe3NjcmlwdC5OYW1lfV06IFJvYmxveCBBUEkgc2VydmljZXMgYXZhaWxhYmxlIC0gZGF0YSB3aWxsIGJlIHNhdmVkYCkKCQllbmQKCgkJRGF0YVN0b3JlU3RhdGUgPSBuZXdfc3RhdGUKCQlQcm9maWxlU3RvcmUuRGF0YVN0b3JlU3RhdGUgPSBuZXdfc3RhdGUKCgllbmQpCgplbHNlCgoJRGF0YVN0b3JlU3RhdGUgPSAiQWNjZXNzIgoJUHJvZmlsZVN0b3JlLkRhdGFTdG9yZVN0YXRlID0gIkFjY2VzcyIKCmVuZAoKLS0gVXBkYXRlIGxvb3A6CgpSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKCgktLSBBdXRvIHNhdmluZzoKCglsb2NhbCBhdXRvX3NhdmVfbGlzdF9sZW5ndGggPSAjQXV0b1NhdmVMaXN0CglpZiBhdXRvX3NhdmVfbGlzdF9sZW5ndGggPiAwIHRoZW4KCQlsb2NhbCBhdXRvX3NhdmVfaW5kZXhfc3BlZWQgPSBBVVRPX1NBVkVfUEVSSU9EIC8gYXV0b19zYXZlX2xpc3RfbGVuZ3RoCgkJbG9jYWwgb3NfY2xvY2sgPSBvcy5jbG9jaygpCgkJd2hpbGUgb3NfY2xvY2sgLSBMYXN0QXV0b1NhdmUgPiBhdXRvX3NhdmVfaW5kZXhfc3BlZWQgZG8KCQkJTGFzdEF1dG9TYXZlID0gTGFzdEF1dG9TYXZlICsgYXV0b19zYXZlX2luZGV4X3NwZWVkCgkJCWxvY2FsIHByb2ZpbGUgPSBBdXRvU2F2ZUxpc3RbQXV0b1NhdmVJbmRleF0KCQkJaWYgb3NfY2xvY2sgLSBwcm9maWxlLmxvYWRfdGltZXN0YW1wIDwgQVVUT19TQVZFX1BFUklPRCAvIDIgdGhlbgoJCQkJLS0gVGhpcyBwcm9maWxlIGlzIGZyZXNobHkgbG9hZGVkIC0gYXV0byBzYXZpbmcgaW1tZWRpYXRlbHkgaXMgbm90IG5lY2Vzc2FyeToKCQkJCXByb2ZpbGUgPSBuaWwKCQkJCWZvciBfID0gMSwgYXV0b19zYXZlX2xpc3RfbGVuZ3RoIC0gMSBkbwoJCQkJCS0tIE1vdmUgYXV0byBzYXZlIGluZGV4IHRvIHRoZSByaWdodDoKCQkJCQlBdXRvU2F2ZUluZGV4ID0gQXV0b1NhdmVJbmRleCArIDEKCQkJCQlpZiBBdXRvU2F2ZUluZGV4ID4gYXV0b19zYXZlX2xpc3RfbGVuZ3RoIHRoZW4KCQkJCQkJQXV0b1NhdmVJbmRleCA9IDEKCQkJCQllbmQKCQkJCQlwcm9maWxlID0gQXV0b1NhdmVMaXN0W0F1dG9TYXZlSW5kZXhdCgkJCQkJaWYgb3NfY2xvY2sgLSBwcm9maWxlLmxvYWRfdGltZXN0YW1wID49IEFVVE9fU0FWRV9QRVJJT0QgLyAyIHRoZW4KCQkJCQkJYnJlYWsKCQkJCQllbHNlCgkJCQkJCXByb2ZpbGUgPSBuaWwKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQKCQkJLS0gTW92ZSBhdXRvIHNhdmUgaW5kZXggdG8gdGhlIHJpZ2h0OgoJCQlBdXRvU2F2ZUluZGV4ID0gQXV0b1NhdmVJbmRleCArIDEKCQkJaWYgQXV0b1NhdmVJbmRleCA+IGF1dG9fc2F2ZV9saXN0X2xlbmd0aCB0aGVuCgkJCQlBdXRvU2F2ZUluZGV4ID0gMQoJCQllbmQKCQkJLS0gUGVyZm9ybSBzYXZlIGNhbGw6CgkJCWlmIHByb2ZpbGUgfj0gbmlsIHRoZW4KCQkJCXRhc2suc3Bhd24oU2F2ZVByb2ZpbGVBc3luYywgcHJvZmlsZSkgLS0gQXV0byBzYXZlIHByb2ZpbGUgaW4gbmV3IHRocmVhZAoJCQllbmQKCQllbmQKCWVuZAoKCS0tIENyaXRpY2FsIHN0YXRlIGhhbmRsaW5nOgoKCWlmIFByb2ZpbGVTdG9yZS5Jc0NyaXRpY2FsU3RhdGUgPT0gZmFsc2UgdGhlbgoJCWlmICNJc3N1ZVF1ZXVlID49IENSSVRJQ0FMX1NUQVRFX0VSUk9SX0NPVU5UIHRoZW4KCQkJUHJvZmlsZVN0b3JlLklzQ3JpdGljYWxTdGF0ZSA9IHRydWUKCQkJUHJvZmlsZVN0b3JlLk9uQ3JpdGljYWxUb2dnbGU6RmlyZSh0cnVlKQoJCQlDcml0aWNhbFN0YXRlU3RhcnQgPSBvcy5jbG9jaygpCgkJCXdhcm4oYFt7c2NyaXB0Lk5hbWV9XTogRW50ZXJlZCBjcml0aWNhbCBzdGF0ZWApCgkJZW5kCgllbHNlCgkJaWYgI0lzc3VlUXVldWUgPj0gQ1JJVElDQUxfU1RBVEVfRVJST1JfQ09VTlQgdGhlbgoJCQlDcml0aWNhbFN0YXRlU3RhcnQgPSBvcy5jbG9jaygpCgkJZWxzZWlmIG9zLmNsb2NrKCkgLSBDcml0aWNhbFN0YXRlU3RhcnQgPiBDUklUSUNBTF9TVEFURV9FWFBJUkUgdGhlbgoJCQlQcm9maWxlU3RvcmUuSXNDcml0aWNhbFN0YXRlID0gZmFsc2UKCQkJUHJvZmlsZVN0b3JlLk9uQ3JpdGljYWxUb2dnbGU6RmlyZShmYWxzZSkKCQkJd2FybihgW3tzY3JpcHQuTmFtZX1dOiBDcml0aWNhbCBzdGF0ZSBlbmRlZGApCgkJZW5kCgllbmQKCgktLSBJc3N1ZSBxdWV1ZToKCgl3aGlsZSB0cnVlIGRvCgkJbG9jYWwgaXNzdWVfdGltZSA9IElzc3VlUXVldWVbMV0KCQlpZiBpc3N1ZV90aW1lID09IG5pbCB0aGVuCgkJCWJyZWFrCgkJZWxzZWlmIG9zLmNsb2NrKCkgLSBpc3N1ZV90aW1lID4gQ1JJVElDQUxfU1RBVEVfRVJST1JfRVhQSVJFIHRoZW4KCQkJdGFibGUucmVtb3ZlKElzc3VlUXVldWUsIDEpCgkJZWxzZQoJCQlicmVhawoJCWVuZAoJZW5kCgplbmQpCgotLSBSZWxlYXNlIGFsbCBsb2FkZWQgcHJvZmlsZXMgd2hlbiB0aGUgc2VydmVyIGlzIHNodXR0aW5nIGRvd246Cgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCgl3aGlsZSBEYXRhU3RvcmVTdGF0ZSA9PSAiTm90UmVhZHkiIGRvCgkJdGFzay53YWl0KCkKCWVuZAoKCWlmIERhdGFTdG9yZVN0YXRlIH49ICJBY2Nlc3MiIHRoZW4KCgkJZ2FtZTpCaW5kVG9DbG9zZShmdW5jdGlvbigpCgkJCVByb2ZpbGVTdG9yZS5Jc0Nsb3NpbmcgPSB0cnVlCgkJCXRhc2sud2FpdCgpIC0tIE1vY2sgc2h1dGRvd24gZGVsYXkKCQllbmQpCgoJCXJldHVybiAtLSBEb24ndCB3YWl0IGZvciBwcm9maWxlcyB0byBwcm9wZXJseSBzYXZlIGluIG1vY2sgbW9kZSBzbyBzdHVkaW8gY291bGQgZW5kIHRoZSBzaW11bGF0aW9uIGZhc3RlcgoKCWVuZAoKCWdhbWU6QmluZFRvQ2xvc2UoZnVuY3Rpb24oKQoKCQlQcm9maWxlU3RvcmUuSXNDbG9zaW5nID0gdHJ1ZQoKCQktLSBSZWxlYXNlIGFsbCBhY3RpdmUgcHJvZmlsZXM6CgkJLS0gKENsb25lIEF1dG9TYXZlTGlzdCB0byBhIG5ldyB0YWJsZSBiZWNhdXNlIEF1dG9TYXZlTGlzdCBjaGFuZ2VzIHdoZW4gcHJvZmlsZXMgYXJlIHJlbGVhc2VkKQoKCQlsb2NhbCBvbl9jbG9zZV9zYXZlX2pvYl9jb3VudCA9IDAKCQlsb2NhbCBhY3RpdmVfcHJvZmlsZXMgPSB7fQoJCWZvciBpbmRleCwgcHJvZmlsZSBpbiBpcGFpcnMoQXV0b1NhdmVMaXN0KSBkbwoJCQlhY3RpdmVfcHJvZmlsZXNbaW5kZXhdID0gcHJvZmlsZQoJCWVuZAoKCQktLSBSZWxlYXNlIHRoZSBwcm9maWxlczsgUmVsZWFzaW5nIHByb2ZpbGVzIGNhbiB0cmlnZ2VyIGxpc3RlbmVycyB0aGF0IHJlbGVhc2Ugb3RoZXIgcHJvZmlsZXMsIHNvIGNoZWNrIGFjdGl2ZSBzdGF0ZToKCQlmb3IgXywgcHJvZmlsZSBpbiBpcGFpcnMoYWN0aXZlX3Byb2ZpbGVzKSBkbwoJCQlpZiBwcm9maWxlOklzQWN0aXZlKCkgPT0gdHJ1ZSB0aGVuCgkJCQlvbl9jbG9zZV9zYXZlX2pvYl9jb3VudCA9IG9uX2Nsb3NlX3NhdmVfam9iX2NvdW50ICsgMQoJCQkJdGFzay5zcGF3bihmdW5jdGlvbigpIC0tIFNhdmUgcHJvZmlsZSBvbiBuZXcgdGhyZWFkCgkJCQkJU2F2ZVByb2ZpbGVBc3luYyhwcm9maWxlLCB0cnVlLCBuaWwsICJTaHV0ZG93biIpCgkJCQkJb25fY2xvc2Vfc2F2ZV9qb2JfY291bnQgPSBvbl9jbG9zZV9zYXZlX2pvYl9jb3VudCAtIDEKCQkJCWVuZCkKCQkJZW5kCgkJZW5kCgoJCS0tIFlpZWxkIHVudGlsIGFsbCBhY3RpdmUgcHJvZmlsZSBqb2JzIGFyZSBmaW5pc2hlZDoKCQl3aGlsZSBvbl9jbG9zZV9zYXZlX2pvYl9jb3VudCA+IDAgb3IgQWN0aXZlUHJvZmlsZUxvYWRKb2JzID4gMCBvciBBY3RpdmVQcm9maWxlU2F2ZUpvYnMgPiAwIGRvCgkJCXRhc2sud2FpdCgpCgkJZW5kCgoJCXJldHVybiAtLSBXZSdyZSBkb25lIQoKCWVuZCkKCmVuZCkKCnJldHVybiBQcm9maWxlU3RvcmU="
  },
  "ScreenSpace": {
    "Type": "Module",
    "Code": "CmlmIGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpOklzU2VydmVyKCkgdGhlbiByZXR1cm4ge30gZW5kCgpsb2NhbCBQbGF5ZXJNb3VzZSA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyOkdldE1vdXNlKCkKCmxvY2FsIFNjcmVlblNwYWNlID0ge30KCi0tIEdldHRlciBmdW5jdGlvbnMsIHdpdGggYSBjb3VwbGUgb2YgaGFja3MgZm9yIElwYWQgcHJlLWZvY3VzLgpmdW5jdGlvbiBTY3JlZW5TcGFjZS5WaWV3U2l6ZVgoKQoJbG9jYWwgeCA9IFBsYXllck1vdXNlLlZpZXdTaXplWAoJbG9jYWwgeSA9IFBsYXllck1vdXNlLlZpZXdTaXplWQoJaWYgeCA9PSAwIHRoZW4KCQlyZXR1cm4gMTAyNAoJZWxzZQoJCWlmIHggPiB5IHRoZW4KCQkJcmV0dXJuIHgKCQllbHNlCgkJCXJldHVybiB5CgkJZW5kCgllbmQKZW5kCgpmdW5jdGlvbiBTY3JlZW5TcGFjZS5WaWV3U2l6ZVkoKQoJbG9jYWwgeCA9IFBsYXllck1vdXNlLlZpZXdTaXplWAoJbG9jYWwgeSA9IFBsYXllck1vdXNlLlZpZXdTaXplWQoJaWYgeSA9PSAwIHRoZW4KCQlyZXR1cm4gNzY4CgllbHNlCgkJaWYgeCA+IHkgdGhlbgoJCQlyZXR1cm4geQoJCWVsc2UKCQkJcmV0dXJuIHgKCQllbmQKCWVuZAplbmQKCi0tIE5pY2UgZ2V0dGVyIGZvciBhc3BlY3QgcmF0aW8uIER1ZSB0byB0aGUgY2hlY2tzIGluIHRoZSBWaWV3U2l6ZSBmdW5jdGlvbnMgdGhpcwotLSB3aWxsIG5ldmVyIGZhaWwgd2l0aCBhIGRpdmlkZSBieSB6ZXJvIGVycm9yLgpmdW5jdGlvbiBTY3JlZW5TcGFjZS5Bc3BlY3RSYXRpbygpCglyZXR1cm4gU2NyZWVuU3BhY2UuVmlld1NpemVYKCkgLyBTY3JlZW5TcGFjZS5WaWV3U2l6ZVkoKQplbmQKCi0tIFdvcmxkU3BhY2UgLT4gU2NyZWVuU3BhY2UuIFJhdyBmdW5jdGlvbiB0YWtpbmcgYSB3b3JsZCBwb3NpdGlvbiBhbmQgZ2l2aW5nIHlvdSB0aGUKLS0gc2NyZWVuIHBvc2l0aW9uLgpmdW5jdGlvbiBTY3JlZW5TcGFjZS5Xb3JsZFRvU2NyZWVuKGF0KQoJbG9jYWwgcG9pbnQgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5Db29yZGluYXRlRnJhbWU6cG9pbnRUb09iamVjdFNwYWNlKGF0KQoJbG9jYWwgYXNwZWN0UmF0aW8gPSBTY3JlZW5TcGFjZS5Bc3BlY3RSYXRpbygpCglsb2NhbCBoZmFjdG9yID0gbWF0aC50YW4obWF0aC5yYWQod29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuRmllbGRPZlZpZXcpLzIpCglsb2NhbCB3ZmFjdG9yID0gYXNwZWN0UmF0aW8qaGZhY3RvcgoJLS0KCWxvY2FsIHggPSAocG9pbnQueC9wb2ludC56KSAvIC13ZmFjdG9yCglsb2NhbCB5ID0gKHBvaW50LnkvcG9pbnQueikgLyAgaGZhY3RvcgoJLS0KCXJldHVybiBWZWN0b3IyLm5ldyhTY3JlZW5TcGFjZS5WaWV3U2l6ZVgoKSooMC41ICsgMC41KngpLCBTY3JlZW5TcGFjZS5WaWV3U2l6ZVkoKSooMC41ICsgMC41KnkpKQplbmQKCi0tIFNjcmVlblNwYWNlIC0+IFdvcmxkU3BhY2UuIFJhdyBmdW5jdGlvbiB0YWtpbmcgYSBzY3JlZW4gcG9zaXRpb24gYW5kIGEgZGVwdGggYW5kIAotLSBjb252ZXJ0aW5nIGl0IGludG8gYSB3b3JsZCBwb3NpdGlvbi4KZnVuY3Rpb24gU2NyZWVuU3BhY2UuU2NyZWVuVG9Xb3JsZCh4LCB5LCBkZXB0aCkKCWxvY2FsIGFzcGVjdFJhdGlvID0gU2NyZWVuU3BhY2UuQXNwZWN0UmF0aW8oKQoJbG9jYWwgaGZhY3RvciA9IG1hdGgudGFuKG1hdGgucmFkKHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkZpZWxkT2ZWaWV3KS8yKQoJbG9jYWwgd2ZhY3RvciA9IGFzcGVjdFJhdGlvKmhmYWN0b3IKCS0tCglsb2NhbCB4ZiwgeWYgPSB4L1NjcmVlblNwYWNlLlZpZXdTaXplWCgpKjIgLSAxLCB5L1NjcmVlblNwYWNlLlZpZXdTaXplWSgpKjIgLSAxCglsb2NhbCB4cG9zID0geGYgKiAtd2ZhY3RvciAqIGRlcHRoCglsb2NhbCB5cG9zID0geWYgKiAgaGZhY3RvciAqIGRlcHRoCgktLQoJcmV0dXJuIFZlY3RvcjMubmV3KHhwb3MsIHlwb3MsIGRlcHRoKQplbmQKCi0tIFNjcmVlblNpemUgLT4gV29ybGRTaXplCmZ1bmN0aW9uIFNjcmVlblNwYWNlLlNjcmVlbldpZHRoVG9Xb3JsZFdpZHRoKHNjcmVlbldpZHRoLCBkZXB0aCkJCglsb2NhbCBhc3BlY3RSYXRpbyA9IFNjcmVlblNwYWNlLkFzcGVjdFJhdGlvKCkKCWxvY2FsIGhmYWN0b3IgPSBtYXRoLnRhbihtYXRoLnJhZCh3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5GaWVsZE9mVmlldykvMikKCWxvY2FsIHdmYWN0b3IgPSBhc3BlY3RSYXRpbypoZmFjdG9yCglsb2NhbCBzeCA9IFNjcmVlblNwYWNlLlZpZXdTaXplWCgpCgktLQoJcmV0dXJuIC0oc2NyZWVuV2lkdGggLyBzeCkgKiAyICogd2ZhY3RvciAqIGRlcHRoCmVuZApmdW5jdGlvbiBTY3JlZW5TcGFjZS5TY3JlZW5IZWlnaHRUb1dvcmxkSGVpZ2h0KHNjcmVlbkhlaWdodCwgZGVwdGgpCglsb2NhbCBoZmFjdG9yID0gbWF0aC50YW4obWF0aC5yYWQod29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuRmllbGRPZlZpZXcpLzIpCglsb2NhbCBzeSA9IFNjcmVlblNwYWNlLlZpZXdTaXplWSgpCgktLQoJcmV0dXJuIC0oc2NyZWVuSGVpZ2h0IC8gc3kpICogMiAqIGhmYWN0b3IgKiBkZXB0aAplbmQKCi0tIFdvcmxkU2l6ZSAtPiBTY3JlZW5TaXplCmZ1bmN0aW9uIFNjcmVlblNwYWNlLldvcmxkV2lkdGhUb1NjcmVlbldpZHRoKHdvcmxkV2lkdGgsIGRlcHRoKQoJbG9jYWwgYXNwZWN0UmF0aW8gPSBTY3JlZW5TcGFjZS5Bc3BlY3RSYXRpbygpCglsb2NhbCBoZmFjdG9yID0gbWF0aC50YW4obWF0aC5yYWQod29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuRmllbGRPZlZpZXcpLzIpCglsb2NhbCB3ZmFjdG9yID0gYXNwZWN0UmF0aW8qaGZhY3RvcgoJbG9jYWwgc3ggPSBTY3JlZW5TcGFjZS5WaWV3U2l6ZVgoKQoJLS0KCXJldHVybiAtKHdvcmxkV2lkdGggKiBzeCkgLyAoMiAqIHdmYWN0b3IgKiBkZXB0aCkKZW5kCmZ1bmN0aW9uIFNjcmVlblNwYWNlLldvcmxkSGVpZ2h0VG9TY3JlZW5IZWlnaHQod29ybGRIZWlnaHQsIGRlcHRoKQoJbG9jYWwgaGZhY3RvciA9IG1hdGgudGFuKG1hdGgucmFkKHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkZpZWxkT2ZWaWV3KS8yKQoJbG9jYWwgc3kgPSBTY3JlZW5TcGFjZS5WaWV3U2l6ZVkoKQoJLS0KCXJldHVybiAtKHdvcmxkSGVpZ2h0ICogc3kpIC8gKDIgKiBoZmFjdG9yICogZGVwdGgpCmVuZAoKLS0gV29ybGRTaXplICsgU2NyZWVuU2l6ZSAtPiBEZXB0aCBuZWVkZWQKZnVuY3Rpb24gU2NyZWVuU3BhY2UuR2V0RGVwdGhGb3JXaWR0aChzY3JlZW5XaWR0aCwgd29ybGRXaWR0aCkKCWxvY2FsIGFzcGVjdFJhdGlvID0gU2NyZWVuU3BhY2UuQXNwZWN0UmF0aW8oKQoJbG9jYWwgaGZhY3RvciA9IG1hdGgudGFuKG1hdGgucmFkKHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkZpZWxkT2ZWaWV3KS8yKQoJbG9jYWwgd2ZhY3RvciA9IGFzcGVjdFJhdGlvKmhmYWN0b3IKCWxvY2FsIHN4LCBzeSA9IFNjcmVlblNwYWNlLlZpZXdTaXplWCgpLCBTY3JlZW5TcGFjZS5WaWV3U2l6ZVkoKQoJLS0KCXJldHVybiAtKHN4ICogd29ybGRXaWR0aCkgLyAoc2NyZWVuV2lkdGggKiAyICogd2ZhY3RvcikJCmVuZApmdW5jdGlvbiBTY3JlZW5TcGFjZS5HZXREZXB0aEZvckhlaWdodChzY3JlZW5IZWlnaHQsIHdvcmxkSGVpZ2h0KQoJbG9jYWwgaGZhY3RvciA9IG1hdGgudGFuKG1hdGgucmFkKHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkZpZWxkT2ZWaWV3KS8yKQoJbG9jYWwgc3kgPSBTY3JlZW5TcGFjZS5WaWV3U2l6ZVkoKQoJLS0KCXJldHVybiAtKHN5ICogd29ybGRIZWlnaHQpIC8gKHNjcmVlbkhlaWdodCAqIDIgKiBoZmFjdG9yKQkKZW5kCgotLSBTY3JlZW5TcGFjZSAtPiBXb3JsZFNwYWNlLiBUYWtpbmcgYSBzY3JlZW4gaGVpZ2h0LCBhbmQgYSBkZXB0aCB0byBwdXQgYW4gb2JqZWN0IAotLSBhdCwgYW5kIHJldHVybmluZyBhIHNpemUgb2YgaG93IGJpZyB0aGF0IG9iamVjdCBoYXMgdG8gYmUgdG8gYXBwZWFyIHRoYXQgc2l6ZQotLSBhdCB0aGF0IGRlcHRoLgpmdW5jdGlvbiBTY3JlZW5TcGFjZS5TY3JlZW5Ub1dvcmxkQnlIZWlnaHREZXB0aCh4LCB5LCBzY3JlZW5IZWlnaHQsIGRlcHRoKQoJbG9jYWwgYXNwZWN0UmF0aW8gPSBTY3JlZW5TcGFjZS5Bc3BlY3RSYXRpbygpCglsb2NhbCBoZmFjdG9yID0gbWF0aC50YW4obWF0aC5yYWQod29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuRmllbGRPZlZpZXcpLzIpCglsb2NhbCB3ZmFjdG9yID0gYXNwZWN0UmF0aW8qaGZhY3RvcgoJbG9jYWwgc3gsIHN5ID0gU2NyZWVuU3BhY2UuVmlld1NpemVYKCksIFNjcmVlblNwYWNlLlZpZXdTaXplWSgpCgktLQoJbG9jYWwgd29ybGRIZWlnaHQgPSAtKHNjcmVlbkhlaWdodC9zeSkgKiAyICogaGZhY3RvciAqIGRlcHRoCgktLQoJbG9jYWwgeGYsIHlmID0geC9zeCoyIC0gMSwgeS9zeSoyIC0gMQoJbG9jYWwgeHBvcyA9IHhmICogLXdmYWN0b3IgKiBkZXB0aAoJbG9jYWwgeXBvcyA9IHlmICogIGhmYWN0b3IgKiBkZXB0aAoJLS0KCXJldHVybiBWZWN0b3IzLm5ldyh4cG9zLCB5cG9zLCBkZXB0aCksIHdvcmxkSGVpZ2h0CmVuZAoKLS0gU2NyZWVuU3BhY2UgLT4gV29ybGRTcGFjZS4gVGFraW5nIGEgc2NyZWVuIHdpZHRoLCBhbmQgYSBkZXB0aCB0byBwdXQgYW4gb2JqZWN0IAotLSBhdCwgYW5kIHJldHVybmluZyBhIHNpemUgb2YgaG93IGJpZyB0aGF0IG9iamVjdCBoYXMgdG8gYmUgdG8gYXBwZWFyIHRoYXQgc2l6ZQotLSBhdCB0aGF0IGRlcHRoLgpmdW5jdGlvbiBTY3JlZW5TcGFjZS5TY3JlZW5Ub1dvcmxkQnlXaWR0aERlcHRoKHgsIHksIHNjcmVlbldpZHRoLCBkZXB0aCkKCWxvY2FsIGFzcGVjdFJhdGlvID0gU2NyZWVuU3BhY2UuQXNwZWN0UmF0aW8oKQoJbG9jYWwgaGZhY3RvciA9IG1hdGgudGFuKG1hdGgucmFkKHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkZpZWxkT2ZWaWV3KS8yKQoJbG9jYWwgd2ZhY3RvciA9IGFzcGVjdFJhdGlvKmhmYWN0b3IKCWxvY2FsIHN4LCBzeSA9IFNjcmVlblNwYWNlLlZpZXdTaXplWCgpLCBTY3JlZW5TcGFjZS5WaWV3U2l6ZVkoKQoJLS0KCWxvY2FsIHdvcmxkV2lkdGggPSAoc2NyZWVuV2lkdGgvc3gpICogMiAqIC13ZmFjdG9yICogZGVwdGgKCS0tCglsb2NhbCB4ZiwgeWYgPSB4L3N4KjIgLSAxLCB5L3N5KjIgLSAxCglsb2NhbCB4cG9zID0geGYgKiAtd2ZhY3RvciAqIGRlcHRoCglsb2NhbCB5cG9zID0geWYgKiAgaGZhY3RvciAqIGRlcHRoCgktLQoJcmV0dXJuIFZlY3RvcjMubmV3KHhwb3MsIHlwb3MsIGRlcHRoKSwgd29ybGRXaWR0aAplbmQKCi0tIFNjcmVlblNwYWNlIC0+IFdvcmxkU3BhY2UuIFRha2luZyBhIHNjcmVlbiBoZWlnaHQgdGhhdCB5b3Ugd2FudCB0aGF0IG9iamVjdCB0byBiZQotLSBhbmQgYSB3b3JsZCBoZWlnaHQgdGhhdCBpcyB0aGUgc2l6ZSBvZiB0aGF0IG9iamVjdCwgYW5kIHJldHVybmluZyB0aGUgcG9zaXRpb24gdG8KLS0gcHV0IHRoYXQgb2JqZWN0IGF0IHRvIHNhdGlzZnkgdGhvc2UuCmZ1bmN0aW9uIFNjcmVlblNwYWNlLlNjcmVlblRvV29ybGRCeUhlaWdodCh4LCB5LCBzY3JlZW5IZWlnaHQsIHdvcmxkSGVpZ2h0KQoJbG9jYWwgYXNwZWN0UmF0aW8gPSBTY3JlZW5TcGFjZS5Bc3BlY3RSYXRpbygpCglsb2NhbCBoZmFjdG9yID0gbWF0aC50YW4obWF0aC5yYWQod29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuRmllbGRPZlZpZXcpLzIpCglsb2NhbCB3ZmFjdG9yID0gYXNwZWN0UmF0aW8qaGZhY3RvcgoJbG9jYWwgc3gsIHN5ID0gU2NyZWVuU3BhY2UuVmlld1NpemVYKCksIFNjcmVlblNwYWNlLlZpZXdTaXplWSgpCgktLQoJbG9jYWwgZGVwdGggPSAtIChzeSAqIHdvcmxkSGVpZ2h0KSAvIChzY3JlZW5IZWlnaHQgKiAyICogaGZhY3RvcikKCS0tCglsb2NhbCB4ZiwgeWYgPSB4L3N4KjIgLSAxLCB5L3N5KjIgLSAxCglsb2NhbCB4cG9zID0geGYgKiAtd2ZhY3RvciAqIGRlcHRoCglsb2NhbCB5cG9zID0geWYgKiAgaGZhY3RvciAqIGRlcHRoCgktLQoJcmV0dXJuIFZlY3RvcjMubmV3KHhwb3MsIHlwb3MsIGRlcHRoKQplbmQKCi0tIFNjcmVlblNwYWNlIC0+IFdvcmxkU3BhY2UuIFRha2luZyBhIHNjcmVlbiB3aWR0aCB0aGF0IHlvdSB3YW50IHRoYXQgb2JqZWN0IHRvIGJlCi0tIGFuZCBhIHdvcmxkIHdpZHRoIHRoYXQgaXMgdGhlIHNpemUgb2YgdGhhdCBvYmplY3QsIGFuZCByZXR1cm5pbmcgdGhlIHBvc2l0aW9uIHRvCi0tIHB1dCB0aGF0IG9iamVjdCBhdCB0byBzYXRpc2Z5IHRob3NlLgpmdW5jdGlvbiBTY3JlZW5TcGFjZS5TY3JlZW5Ub1dvcmxkQnlXaWR0aCh4LCB5LCBzY3JlZW5XaWR0aCwgd29ybGRXaWR0aCkKCWxvY2FsIGFzcGVjdFJhdGlvID0gU2NyZWVuU3BhY2UuQXNwZWN0UmF0aW8oKQoJbG9jYWwgaGZhY3RvciA9IG1hdGgudGFuKG1hdGgucmFkKHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkZpZWxkT2ZWaWV3KS8yKQoJbG9jYWwgd2ZhY3RvciA9IGFzcGVjdFJhdGlvKmhmYWN0b3IKCWxvY2FsIHN4LCBzeSA9IFNjcmVlblNwYWNlLlZpZXdTaXplWCgpLCBTY3JlZW5TcGFjZS5WaWV3U2l6ZVkoKQoJLS0KCWxvY2FsIGRlcHRoID0gLSAoc3ggKiB3b3JsZFdpZHRoKSAvIChzY3JlZW5XaWR0aCAqIDIgKiB3ZmFjdG9yKQoJLS0KCWxvY2FsIHhmLCB5ZiA9IHgvc3gqMiAtIDEsIHkvc3kqMiAtIDEKCWxvY2FsIHhwb3MgPSB4ZiAqIC13ZmFjdG9yICogZGVwdGgKCWxvY2FsIHlwb3MgPSB5ZiAqICBoZmFjdG9yICogZGVwdGgKCS0tCglyZXR1cm4gVmVjdG9yMy5uZXcoeHBvcywgeXBvcywgZGVwdGgpCmVuZAoKcmV0dXJuIFNjcmVlblNwYWNl"
  },
  "Signal": {
    "Type": "Module",
    "Code": "LS0hc3RyaWN0CgpleHBvcnQgdHlwZSBDb25uZWN0aW9uPEEuLi4+ID0gewoJTmV4dDogCQkJCQlDb25uZWN0aW9uPEEuLi4+PywKCVByZXZpb3VzOiAJCQkJQ29ubmVjdGlvbjxBLi4uPj8sCglGdW5jdGlvbjogCQkJCShBLi4uKSAtPiAoKT8sCglEaXNjb25uZWN0OiAJCQkoc2VsZjogQ29ubmVjdGlvbjxBLi4uPikgLT4gKCksCn0KCmV4cG9ydCB0eXBlIFNpZ25hbDxBLi4uPiA9IHsKCU5leHQ6IAkJCQkJQ29ubmVjdGlvbjxBLi4uPj8sCglQcmV2aW91czogCQkJCUNvbm5lY3Rpb248QS4uLj4/LAoJRnVuY3Rpb246IAkJCQkoQS4uLikgLT4gKCk/LAoJbmV3OiAJCQkJCSgpIC0+IFNpZ25hbDxBLi4uPiwKCUZpcmU6IAkJCQkJKHNlbGY6IFNpZ25hbDxBLi4uPiwgQS4uLikgLT4gKCksCglXYWl0OiAJCQkJCShzZWxmOiBTaWduYWw8QS4uLj4pIC0+IEEuLi4sCglPbmNlOiAJCQkJCShzZWxmOiBTaWduYWw8QS4uLj4sIGZ1bmM6IChBLi4uKSAtPiAoKSkgLT4gQ29ubmVjdGlvbjxBLi4uPiwKCUNvbm5lY3Q6IAkJCQkoc2VsZjogU2lnbmFsPEEuLi4+LCBmdW5jOiAoQS4uLikgLT4gKCkpIC0+IENvbm5lY3Rpb248QS4uLj4sCglEaXNjb25uZWN0QWxsOiAJCQkoc2VsZjogU2lnbmFsPEEuLi4+KSAtPiAoKSwKfQoKbG9jYWwgdGhyZWFkczoge3RocmVhZH0gPSB7fQoKbG9jYWwgZnVuY3Rpb24gQ2FsbDxBLi4uPihmdW5jOiAoQS4uLikgLT4gKCksIHRocmVhZDogdGhyZWFkLCAuLi46IEEuLi4pOiAoKQoJZnVuYyguLi4pCgl0YWJsZS5pbnNlcnQodGhyZWFkcywgdGhyZWFkKQplbmQKCmxvY2FsIGZ1bmN0aW9uIFlpZWxkKCk6ICgpCgl3aGlsZSB0cnVlIGRvIENhbGwoY29yb3V0aW5lLnlpZWxkKCkpIGVuZAplbmQKCmxvY2FsIFNpZ25hbCwgQ29ubmVjdGlvbiA9IHt9LCB7fQpTaWduYWwuX19pbmRleCwgQ29ubmVjdGlvbi5fX2luZGV4ID0gU2lnbmFsLCBDb25uZWN0aW9uCgpsb2NhbCBmdW5jdGlvbiBEaXNjb25uZWN0PEEuLi4+KHNlbGY6IENvbm5lY3Rpb248QS4uLj4pOiAoKQoJbG9jYWwgbmV4dCwgcHJldmlvdXMgPSBzZWxmLk5leHQsIHNlbGYuUHJldmlvdXMgOjogYW55CglwcmV2aW91cy5OZXh0ID0gbmV4dAoJaWYgbmV4dCB0aGVuIG5leHQuUHJldmlvdXMgPSBwcmV2aW91cyBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBOZXc8QS4uLj4oKTogU2lnbmFsPEEuLi4+CglyZXR1cm4gKHNldG1ldGF0YWJsZSh7fSwgU2lnbmFsKSA6OiBhbnkpIDo6IFNpZ25hbDxBLi4uPgplbmQKCmxvY2FsIGZ1bmN0aW9uIEZpcmU8QS4uLj4oc2VsZjogU2lnbmFsPEEuLi4+LCAuLi46IEEuLi4pOiAoKQoJbG9jYWwgbGluayA9IHNlbGYuTmV4dAoJd2hpbGUgbGluayBkbwoJCWxvY2FsIGxlbmd0aCwgdGhyZWFkID0gI3RocmVhZHMsIG5pbAoJCWlmIGxlbmd0aCA9PSAwIHRoZW4KCQkJdGhyZWFkID0gY29yb3V0aW5lLmNyZWF0ZShZaWVsZCkKCQkJY29yb3V0aW5lLnJlc3VtZSh0aHJlYWQpCgkJZWxzZQoJCQl0aHJlYWQgPSB0aHJlYWRzW2xlbmd0aF0KCQkJdGhyZWFkc1tsZW5ndGhdID0gbmlsCgkJZW5kCgkJdGFzay5zcGF3bih0aHJlYWQsIGxpbmsuRnVuY3Rpb24sIHRocmVhZCwgLi4uKQoJCWxpbmsgPSBsaW5rLk5leHQKCWVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIENvbm5lY3Q8QS4uLj4oc2VsZjogU2lnbmFsPEEuLi4+LCBmdW5jOiAoQS4uLikgLT4gKCkpOiBDb25uZWN0aW9uPEEuLi4+Cglsb2NhbCBuZXh0ID0gc2VsZi5OZXh0Cglsb2NhbCBsaW5rID0ge1ByZXZpb3VzID0gc2VsZiwgRnVuY3Rpb24gPSBmdW5jLCBOZXh0ID0gbmV4dH0gOjogYW55CglpZiBuZXh0IH49IG5pbCB0aGVuIG5leHQuUHJldmlvdXMgPSBsaW5rIGVuZAoJc2VsZi5OZXh0ID0gbGluawoJcmV0dXJuIHNldG1ldGF0YWJsZShsaW5rLCBDb25uZWN0aW9uKSA6OiBDb25uZWN0aW9uPEEuLi4+CmVuZAoKbG9jYWwgZnVuY3Rpb24gT25jZTxBLi4uPihzZWxmOiBTaWduYWw8QS4uLj4sIGZ1bmM6IChBLi4uKSAtPiAoKSk6IENvbm5lY3Rpb248QS4uLj4KCWxvY2FsIGNvbm5lY3Rpb24KCWNvbm5lY3Rpb24gPSBDb25uZWN0KHNlbGYsIGZ1bmN0aW9uKC4uLikKCQlEaXNjb25uZWN0KGNvbm5lY3Rpb24pCgkJZnVuYyguLi4pCgllbmQpCglyZXR1cm4gY29ubmVjdGlvbgplbmQKCmxvY2FsIGZ1bmN0aW9uIFdhaXQ8QS4uLj4oc2VsZjogU2lnbmFsPEEuLi4+KTogQS4uLgoJbG9jYWwgdGhyZWFkLCBjb25uZWN0aW9uID0gY29yb3V0aW5lLnJ1bm5pbmcoKSwgbmlsCgljb25uZWN0aW9uID0gQ29ubmVjdChzZWxmLCBmdW5jdGlvbiguLi4pCgkJRGlzY29ubmVjdChjb25uZWN0aW9uKQoJCWlmIGNvcm91dGluZS5zdGF0dXModGhyZWFkKSA9PSAic3VzcGVuZGVkIiB0aGVuIHRhc2suc3Bhd24odGhyZWFkLCAuLi4pIGVuZAoJZW5kKQoJcmV0dXJuIGNvcm91dGluZS55aWVsZCgpCmVuZAoKbG9jYWwgZnVuY3Rpb24gRGlzY29ubmVjdEFsbDxBLi4uPihzZWxmOiBTaWduYWw8QS4uLj4pOiAoKQoJc2VsZi5OZXh0ID0gbmlsCmVuZAoKU2lnbmFsLm5ldyA9IE5ldwpTaWduYWwuRmlyZSA9IEZpcmUKU2lnbmFsLldhaXQgPSBXYWl0ClNpZ25hbC5PbmNlID0gT25jZQpTaWduYWwuQ29ubmVjdCA9IENvbm5lY3QKU2lnbmFsLkRpc2Nvbm5lY3RBbGwgPSBEaXNjb25uZWN0QWxsCkNvbm5lY3Rpb24uRGlzY29ubmVjdCA9IERpc2Nvbm5lY3QKCnJldHVybiBTaWduYWw="
  },
  "SimpleCooldown": {
    "Type": "Module",
    "Code": "LS1bWwoKTWFkZSBieSBUaGF3dXggb24gZGlzY29yZApKdXN0IGEgc2ltcGxlIGJhc2UgZm9yIHlvdSB0byBleHBhbmQgb24gZm9yIGNvb2xkb3duIGhhbmRsaW5nCgpdXQoKbG9jYWwgQ29vbGRvd24gPSB7fQoKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKCmV4cG9ydCB0eXBlIGNvb2xkb3ducyA9IHsKCVtQbGF5ZXJdOiB7CgkJW3N0cmluZ106IGJvb2xlYW4KCX0KfQoKbG9jYWwgQ29vbGRvd25zOiBjb29sZG93bnMgPSB7fQpsb2NhbCBEZWxheXMgPSB7fQoKZnVuY3Rpb24gQ29vbGRvd24uQWRkUGxheWVyKFBsYXllcjogUGxheWVyKQoJQ29vbGRvd25zW1BsYXllcl0gPSB7fQplbmQKZnVuY3Rpb24gQ29vbGRvd24uUmVtb3ZlUGxheWVyKFBsYXllcjogUGxheWVyKQoJQ29vbGRvd25zW1BsYXllcl0gPSBuaWwKZW5kCgpmdW5jdGlvbiBDb29sZG93bi5DaGVja0Nvb2xkb3duKFBsYXllcjogUGxheWVyLCBLZXk6IHN0cmluZykKCWlmIG5vdCBDb29sZG93bnNbUGxheWVyXSB0aGVuIHJldHVybiB0cnVlIGVuZAoJcmV0dXJuIGlmIENvb2xkb3duc1tQbGF5ZXJdW0tleV0gdGhlbiB0cnVlIGVsc2UgZmFsc2UKZW5kCgpmdW5jdGlvbiBDb29sZG93bi5BZGRDb29sZG93bihQbGF5ZXI6IFBsYXllciwgS2V5OiBzdHJpbmcsIER1cmF0aW9uOiBudW1iZXIpCgkKCWlmIENvb2xkb3duLkNoZWNrQ29vbGRvd24oUGxheWVyLCBLZXkpIHRoZW4gd2FybigiQ29vbGRvd24gYWxyZWFkeSBleGlzdHMiKSByZXR1cm4gZW5kCgkKCUNvb2xkb3duc1tQbGF5ZXJdW0tleV0gPSB0cnVlCglsb2NhbCBJZCA9IEh0dHBTZXJ2aWNlOkdlbmVyYXRlR1VJRChmYWxzZSkKCURlbGF5c1tJZF0gPSB0YXNrLmRlbGF5KER1cmF0aW9uLCBmdW5jdGlvbigpCgkJQ29vbGRvd24uUmVtb3ZlQ29vbGRvd24oUGxheWVyLCBLZXkpCgkJRGVsYXlzW0lkXSA9IG5pbAoJZW5kKQoJCmVuZAoKZnVuY3Rpb24gQ29vbGRvd24uUmVtb3ZlQ29vbGRvd24oUGxheWVyOiBQbGF5ZXIsIEtleTogc3RyaW5nKQoJaWYgQ29vbGRvd24uQ2hlY2tDb29sZG93bihQbGF5ZXIsIEtleSkgdGhlbgoJCUNvb2xkb3duc1tQbGF5ZXJdW0tleV0gPSBuaWwKCWVuZAplbmQKCmZ1bmN0aW9uIENvb2xkb3duLkNsZWFyQ29vbGRvd25zKFBsYXllcjogUGxheWVyKQoJQ29vbGRvd25zW1BsYXllcl0gPSB7fQoJZm9yIElkLCB2IGluIERlbGF5cyBkbwoJCXRhc2suY2FuY2VsKHYpCgkJRGVsYXlzW0lkXSA9IG5pbAoJZW5kCmVuZAoKcmV0dXJuIENvb2xkb3du"
  }
}
